/*! For license information please see 76.js.LICENSE.txt */
(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[76],{92324:(t,e,i)=>{"use strict";i.d(e,{s:()=>RoomMeshData});var n=i(67992);class RoomMeshData extends n.V{constructor(){super(),this.name="room-mesh-data",this.floors=new Set,this.rooms=new Set}}},49076:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>SceneModule});var n,s=i(97542),r=i(57956),a=i(32093),o=i(97998);!function(t){t.CLICK="INTERACTION.CLICK",t.HOVER="INTERACTION.HOVER",t.DRAG="INTERACTION.DRAG",t.DRAG_BEGIN="INTERACTION.DRAG_BEGIN",t.DRAG_END="INTERACTION.DRAG_END",t.POINTER_MOVE="INTERACTION.POINTER_MOVE",t.POINTER_BUTTON="INTERACTION.POINTER_BUTTON",t.SCROLL="INTERACTION.SCROLL",t.KEY="INTERACTION.KEY",t.LONG_PRESS_START="INTERACTION.LONG_PRESS_START",t.LONG_PRESS_END="INTERACTION.LONG_PRESS_END",t.MULTI_SWIPE="INTERACTION.MULTI_SWIPE",t.MULTI_SWIPE_END="INTERACTION.MULTI_SWIPE_END",t.PINCH="INTERACTION.PINCH",t.PINCH_END="INTERACTION.PINCH_END",t.ROTATE="INTERACTION.ROTATE",t.ROTATE_END="INTERACTION.ROTATE_END"}(n||(n={}));const h="global";var l=i(39880);class IdTracker{constructor(){this.ids=new Set}reserve(t){return!this.ids.has(t)&&(this.ids.add(t),!0)}peekId(){let t;do{t=(0,l.O1)(4)}while(!this.isAvailable(t));return t}nextId(){const t=this.peekId();return this.reserve(t),t}release(t){this.ids.delete(t)}isAvailable(t){return!this.ids.has(t)}}const d=new o.Z("SceneComponentFactory");class ComponentBuilder{constructor(){this.idTracker=new IdTracker,this.scopedFactories={}}registerFactory(t,e){let i=h;t.scope&&(i=t.scope);const n=this.scopedFactories[i]||{};return n[t.name]=e,this.scopedFactories[i]=n,d.debug(`Component "${i}.${t.name}" registered`),!0}unregisterFactory(t,e){return!0}newInstance(t,e,i,n,s,r){let a=null;if(t.scope!==h){const e=this.scopedFactories[t.scope];e&&(a=e[t.name])}if(a||(a=this.scopedFactories.global[t.name]),!a)throw Error(`Unknown component "${t.name}"`);const o=a();return o.componentType=t.name,ComponentBuilder.setupInputs(o,r),ComponentBuilder.setupOutputs(o),ComponentBuilder.setupBind(o,this.idTracker,n,s),ComponentBuilder.setupEvents(o),ComponentBuilder.setupEmits(o),ComponentBuilder.setupBindEvent(o,this.idTracker,n,s),ComponentBuilder.setupNotify(o,i),ComponentBuilder.setupSpyOnEvent(o,this.idTracker,n,s),o.context=e,o}static setupInputs(t,e){if(!t.inputs||0===Object.keys(t.inputs).length)return;t.inputs=(0,a.$)(t.inputs);const i=t.inputs;if(e)for(const t of Object.keys(e))t in i&&(i[t]=e[t]);for(const t of Object.keys(i)){const e=i[t];e&&"object"==typeof e&&!Array.isArray(e)&&0!==Object.keys(e).length&&(i[t]=(0,a.$)(e))}return i}static setupOutputs(t){if(t.outputs=t.outputs||{},t.outputs.hasOwnProperty("objectRoot"))throw Error("outputs.objectRoot is a reserved property of the outputs object");if(t.outputs.hasOwnProperty("collider"))throw Error("outputs.collider is a reserved property of the outputs object");t.outputs.objectRoot=t.outputs.objectRoot||null,t.outputs.collider=t.outputs.collider||null,t.outputs=(0,a.$)(t.outputs)}static setupBind(t,e,i,n){const s=t.inputs;t.bind=s?function(n,r,a){if(d.warn("`SceneComponent.bind` has been deprecated. See `SceneObject.bindPath` for replacement functionality"),!s||!(n in s))throw Error(n+" is not an input of the target component");const o=i.addInputPath(t,n,"input-"+e.nextId()),h=i.addOutputPath(r,a,"output-"+e.nextId());i.bindPath(o,h)}:function(){throw d.warn("`SceneComponent.bind` has been deprecated. See `SceneObject.bindPath` for replacement functionality"),Error("This component has no inputs, bind failed")}}static setupEvents(t){const e=t.events||{};!function(t,e){for(const i of e)t[i]=!!t[i]}(e,Object.values(n)),t.events=(0,a.$)(e)}static setupEmits(t){const e=t.emits;e&&Object.keys(e).length>0&&(t.emits=(0,a.$)(e))}static setupBindEvent(t,e,i,n){t.bindEvent=function(n,s,r){if(d.warn("`SceneComponent.bindEvent` has been deprecated. See `SceneObject.bindPath` for replacement functionality"),!(n in t.events))throw Error(n+" is not supported by the target component");const a=i.addEventPath(t,n,"event-"+e.nextId());c(s,r);const o=i.addEmitPath(s,r,"emit-"+e.nextId());i.bindPath(a,o)}}static setupNotify(t,e){t.notify=function(i,n){t.emits&&!t.emits[i]||e.notify(t,{type:i,data:n})}}static setupSpyOnEvent(t,e,i,n){t.spyOnEvent=function(n){d.warn("`SceneComponent.spyOnEvent` has been deprecated. See `SceneObject.spyOnEvent` for replacement functionality"),c(t,n.eventType);const s=i.addEmitPath(t,n.eventType,"event-spy-"+e.nextId());return i.spyOnEvent({path:s,onEvent:n.onEvent.bind(n)})}}}function c(t,e){const i=t.emits;i&&i.isObservableProxy||(t.emits=i||{},t.emits[e]=!0)}class ComponentEventBus{constructor(){this.observers=new Map}notify(t,e){const i=this.observers.get(t);if(i){const t=i.get(e.type)||[];for(const i of t)i.onEvent(i.targetEventType,e.data)}}observe(t){const e=this.observers.get(t.src)||new Map;this.observers.set(t.src,e);const i=e.get(t.srcEventType)||new Set;e.set(t.srcEventType,i),i.add(t);const n=this;return{cancel(){n.removeObserver(t)}}}removeObserver(t){const{src:e,srcEventType:i}=t,n=this.observers.get(e);if(n){const e=n.get(i);e&&e.delete(t)}}}var u=i(84428);class CwfComponent{constructor(t,e,i,n){this.instance=e,this.onBeforeRender=i,this.analytics=n,this.state=null,this.inputsCache=null,this.dirty=!1,this.interactionQueue=[],this.eventSpies=new Set,this.log=new o.Z(t),this.onDataChanged=this.onDataChanged.bind(this)}init(){}beforeRender(t){if(this.onBeforeRender.update(),this.instance.onEvent)for(;this.interactionQueue.length>0;){const t=this.interactionQueue.shift();if(t)try{this.instance.onEvent(t.type,t.data);for(const e of this.eventSpies)e.onEvent(t.type,t.data)}catch(t){this.log.error(t)}}if(this.dirty&&this.instance.onInputsUpdated&&this.inputsCache){try{this.instance.onInputsUpdated(this.inputsCache)}catch(t){this.log.error(t)}Object.assign(this.inputsCache,this.instance.inputs),this.dirty=!1}if(this.instance.onTick)try{this.instance.onTick(t)}catch(t){this.log.error(t)}}spyOnEvent(t){this.eventSpies.add(t);const e=this;return{cancel(){e.eventSpies.delete(t)}}}render(t){}dispose(){this.state&&this.state.removeOnChanged(this.onDataChanged)}activate(){const t=this.instance.inputs;if(t&&(t.onChanged(this.onDataChanged),this.inputsCache=Object.assign({},t)),this.instance.onInit)try{this.instance.onInit()}catch(t){this.log.error(t)}const e={componentType:this.instance.componentType};this.analytics.track("sdk_component_start",this.instance.componentType,e)}deactivate(){const t=this.instance.inputs;if(t&&t.removeOnChanged(this.onDataChanged),this.instance.onDestroy)try{this.instance.onDestroy()}catch(t){this.log.error(t)}}onDataChanged(){this.dirty=!0}onEvent(t){this.interactionQueue.push(t)}}var f=i(29537),p=i(86819),_=i(23612),g=i(80592),m=i(72996);class ProxyFactory{constructor(t){this.propertyAccessor=t}create(t,e){return this._createProxy(t,(i=>{const n=this.propertyAccessor;return{get:()=>(n.onAccess(e,i),t[i]),set:s=>(n.onAccess(e,i),t[i]=s,s)}}))}createReadonly(t,e){return this._createProxy(t,(i=>{const n=this.propertyAccessor;return{get:()=>(n.onAccess(e,i),t[i])}}))}_createProxy(t,e){const i={};for(const n in t)t.hasOwnProperty(n)&&Object.defineProperty(i,n,e(n));return i}}var b=i(35895);const w=new o.Z("SceneNode");var y;!function(t){t[t.Idle=0]="Idle",t[t.Operating=1]="Operating",t[t.Stopped=2]="Stopped"}(y||(y={}));class SceneNode{constructor(t,e,i,n,s,r,a,o,h,l){this.componentLoader=t,this.renderer=e,this.targets=i,this.analytics=n,this.componentFactory=s,this.sceneObject=r,this.eventBus=a,this.inputIni=o,this.sceneNodeFactory=l,this.obj3D=new u.Object3D,this.state=y.Idle,this.components=[],this.componentLookup=new Map,this.interactionsSubs=[],this.idTracker=new IdTracker,this.proxyFactory=new ProxyFactory(h);const d=this;this.facade=new class NodeFacade{get id(){return d.id}get name(){return d.name}set name(t){d.name=t}get position(){return d.position}get quaternion(){return d.quaternion}get scale(){return d.scale}get obj3D(){return d.obj3D}componentIterator(){return d.componentIterator()}bindings(){return d.bindings()}findComponentById(t){return d.findComponentById(t)}addComponent(t,e,i){return d.addComponent(t,e,i)}start(){return d.start()}stop(){return d.stop()}}}*componentIterator(){for(const t of this.components)yield t.instance}*bindings(){for(const t of this.sceneObject.bindings()){const[e]=t;e.node.id===this.id&&(yield t)}}findComponentById(t){const e=this.components.find((e=>e.instance.id===t));return e?e.instance:null}getComponentByInstance(t){const e=this.componentLookup.get(t.id);if(e&&e.instance===t)return e}publicFacade(){return this.facade}addObject(t){return this.obj3D.add(t),t}removeObject(t){this.obj3D.remove(t)}addCollider(t){return this.targets.addTarget(t,!1),t}removeCollider(t){this.targets.removeTarget(t)}get name(){return this.obj3D.name||""}set name(t){this.obj3D.name=t}get position(){return this.obj3D.position}get quaternion(){return this.obj3D.quaternion}get scale(){return this.obj3D.scale}addComponent(t,e,i){if(this.state!==y.Idle)return w.warn("Cannot add component after the node has started"),null;const n=this.publicFacade(),s={three:this.proxyFactory.createReadonly(u,"three"),renderer:this.proxyFactory.create(this.renderer.cwfRenderer.renderer,"renderer"),scene:this.renderer.getScene().scene,camera:this.renderer.getScene().camera,nodeFactory:this.sceneNodeFactory,root:n};const r=this.componentFactory.newInstance({scope:this.sceneObject.scope,name:t},s,this.eventBus,this.sceneObject,n,e),a=new CwfComponent(t,r,new class MatrixWorldUpdater{constructor(t){this.sceneNode=t}update(){this.sceneNode.obj3D.updateMatrixWorld()}}(this),this.analytics),o=r.outputs;this.subscribeToObjectOutput(o);const h=this.subscribeToInteraction(a,r);if(this.interactionsSubs.push(h),i){if(!this.idTracker.isAvailable(i))throw Error("Component with duplicate id detected.");if(-1!==i.indexOf("/"))throw Error('Component ids cannot have "/" character.');this.idTracker.reserve(i)}const l=i||this.idTracker.nextId();return Object.defineProperty(r,"id",{value:l,writable:!1,enumerable:!0}),this.components.push(a),this.sceneObject.onComponentAdded(n,r),this.componentLookup.set(r.id,a),r}subscribeToObjectOutput(t){let e;t.onPropertyChanged("objectRoot",(()=>{e&&(this.removeObject(e),e=void 0),t.objectRoot instanceof u.Object3D?e=this.addObject(t.objectRoot):t.objectRoot&&w.warn("outputs.object is not an instanceof THREE.Object3D")}))}subscribeToInteraction(t,e){let i,s;const r=e.outputs,a=()=>{if(i&&(this.removeCollider(i),i=void 0),s){for(const t of s)t.cancel();s=void 0}},o=()=>{a(),r.collider instanceof u.Object3D?(i=this.addCollider(r.collider),s=this.registerInput(t,r.collider,e.events)):r.collider&&w.warn("outputs.collider is not an instanceof THREE.Object3D")};return e.events.onPropertyChanged(n.CLICK,o),e.events.onPropertyChanged(n.HOVER,o),e.events.onPropertyChanged(n.DRAG,o),r.onPropertyChanged("collider",o),(0,b.k1)((()=>{}),(()=>a()))}registerInput(t,e,i){const s=(e,i,n,s)=>{const r=SceneNode.inputEventMap.get(Object.getPrototypeOf(e).constructor);if(r){const a={type:r,data:Object.assign(s||{},{collider:i,point:n?n.point:null,normal:n&&n.face?n.face.normal:null,input:e})};t.onEvent(a)}},r=m.s.is((t=>t===e&&t.visible||v(e)(t))),a=[];return i[n.CLICK]&&a.push(this.inputIni.registerMeshHandler(p.R,r,s)),i[n.HOVER]&&a.push(this.inputIni.registerMeshHandler(_.z,r,((t,e,i)=>{s(t,e,i,{hover:!0})})),this.inputIni.registerMeshHandler(_.A,r,((t,e,i)=>{s(t,e,i,{hover:!1})}))),i[n.DRAG]&&a.push(this.inputIni.registerMeshHandler(g.E0,r,s),this.inputIni.registerMeshHandler(g._t,r,s),this.inputIni.registerMeshHandler(g._R,r,s)),a}start(){if(this.state===y.Idle){this.obj3D.parent||this.renderer.getScene().addChild(f.a.Root,this.obj3D);for(const t of this.components)this.componentLoader.addComponent(t);this.state=y.Operating}}stop(){if(this.state===y.Operating){for(const t of this.interactionsSubs)t.cancel();this.interactionsSubs=[];for(const t of this.components)this.componentLoader.removeComponent(t);this.obj3D.parent&&this.obj3D.parent.remove(this.obj3D),this.state=y.Stopped}}}SceneNode.inputEventMap=new Map([[p.R,n.CLICK],[_.z,n.HOVER],[_.A,n.HOVER],[g._t,n.DRAG],[g.E0,n.DRAG_BEGIN],[g._R,n.DRAG_END]]);const v=t=>e=>{for(let i=e;i;i=i.parent){if(!i.visible)return!1;if(t===i.parent)return!0}return!1};var k=i(48840),E=i(54864);class OBJLoader2Component{async load(t,e){let i=null;if(e){const t=new E.MTLLoader;i=await(n=t,s=e,new Promise(((t,e)=>{n.load(s,(function(e){t(e)}),void 0,e)})))}var n,s;const r=new k.OBJLoader;i&&r.setMaterials(i);const a=await((t,e)=>new Promise(((i,n)=>{t.load(e,(function(t){i(t)}),void 0,n)})))(r,t);return a.traverse((t=>{if("Mesh"===t.type){const e=t;e.castShadow=!0,e.receiveShadow=!0}})),{objectRoot:a,collider:a}}}OBJLoader2Component.factoryName="mp.objLoader";var x=i(50652);class FBXLoaderComponent{async load(t,e){const i=new x.FBXLoader,n=await((t,e)=>new Promise(((i,n)=>{t.load(e,(function(t){i(t)}),void 0,n)})))(i,t);return n.traverse((t=>{if("Mesh"===t.type){const e=t;e.castShadow=!0,e.receiveShadow=!0}})),{objectRoot:n,collider:n}}}FBXLoaderComponent.factoryName="mp.fbxLoader";var A=i(28687);class ColladaLoaderComponent{async load(t,e){const i=new A.ColladaLoader,n=await((t,e)=>new Promise(((i,n)=>{t.load(e,(function(t){i(t)}),void 0,n)})))(i,t);return n.scene.traverse((t=>{if("Mesh"===t.type){const e=t;e.castShadow=!0,e.receiveShadow=!0}})),{objectRoot:n.scene,collider:n.scene}}}ColladaLoaderComponent.factoryName="mp.daeLoader";var C=i(17047);class GLTFLoaderComponent{async load(t,e){const i=new C.GLTFLoader,n=await((t,e)=>new Promise(((i,n)=>{t.load(e,(function(t){i(t)}),void 0,n)})))(i,t);return n.scene.traverse((t=>{if("Mesh"===t.type||"SkinnedMesh"===t.type){const e=t;e.castShadow=!0,e.receiveShadow=!0,e.material instanceof u.MeshStandardMaterial&&e.material.map&&(e.material.map.encoding=u.LinearEncoding)}})),{objectRoot:n.scene,collider:n.scene}}}GLTFLoaderComponent.factoryName="mp.gltfLoader";var U,O=i(83633);!function(t){t.Translate="translate",t.Rotate="rotate",t.scale="scale"}(U||(U={}));const T="mp.transformControls";function I(t){class TransformControlsComponent{constructor(){this.controlsSubs=[],this.inputs={visible:!0,selection:null,mode:U.Translate,showX:!0,showY:!0,showZ:!0,size:1},this.events={[n.HOVER]:!1,[n.DRAG]:!0,[n.CLICK]:!1}}onInit(){this.transformControls=function(t,e){class Canvas{addEventListener(t,i,n){return e.addEventListener(t,i,n)}removeEventListener(t,i,n){return e.removeEventListener(t,i,n)}getBoundingClientRect(){return e.getBoundingClientRect()}setPointerCapture(t){return e.setPointerCapture(t)}releasePointerCapture(t){return e.releasePointerCapture(t)}get ownerDocument(){return{get pointerLockElement(){return e.ownerDocument.pointerLockElement?this:null}}}}class TransformControls extends O.TransformControls{constructor(){super(t,e),this.domElement=new Canvas}}return new TransformControls}(this.context.camera,t),this.transformControls.enabled=!0,this.outputs.objectRoot=this.transformControls,this.collider=this.transformControls.children[0],this.onInputsUpdated()}onEvent(){}onInputsUpdated(){if(this.inputs.selection){const t=this.inputs.selection.obj3D;this.transformControls.attach(t),this.outputs.collider=this.collider}else this.transformControls.detach(),this.outputs.collider=null;this.handleMode()}onDestroy(){for(const t of this.controlsSubs)t.cancel();this.outputs.objectRoot=null,this.transformControls.dispose()}handleMode(){this.transformControls.mode!==this.inputs.mode&&this.transformControls.setMode(this.inputs.mode),this.transformControls.showX=this.inputs.showX,this.transformControls.showY=this.inputs.showY,this.transformControls.showZ=this.inputs.showZ,this.transformControls.size=this.inputs.size}}return()=>new TransformControlsComponent}var R=i(57321),N=i(8555),L=i(68217),S=i(42064),z=i(88854),D=i(30787),P=i(59582),B=i(71360),F=i(12554),M=i(52886),j=i(31211),Z=i(41410),H=i(18872),W=i(23376),G=i(56253),K=i(27118),$=i(63737),V=i(20536),Y=i(7441),X=i(79751),Q=i(36953),q=i(62392),J=i(52441),tt=i(80716),et=i(39623),it=i(25667),nt=i(94787),st=i(44145),rt=i(88599),at=i(94817),ot=i(79299),ht=i(55180),lt=i(22509),dt=i(34958),ct=i(12317),ut=i(25690),ft=i(4079),pt=i(21659),_t=i(65637),gt=i(10424),mt=i(64395),bt=i(13400),wt=i(94522),yt=i(53474),vt=i(71272),kt=i(40893),Et=i(33043),xt=i(45108),At=i(99326),Ct=i(4370),Ut=i(64130),Ot=i(43718),Tt=i(33976),It=i(31090),Rt=i(55880),Nt=i(24041),Lt=i(78903),St=i(19803),zt=i(64579),Dt=i(91578),Pt=i(10107),Bt=i(58723),Ft=i(73014),Mt=i(47796),jt=i(80063),Zt=i(47019),Ht=i(3432),Wt=i(29145),Gt=i(89001),Kt=i(92298),$t=i(66653),Vt=i(3326),Yt=i(8162),Xt=i(10338),Qt=i(68204),qt=i(24207),Jt=i(64013),te=i(31356),ee=i(20510),ie=i(23491),ne=i(69138),se=i(58613),re=i(82652),ae=i(34186),oe=i(38210),he=i(95980),le=i(30824),de=i(83592),ce=i(90577),ue=i(73737),fe=i(20961),pe=i(46468),_e=i(49338),ge=i(54546),me=i(74878),be=i(40879),we=i(31231),ye=i(46286),ve=i(81481),ke=i(65575),Ee=i(45174),xe=i(7585),Ae=i(36637),Ce=i(8867),Ue=i(41081),Oe=i(13187),Te=i(69714),Ie=i(52300),Re=i(17412),Ne=i(76993),Le=i(28748),Se=i(75654),ze=i(4127),De=i(98004),Pe=i(90151),Be=i(91346),Fe=i(77310),Me=i(42088),je=i(73070),Ze=i(91474),He=i(97927),We=i(99210),Ge=i(51755),Ke=i(94575),$e=i(59598),Ve=i(66296),Ye=i(97874),Xe=i(66878),Qe=i(96385),qe=i(9800),Je=i(28027),ti=i(68483),ei=i(92285),ii=i(86025),ni=i(55258),si=i(1072),ri=i(19973),ai=i(78323),oi=i(94139),hi=i(64731),li=i(27395),di=i(52753),ci=i(43742),ui=i(66895),fi=i(51143),pi=i(91758),_i=i(35868),gi=i(2938),mi=i(67822),bi=i(220),wi=i(24532),yi=i(66038),vi=i(31334),ki=i(79412),Ei=i(32801),xi=i(32903),Ai=i(30122),Ci=i(81732),Ui=i(58927),Oi=i(57558),Ti=i(86552),Ii=i(82088),Ri=i(20740),Ni=i(86426),Li=i(33598),Si=i(22328),zi=i(15980),Di=i(72844),Pi=i(13919),Bi=i(56),Fi=i(93375),Mi=i(46945),ji=i(21808),Zi=i(53020),Hi=i(29276),Wi=i(21564),Gi=i(55040),Ki=i(52595),$i=i(72019),Vi=i(63232),Yi=i(26352),Xi=i(75026),Qi=i(40245),qi=i(20887),Ji=i(61667),tn=i(76554),en=i(11510),nn=i(12577),sn=i(76869),rn=i(68546),an=i(16763),on=i(58265),hn=i(92216),ln=i(7794),dn=i(91684),cn=i(47876),un=i(79641),fn=i(45441),pn=i(64717),_n=i(38424),gn=i(35100),mn=i(6311),bn=i(63486),wn=i(98340),yn=i(1650),vn=i(60513),kn=i(83391),En=i(10246),xn=i(9069),An=i(24817),Cn=i(35102),Un=i(11331),On=i(79796),Tn=i(38775),In=i(50897),Rn=i(21076),Nn=i(66415),Ln=i(25123),Sn=i(26797),zn=i(76471),Dn=i(87743),Pn=i(10512),Bn=i(24784),Fn=i(3789),Mn=i(26442),jn=i(98859),Zn=i(12385),Hn=i(54445),Wn=i(82588),Gn=i(65372),Kn=i(23678),$n=i(58093),Vn=i(41329),Yn=i(78469),Xn=i(37256),Qn=i(35394),qn=i(77764),Jn=i(79493),ts=i(22637),es=i(60531),is=i(25133),ns=i(60064),ss=i(98541),rs=i(70557),as=i(71331),os=i(5324),hs=i(77146),ls=i(43356),ds=i(91836),cs=i(39613),us=i(97979),fs=i(84074),ps=[R,N,L,S,z,D,P,B,F,M,j,Z,O,H,W,G,K,$,V,Y,X,Q,q,J,tt,et,it,nt,st,rt,at,ot,ht,lt,dt,ct,ut,ft,pt,_t,gt,mt,bt,wt,yt,vt,kt,Et,xt,At,Ct,Ut,Ot,Tt,It,Rt,Nt,Lt,St,zt,Dt,Pt,Bt,Ft,Mt,jt,Zt,Ht,Wt,Gt,Kt,$t,Vt,A,Yt,Xt,Qt,x,qt,Jt,C,te,ee,ie,ne,se,re,ae,oe,he,le,de,ce,ue,fe,pe,_e,ge,E,me,k,be,we,ye,ve,ke,Ee,xe,Ae,Ce,Ue,Oe,Te,Ie,Re,Ne,Le,Se,ze,De,Pe,Be,Fe,Me,je,Ze,He,We,Ge,Ke,$e,Ve,Ye,Xe,Qe,qe,Je,ti,ei,ii,ni,si,ri,ai,oi,hi,li,di,ci,ui,fi,pi,_i,gi,mi,bi,wi,yi,vi,ki,Ei,xi,Ai,Ci,Ui,Oi,Ti,Ii,Ri,Ni,Li,Si,zi,Di,Pi,Bi,Fi,Mi,ji,Zi,Hi,Wi,Gi,Ki,$i,Vi,Yi,Xi,Qi,qi,Ji,tn,en,nn,sn,rn,an,on,hn,ln,dn,cn,un,fn,pn,_n,gn,mn,bn,wn,yn,vn,kn,En,xn,An,Cn,Un,On,Tn,In,Rn,Nn,Ln,Sn,zn,Dn,Pn,Bn,Fn,Mn,jn,Zn,Hn,Wn,Gn,Kn,$n,Vn,Yn,Xn,Qn,qn,Jn,ts,es,is,ns,ss,rs,as,os,hs,ls,ds,cs,us,fs];const _s=["FontLoader","Font","ParametricGeometry","TextGeometry"],gs=new o.Z("three-globals");class ScrollingTube{constructor(){this.visibleCache=!0,this.lengthCache=1,this.radiusCache=.5,this.fillColorCache="rgba(0,255,0,0.3)",this.textColorCache="rgb(0,255,0)",this.textCache="➡︎",this.fontCache="48px sans-serif",this.mesh=null,this.material=null,this.geometry=null,this.texture=null,this.time=0,this.inputs={visible:!0,length:1,radius:.5,fillColor:"rgba(0,255,0,0.3)",textColor:"rgb(255,255,255)",text:"➡︎",font:"48px sans-serif",scrollSpeed:1}}onInit(){this.updateCache(),this.makeTube()}onInputsUpdated(){this.inputs.length===this.lengthCache&&this.inputs.radius===this.radiusCache&&this.inputs.fillColor===this.fillColorCache&&this.inputs.textColor===this.textColorCache&&this.inputs.text===this.textCache&&this.inputs.font===this.fontCache||(this.updateCache(),this.makeTube()),this.visibleCache!==this.inputs.visible&&(this.visibleCache=this.inputs.visible,this.mesh&&(this.mesh.visible=this.inputs.visible))}onDestroy(){this.releaseTube()}updateCache(){this.radiusCache=this.inputs.radius,this.lengthCache=this.inputs.length,this.fillColorCache=this.inputs.fillColor,this.textColorCache=this.inputs.textColor,this.textCache=this.inputs.text,this.fontCache=this.inputs.font}makeTube(){this.releaseTube();const t=document.createElement("canvas").getContext("2d");if(!t)return;t.canvas.width=64,t.canvas.height=64,t.fillStyle=this.inputs.fillColor,t.fillRect(0,0,64,64),t.translate(32,32),t.rotate(.5*Math.PI),t.fillStyle=this.inputs.textColor,t.textAlign="center",t.textBaseline="middle",t.font=this.inputs.font,t.fillText(this.inputs.text,0,0),this.texture=new u.CanvasTexture(t.canvas),this.texture.wrapS=u.RepeatWrapping,this.texture.wrapT=u.RepeatWrapping,this.texture.repeat.x=4,this.texture.repeat.y=this.inputs.length/(2*this.inputs.radius);const e=new u.CylinderBufferGeometry(this.inputs.radius,this.inputs.radius,this.inputs.length,20,2,!0);this.material=new u.MeshBasicMaterial({map:this.texture,depthWrite:!1,depthTest:!1,transparent:!0}),this.outputs.objectRoot=new u.Mesh(e,this.material)}onTick(t){this.time+=t,this.texture&&(this.texture.offset.y=this.inputs.scrollSpeed*this.time/1e3%1)}releaseTube(){this.material&&(this.material.dispose(),this.material=null),this.geometry&&(this.geometry.dispose(),this.geometry=null),this.texture&&(this.texture.dispose(),this.texture=null),this.mesh=null}}var ms;ScrollingTube.factory=()=>new ScrollingTube,ScrollingTube.factoryName="mp.scrollingTube",function(t){t.Scene="scene",t.Model="model",t.Floor="floor",t.Room="room"}(ms||(ms={}));class Tags{constructor(){this.tagMap=new Map,this.tmpSet=new Set}tagObject(t,e){for(const i of e){let e=this.tagMap.get(i);e||(e=[],this.tagMap.set(i,e));e.find((e=>e===t))||e.push(t)}}untagObject(t,e){for(const i of e){const e=this.tagMap.get(i);if(e){const i=e.findIndex((e=>e===t));-1!==i&&e.splice(i)}}}getObjects(t){this.tmpSet.clear();const e=[];for(const i of t){const t=this.tagMap.get(i);if(t)for(const i of t)this.tmpSet.has(i)||(e.push(i),this.tmpSet.add(i))}return e}clearAllTags(){this.tagMap.clear()}}class LightsComponents{onInit(){const t=new u.Object3D,e=new u.AmbientLight(8947848),i=new u.DirectionalLight(14540253,1);i.position.set(1,.5,1),t.add(e),t.add(i),this.outputs.objectRoot=t}}LightsComponents.factory=()=>new LightsComponents,LightsComponents.factoryName="mp.lights";class PointLightComponent{constructor(){this.inputs={enabled:!0,color:{r:1,g:1,b:1},intensity:2,position:{x:1,y:5,z:1},distance:0,decay:1,castShadow:!1,debug:!1}}onInit(){this.light=new u.PointLight,this.lightHelper=new u.PointLightHelper(this.light,1);const t=new u.Group;t.add(this.light),t.add(this.lightHelper),this.onInputsUpdated(),this.outputs.objectRoot=t}onInputsUpdated(){this.light.visible=this.inputs.enabled,this.lightHelper.visible=this.inputs.debug,this.light.visible&&(this.light.position.set(this.inputs.position.x,this.inputs.position.y,this.inputs.position.z),this.light.color.setRGB(this.inputs.color.r,this.inputs.color.g,this.inputs.color.b),this.light.intensity=this.inputs.intensity,this.light.distance=this.inputs.distance,this.light.decay=this.inputs.decay,this.light.castShadow=this.inputs.castShadow)}onDestroy(){this.lightHelper.dispose(),this.outputs.objectRoot=null}onTick(){this.inputs.debug&&this.lightHelper.update()}}PointLightComponent.factory=()=>new PointLightComponent,PointLightComponent.factoryName="mp.pointLight";class DirectionalLightComponent{constructor(){this.inputs={enabled:!0,color:{r:1,g:1,b:1},intensity:2,position:{x:1,y:5,z:1},target:{x:0,y:0,z:0},castShadow:!1,debug:!1}}onInit(){this.targetObject=new u.Object3D,this.light=new u.DirectionalLight,this.light.target=this.targetObject,this.light.castShadow=!0,this.lightHelper=new u.DirectionalLightHelper(this.light,1);const t=new u.Group;t.add(this.light),t.add(this.targetObject),t.add(this.lightHelper),this.onInputsUpdated(),this.outputs.objectRoot=t}onInputsUpdated(t=null){this.light.visible=this.inputs.enabled,this.lightHelper.visible=this.inputs.debug,this.inputs.enabled&&(this.targetObject.position.set(this.inputs.target.x,this.inputs.target.y,this.inputs.target.z),this.light.position.set(this.inputs.position.x,this.inputs.position.y,this.inputs.position.z),this.light.color.setRGB(this.inputs.color.r,this.inputs.color.g,this.inputs.color.b),this.light.intensity=this.inputs.intensity,this.light.castShadow=this.inputs.castShadow)}onTick(t){this.inputs.debug&&this.lightHelper.update()}onDestroy(){this.lightHelper.dispose(),this.outputs.objectRoot=null}}DirectionalLightComponent.factory=()=>new DirectionalLightComponent,DirectionalLightComponent.factoryName="mp.directionalLight";class AmbientLightComponent{constructor(){this.inputs={enabled:!0,color:{r:.2,g:.2,b:.2},intensity:1}}onInit(){this.light=new u.AmbientLight,this.onInputsUpdated(),this.outputs.objectRoot=this.light}onInputsUpdated(){this.light.color.setRGB(this.inputs.color.r,this.inputs.color.g,this.inputs.color.b),this.light.intensity=this.inputs.intensity,this.light.visible=this.inputs.enabled}onDestroy(){this.outputs.objectRoot=null}}AmbientLightComponent.factory=()=>new AmbientLightComponent,AmbientLightComponent.factoryName="mp.ambientLight";var bs=i(79606);class SceneAnalytics{constructor(t,e){this.analytics=t,this.sdkData=e,this.track=async(t,e)=>{if(this.sdkData.applicationKeys.length>1)this.analytics.track(t,e);else{const i=Object.assign(e||{},{applicationKey:this.sdkData.applicationKeys.get(0)});this.analytics.track(t,i)}}}}class TrackFirstPropertyAnalyticsWrapper{constructor(t){this.analytics=t,this.trackedProperties={}}onAccess(t,e){if(this.trackedProperties[String(e)])return;this.trackedProperties[String(e)]=!0;const i={name:t,property:e};this.analytics.track("context-usage",i)}}class TrackFirstKeyAnalytics{constructor(t){this.analytics=t,this.trackedKeys={}}track(t,e,i){this.trackedKeys[String(e)]||(this.trackedKeys[String(e)]=!0,this.analytics.track(t,i))}}var ws=i(77330),ys=i(53261);class ImageLoader extends u.Loader{constructor(t,e){super(),this.renderer=t,this.requestq=new ys.gO,this.worker=e()}load(t,e){const i=new u.Texture;return this.requestImage(t).then((async t=>{this.updateTexture(i,t),e&&e(i)})),i}async loadAsync(t){const e=await this.requestImage(t),i=await this.worker.exec(e,[e]),n=new u.DataTexture(new Uint8ClampedArray(i.width),i.width,i.height);return n.format=this.getPixelFormat(i),this.prerenderTexture(n),n}requestImage(t){return this.requestq.get(t,{responseType:"arraybuffer"})}async updateTexture(t,e){const i=await this.worker.exec(e,[e]);t.format=this.getPixelFormat(i),function(t,e){t.image={data:new Uint8Array(e.data),height:e.height,width:e.width},t.isDataTexture=!0}(t,i),this.prerenderTexture(t)}getPixelFormat(t){const e=t.data.byteLength/(t.width*t.height);if(4===e)return u.RGBAFormat;if(1===e)return u.AlphaFormat;throw Error("images with only 2 or 3 channels are not supported")}prerenderTexture(t){t.needsUpdate=!0,this.renderer.initTexture(t),t.image=new ImageData(1,1)}}let vs=null;function ks(t){return function(){return function(t){return vs||(vs=new ImageLoader(t,ws.createJpegDecodeWorker)),vs}(t)}}var Es=i(90697),xs=i(20477),As=i.n(xs);(0,Es.h)((function(){return As()('/*! For license information please see PNGEncoder.worker.worker.js.LICENSE.txt */\n(()=>{"use strict";var t={396:function(){!function(t){if(t.TextEncoder&&t.TextDecoder)return!1;function e(t="utf-8"){if("utf-8"!==t)throw new RangeError(`Failed to construct \'TextEncoder\': The encoding label provided (\'${t}\') is invalid.`)}function i(t="utf-8",e={fatal:!1}){if("utf-8"!==t)throw new RangeError(`Failed to construct \'TextDecoder\': The encoding label provided (\'${t}\') is invalid.`);if(e.fatal)throw new Error("Failed to construct \'TextDecoder\': the \'fatal\' option is unsupported.")}Object.defineProperty(e.prototype,"encoding",{value:"utf-8"}),e.prototype.encode=function(t,e={stream:!1}){if(e.stream)throw new Error("Failed to encode: the \'stream\' option is unsupported.");let i=0;const a=t.length;let n=0,r=Math.max(32,a+(a>>1)+7),s=new Uint8Array(r>>3<<3);for(;i<a;){let e=t.charCodeAt(i++);if(e>=55296&&e<=56319){if(i<a){const a=t.charCodeAt(i);56320==(64512&a)&&(++i,e=((1023&e)<<10)+(1023&a)+65536)}if(e>=55296&&e<=56319)continue}if(n+4>s.length){r+=8,r*=1+i/t.length*2,r=r>>3<<3;const e=new Uint8Array(r);e.set(s),s=e}if(0!=(4294967168&e)){if(0==(4294965248&e))s[n++]=e>>6&31|192;else if(0==(4294901760&e))s[n++]=e>>12&15|224,s[n++]=e>>6&63|128;else{if(0!=(4292870144&e))continue;s[n++]=e>>18&7|240,s[n++]=e>>12&63|128,s[n++]=e>>6&63|128}s[n++]=63&e|128}else s[n++]=e}return s.slice(0,n)},Object.defineProperty(i.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(i.prototype,"fatal",{value:!1}),Object.defineProperty(i.prototype,"ignoreBOM",{value:!1}),i.prototype.decode=function(t,e={stream:!1}){if(e.stream)throw new Error("Failed to decode: the \'stream\' option is unsupported.");const i=new Uint8Array(t);let a=0;const n=i.length,r=[];for(;a<n;){const t=i[a++];if(0===t)break;if(0==(128&t))r.push(t);else if(192==(224&t)){const e=63&i[a++];r.push((31&t)<<6|e)}else if(224==(240&t)){const e=63&i[a++],n=63&i[a++];r.push((31&t)<<12|e<<6|n)}else if(240==(248&t)){let e=(7&t)<<18|(63&i[a++])<<12|(63&i[a++])<<6|63&i[a++];e>65535&&(e-=65536,r.push(e>>>10&1023|55296),e=56320|1023&e),r.push(e)}}return String.fromCharCode.apply(null,r)},t.TextEncoder=e,t.TextDecoder=i}("undefined"!=typeof window?window:"undefined"!=typeof self?self:this)}},e={};function i(a){var n=e[a];if(void 0!==n)return n.exports;var r=e[a]={exports:{}};return t[a].call(r.exports,r,r.exports,i),r.exports}(()=>{i(396);const t=new TextDecoder("utf-8");const e=new TextEncoder;class IOBuffer_IOBuffer{constructor(t=8192,e={}){let i=!1;"number"==typeof t?t=new ArrayBuffer(t):(i=!0,this.lastWrittenByte=t.byteLength);const a=e.offset?e.offset>>>0:0,n=t.byteLength-a;let r=a;(ArrayBuffer.isView(t)||t instanceof IOBuffer_IOBuffer)&&(t.byteLength!==t.buffer.byteLength&&(r=t.byteOffset+a),t=t.buffer),this.lastWrittenByte=i?n:0,this.buffer=t,this.length=n,this.byteLength=n,this.byteOffset=r,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,r,n),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(void 0===t)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const e=2*(this.offset+t),i=new Uint8Array(e);i.set(new Uint8Array(this.buffer)),this.buffer=i.buffer,this.length=this.byteLength=e,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){const e=new Uint8Array(t);for(let i=0;i<t;i++)e[i]=this.readByte();return e}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let e="";for(let i=0;i<t;i++)e+=this.readChar();return e}readUtf8(e=1){return i=this.readBytes(e),t.decode(i);var i}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e));return this}writeUtf8(t){return this.writeBytes(function(t){return e.encode(t)}(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function a(t){let e=t.length;for(;--e>=0;)t[e]=0}const n=256,r=286,s=30,o=15,h=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),l=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),d=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),_=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),f=new Array(576);a(f);const c=new Array(60);a(c);const u=new Array(512);a(u);const w=new Array(256);a(w);const g=new Array(29);a(g);const b=new Array(s);function p(t,e,i,a,n){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=a,this.max_length=n,this.has_stree=t&&t.length}let m,k,y;function v(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}a(b);const E=t=>t<256?u[t]:u[256+(t>>>7)],A=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},x=(t,e,i)=>{t.bi_valid>16-i?(t.bi_buf|=e<<t.bi_valid&65535,A(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=i-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)},U=(t,e,i)=>{x(t,i[2*e],i[2*e+1])},z=(t,e)=>{let i=0;do{i|=1&t,t>>>=1,i<<=1}while(--e>0);return i>>>1},R=(t,e,i)=>{const a=new Array(16);let n,r,s=0;for(n=1;n<=o;n++)a[n]=s=s+i[n-1]<<1;for(r=0;r<=e;r++){let e=t[2*r+1];0!==e&&(t[2*r]=z(a[e]++,e))}},O=t=>{let e;for(e=0;e<r;e++)t.dyn_ltree[2*e]=0;for(e=0;e<s;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0},N=t=>{t.bi_valid>8?A(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},B=(t,e,i,a)=>{const n=2*e,r=2*i;return t[n]<t[r]||t[n]===t[r]&&a[e]<=a[i]},L=(t,e,i)=>{const a=t.heap[i];let n=i<<1;for(;n<=t.heap_len&&(n<t.heap_len&&B(e,t.heap[n+1],t.heap[n],t.depth)&&n++,!B(e,a,t.heap[n],t.depth));)t.heap[i]=t.heap[n],i=n,n<<=1;t.heap[i]=a},T=(t,e,i)=>{let a,r,s,o,d=0;if(0!==t.last_lit)do{a=t.pending_buf[t.d_buf+2*d]<<8|t.pending_buf[t.d_buf+2*d+1],r=t.pending_buf[t.l_buf+d],d++,0===a?U(t,r,e):(s=w[r],U(t,s+n+1,e),o=h[s],0!==o&&(r-=g[s],x(t,r,o)),a--,s=E(a),U(t,s,i),o=l[s],0!==o&&(a-=b[s],x(t,a,o)))}while(d<t.last_lit);U(t,256,e)},D=(t,e)=>{const i=e.dyn_tree,a=e.stat_desc.static_tree,n=e.stat_desc.has_stree,r=e.stat_desc.elems;let s,h,l,d=-1;for(t.heap_len=0,t.heap_max=573,s=0;s<r;s++)0!==i[2*s]?(t.heap[++t.heap_len]=d=s,t.depth[s]=0):i[2*s+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=d<2?++d:0,i[2*l]=1,t.depth[l]=0,t.opt_len--,n&&(t.static_len-=a[2*l+1]);for(e.max_code=d,s=t.heap_len>>1;s>=1;s--)L(t,i,s);l=r;do{s=t.heap[1],t.heap[1]=t.heap[t.heap_len--],L(t,i,1),h=t.heap[1],t.heap[--t.heap_max]=s,t.heap[--t.heap_max]=h,i[2*l]=i[2*s]+i[2*h],t.depth[l]=(t.depth[s]>=t.depth[h]?t.depth[s]:t.depth[h])+1,i[2*s+1]=i[2*h+1]=l,t.heap[1]=l++,L(t,i,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const i=e.dyn_tree,a=e.max_code,n=e.stat_desc.static_tree,r=e.stat_desc.has_stree,s=e.stat_desc.extra_bits,h=e.stat_desc.extra_base,l=e.stat_desc.max_length;let d,_,f,c,u,w,g=0;for(c=0;c<=o;c++)t.bl_count[c]=0;for(i[2*t.heap[t.heap_max]+1]=0,d=t.heap_max+1;d<573;d++)_=t.heap[d],c=i[2*i[2*_+1]+1]+1,c>l&&(c=l,g++),i[2*_+1]=c,_>a||(t.bl_count[c]++,u=0,_>=h&&(u=s[_-h]),w=i[2*_],t.opt_len+=w*(c+u),r&&(t.static_len+=w*(n[2*_+1]+u)));if(0!==g){do{for(c=l-1;0===t.bl_count[c];)c--;t.bl_count[c]--,t.bl_count[c+1]+=2,t.bl_count[l]--,g-=2}while(g>0);for(c=l;0!==c;c--)for(_=t.bl_count[c];0!==_;)f=t.heap[--d],f>a||(i[2*f+1]!==c&&(t.opt_len+=(c-i[2*f+1])*i[2*f],i[2*f+1]=c),_--)}})(t,e),R(i,d,t.bl_count)},I=(t,e,i)=>{let a,n,r=-1,s=e[1],o=0,h=7,l=4;for(0===s&&(h=138,l=3),e[2*(i+1)+1]=65535,a=0;a<=i;a++)n=s,s=e[2*(a+1)+1],++o<h&&n===s||(o<l?t.bl_tree[2*n]+=o:0!==n?(n!==r&&t.bl_tree[2*n]++,t.bl_tree[32]++):o<=10?t.bl_tree[34]++:t.bl_tree[36]++,o=0,r=n,0===s?(h=138,l=3):n===s?(h=6,l=3):(h=7,l=4))},Z=(t,e,i)=>{let a,n,r=-1,s=e[1],o=0,h=7,l=4;for(0===s&&(h=138,l=3),a=0;a<=i;a++)if(n=s,s=e[2*(a+1)+1],!(++o<h&&n===s)){if(o<l)do{U(t,n,t.bl_tree)}while(0!=--o);else 0!==n?(n!==r&&(U(t,n,t.bl_tree),o--),U(t,16,t.bl_tree),x(t,o-3,2)):o<=10?(U(t,17,t.bl_tree),x(t,o-3,3)):(U(t,18,t.bl_tree),x(t,o-11,7));o=0,r=n,0===s?(h=138,l=3):n===s?(h=6,l=3):(h=7,l=4)}};let S=!1;const C=(t,e,i,a)=>{x(t,0+(a?1:0),3),((t,e,i,a)=>{N(t),a&&(A(t,i),A(t,~i)),t.pending_buf.set(t.window.subarray(e,e+i),t.pending),t.pending+=i})(t,e,i,!0)};var F={_tr_init:t=>{S||((()=>{let t,e,i,a,n;const _=new Array(16);for(i=0,a=0;a<28;a++)for(g[a]=i,t=0;t<1<<h[a];t++)w[i++]=a;for(w[i-1]=a,n=0,a=0;a<16;a++)for(b[a]=n,t=0;t<1<<l[a];t++)u[n++]=a;for(n>>=7;a<s;a++)for(b[a]=n<<7,t=0;t<1<<l[a]-7;t++)u[256+n++]=a;for(e=0;e<=o;e++)_[e]=0;for(t=0;t<=143;)f[2*t+1]=8,t++,_[8]++;for(;t<=255;)f[2*t+1]=9,t++,_[9]++;for(;t<=279;)f[2*t+1]=7,t++,_[7]++;for(;t<=287;)f[2*t+1]=8,t++,_[8]++;for(R(f,287,_),t=0;t<s;t++)c[2*t+1]=5,c[2*t]=z(t,5);m=new p(f,h,257,r,o),k=new p(c,l,0,s,o),y=new p(new Array(0),d,0,19,7)})(),S=!0),t.l_desc=new v(t.dyn_ltree,m),t.d_desc=new v(t.dyn_dtree,k),t.bl_desc=new v(t.bl_tree,y),t.bi_buf=0,t.bi_valid=0,O(t)},_tr_stored_block:C,_tr_flush_block:(t,e,i,a)=>{let r,s,o=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<n;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0})(t)),D(t,t.l_desc),D(t,t.d_desc),o=(t=>{let e;for(I(t,t.dyn_ltree,t.l_desc.max_code),I(t,t.dyn_dtree,t.d_desc.max_code),D(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*_[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),r=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=r&&(r=s)):r=s=i+5,i+4<=r&&-1!==e?C(t,e,i,a):4===t.strategy||s===r?(x(t,2+(a?1:0),3),T(t,f,c)):(x(t,4+(a?1:0),3),((t,e,i,a)=>{let n;for(x(t,e-257,5),x(t,i-1,5),x(t,a-4,4),n=0;n<a;n++)x(t,t.bl_tree[2*_[n]+1],3);Z(t,t.dyn_ltree,e-1),Z(t,t.dyn_dtree,i-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),T(t,t.dyn_ltree,t.dyn_dtree)),O(t),a&&N(t)},_tr_tally:(t,e,i)=>(t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(w[i]+n+1)]++,t.dyn_dtree[2*E(e)]++),t.last_lit===t.lit_bufsize-1),_tr_align:t=>{x(t,2,3),U(t,256,f),(t=>{16===t.bi_valid?(A(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}};var M=(t,e,i,a)=>{let n=65535&t|0,r=t>>>16&65535|0,s=0;for(;0!==i;){s=i>2e3?2e3:i,i-=s;do{n=n+e[a++]|0,r=r+n|0}while(--s);n%=65521,r%=65521}return n|r<<16|0};const H=new Uint32Array((()=>{let t,e=[];for(var i=0;i<256;i++){t=i;for(var a=0;a<8;a++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e})());var W=(t,e,i,a)=>{const n=H,r=a+i;t^=-1;for(let i=a;i<r;i++)t=t>>>8^n[255&(t^e[i])];return-1^t},K={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},P={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:j,_tr_stored_block:Y,_tr_flush_block:G,_tr_tally:$,_tr_align:V}=F,{Z_NO_FLUSH:X,Z_PARTIAL_FLUSH:q,Z_FULL_FLUSH:J,Z_FINISH:Q,Z_BLOCK:tt,Z_OK:et,Z_STREAM_END:it,Z_STREAM_ERROR:at,Z_DATA_ERROR:nt,Z_BUF_ERROR:rt,Z_DEFAULT_COMPRESSION:st,Z_FILTERED:ot,Z_HUFFMAN_ONLY:ht,Z_RLE:lt,Z_FIXED:dt,Z_DEFAULT_STRATEGY:_t,Z_UNKNOWN:ft,Z_DEFLATED:ct}=P,ut=258,wt=262,gt=103,bt=113,pt=666,mt=(t,e)=>(t.msg=K[e],e),kt=t=>(t<<1)-(t>4?9:0),yt=t=>{let e=t.length;for(;--e>=0;)t[e]=0};let vt=(t,e,i)=>(e<<t.hash_shift^i)&t.hash_mask;const Et=t=>{const e=t.state;let i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+i),t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))},At=(t,e)=>{G(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Et(t.strm)},xt=(t,e)=>{t.pending_buf[t.pending++]=e},Ut=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},zt=(t,e,i,a)=>{let n=t.avail_in;return n>a&&(n=a),0===n?0:(t.avail_in-=n,e.set(t.input.subarray(t.next_in,t.next_in+n),i),1===t.state.wrap?t.adler=M(t.adler,e,n,i):2===t.state.wrap&&(t.adler=W(t.adler,e,n,i)),t.next_in+=n,t.total_in+=n,n)},Rt=(t,e)=>{let i,a,n=t.max_chain_length,r=t.strstart,s=t.prev_length,o=t.nice_match;const h=t.strstart>t.w_size-wt?t.strstart-(t.w_size-wt):0,l=t.window,d=t.w_mask,_=t.prev,f=t.strstart+ut;let c=l[r+s-1],u=l[r+s];t.prev_length>=t.good_match&&(n>>=2),o>t.lookahead&&(o=t.lookahead);do{if(i=e,l[i+s]===u&&l[i+s-1]===c&&l[i]===l[r]&&l[++i]===l[r+1]){r+=2,i++;do{}while(l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&r<f);if(a=ut-(f-r),r=f-ut,a>s){if(t.match_start=e,s=a,a>=o)break;c=l[r+s-1],u=l[r+s]}}}while((e=_[e&d])>h&&0!=--n);return s<=t.lookahead?s:t.lookahead},Ot=t=>{const e=t.w_size;let i,a,n,r,s;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-wt)){t.window.set(t.window.subarray(e,e+e),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,a=t.hash_size,i=a;do{n=t.head[--i],t.head[i]=n>=e?n-e:0}while(--a);a=e,i=a;do{n=t.prev[--i],t.prev[i]=n>=e?n-e:0}while(--a);r+=e}if(0===t.strm.avail_in)break;if(a=zt(t.strm,t.window,t.strstart+t.lookahead,r),t.lookahead+=a,t.lookahead+t.insert>=3)for(s=t.strstart-t.insert,t.ins_h=t.window[s],t.ins_h=vt(t,t.ins_h,t.window[s+1]);t.insert&&(t.ins_h=vt(t,t.ins_h,t.window[s+3-1]),t.prev[s&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=s,s++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<wt&&0!==t.strm.avail_in)},Nt=(t,e)=>{let i,a;for(;;){if(t.lookahead<wt){if(Ot(t),t.lookahead<wt&&e===X)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=3&&(t.ins_h=vt(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-wt&&(t.match_length=Rt(t,i)),t.match_length>=3)if(a=$(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=vt(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=vt(t,t.ins_h,t.window[t.strstart+1]);else a=$(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(a&&(At(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===Q?(At(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(At(t,!1),0===t.strm.avail_out)?1:2},Bt=(t,e)=>{let i,a,n;for(;;){if(t.lookahead<wt){if(Ot(t),t.lookahead<wt&&e===X)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=3&&(t.ins_h=vt(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-wt&&(t.match_length=Rt(t,i),t.match_length<=5&&(t.strategy===ot||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){n=t.strstart+t.lookahead-3,a=$(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=n&&(t.ins_h=vt(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,a&&(At(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(a=$(t,0,t.window[t.strstart-1]),a&&At(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(a=$(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===Q?(At(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(At(t,!1),0===t.strm.avail_out)?1:2};function Lt(t,e,i,a,n){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=a,this.func=n}const Tt=[new Lt(0,0,0,0,((t,e)=>{let i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(Ot(t),0===t.lookahead&&e===X)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;const a=t.block_start+i;if((0===t.strstart||t.strstart>=a)&&(t.lookahead=t.strstart-a,t.strstart=a,At(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-wt&&(At(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===Q?(At(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(At(t,!1),t.strm.avail_out),1)})),new Lt(4,4,8,4,Nt),new Lt(4,5,16,8,Nt),new Lt(4,6,32,32,Nt),new Lt(4,4,16,16,Bt),new Lt(8,16,32,32,Bt),new Lt(8,16,128,128,Bt),new Lt(8,32,128,256,Bt),new Lt(32,128,258,1024,Bt),new Lt(32,258,258,4096,Bt)];function Dt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ct,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),yt(this.dyn_ltree),yt(this.dyn_dtree),yt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),yt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),yt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const It=t=>{if(!t||!t.state)return mt(t,at);t.total_in=t.total_out=0,t.data_type=ft;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:bt,t.adler=2===e.wrap?0:1,e.last_flush=X,j(e),et},Zt=t=>{const e=It(t);var i;return e===et&&((i=t.state).window_size=2*i.w_size,yt(i.head),i.max_lazy_match=Tt[i.level].max_lazy,i.good_match=Tt[i.level].good_length,i.nice_match=Tt[i.level].nice_length,i.max_chain_length=Tt[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0),e},St=(t,e,i,a,n,r)=>{if(!t)return at;let s=1;if(e===st&&(e=6),a<0?(s=0,a=-a):a>15&&(s=2,a-=16),n<1||n>9||i!==ct||a<8||a>15||e<0||e>9||r<0||r>dt)return mt(t,at);8===a&&(a=9);const o=new Dt;return t.state=o,o.strm=t,o.wrap=s,o.gzhead=null,o.w_bits=a,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=n+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<n+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=e,o.strategy=r,o.method=i,Zt(t)};var Ct={deflateInit:(t,e)=>St(t,e,ct,15,8,_t),deflateInit2:St,deflateReset:Zt,deflateResetKeep:It,deflateSetHeader:(t,e)=>t&&t.state?2!==t.state.wrap?at:(t.state.gzhead=e,et):at,deflate:(t,e)=>{let i,a;if(!t||!t.state||e>tt||e<0)return t?mt(t,at):at;const n=t.state;if(!t.output||!t.input&&0!==t.avail_in||n.status===pt&&e!==Q)return mt(t,0===t.avail_out?rt:at);n.strm=t;const r=n.last_flush;if(n.last_flush=e,42===n.status)if(2===n.wrap)t.adler=0,xt(n,31),xt(n,139),xt(n,8),n.gzhead?(xt(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),xt(n,255&n.gzhead.time),xt(n,n.gzhead.time>>8&255),xt(n,n.gzhead.time>>16&255),xt(n,n.gzhead.time>>24&255),xt(n,9===n.level?2:n.strategy>=ht||n.level<2?4:0),xt(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(xt(n,255&n.gzhead.extra.length),xt(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=W(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(xt(n,0),xt(n,0),xt(n,0),xt(n,0),xt(n,0),xt(n,9===n.level?2:n.strategy>=ht||n.level<2?4:0),xt(n,3),n.status=bt);else{let e=ct+(n.w_bits-8<<4)<<8,i=-1;i=n.strategy>=ht||n.level<2?0:n.level<6?1:6===n.level?2:3,e|=i<<6,0!==n.strstart&&(e|=32),e+=31-e%31,n.status=bt,Ut(n,e),0!==n.strstart&&(Ut(n,t.adler>>>16),Ut(n,65535&t.adler)),t.adler=1}if(69===n.status)if(n.gzhead.extra){for(i=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>i&&(t.adler=W(t.adler,n.pending_buf,n.pending-i,i)),Et(t),i=n.pending,n.pending!==n.pending_buf_size));)xt(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>i&&(t.adler=W(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(t.adler=W(t.adler,n.pending_buf,n.pending-i,i)),Et(t),i=n.pending,n.pending===n.pending_buf_size)){a=1;break}a=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,xt(n,a)}while(0!==a);n.gzhead.hcrc&&n.pending>i&&(t.adler=W(t.adler,n.pending_buf,n.pending-i,i)),0===a&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(t.adler=W(t.adler,n.pending_buf,n.pending-i,i)),Et(t),i=n.pending,n.pending===n.pending_buf_size)){a=1;break}a=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,xt(n,a)}while(0!==a);n.gzhead.hcrc&&n.pending>i&&(t.adler=W(t.adler,n.pending_buf,n.pending-i,i)),0===a&&(n.status=gt)}else n.status=gt;if(n.status===gt&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&Et(t),n.pending+2<=n.pending_buf_size&&(xt(n,255&t.adler),xt(n,t.adler>>8&255),t.adler=0,n.status=bt)):n.status=bt),0!==n.pending){if(Et(t),0===t.avail_out)return n.last_flush=-1,et}else if(0===t.avail_in&&kt(e)<=kt(r)&&e!==Q)return mt(t,rt);if(n.status===pt&&0!==t.avail_in)return mt(t,rt);if(0!==t.avail_in||0!==n.lookahead||e!==X&&n.status!==pt){let i=n.strategy===ht?((t,e)=>{let i;for(;;){if(0===t.lookahead&&(Ot(t),0===t.lookahead)){if(e===X)return 1;break}if(t.match_length=0,i=$(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(At(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===Q?(At(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(At(t,!1),0===t.strm.avail_out)?1:2})(n,e):n.strategy===lt?((t,e)=>{let i,a,n,r;const s=t.window;for(;;){if(t.lookahead<=ut){if(Ot(t),t.lookahead<=ut&&e===X)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(n=t.strstart-1,a=s[n],a===s[++n]&&a===s[++n]&&a===s[++n])){r=t.strstart+ut;do{}while(a===s[++n]&&a===s[++n]&&a===s[++n]&&a===s[++n]&&a===s[++n]&&a===s[++n]&&a===s[++n]&&a===s[++n]&&n<r);t.match_length=ut-(r-n),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(i=$(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=$(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(At(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===Q?(At(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(At(t,!1),0===t.strm.avail_out)?1:2})(n,e):Tt[n.level].func(n,e);if(3!==i&&4!==i||(n.status=pt),1===i||3===i)return 0===t.avail_out&&(n.last_flush=-1),et;if(2===i&&(e===q?V(n):e!==tt&&(Y(n,0,0,!1),e===J&&(yt(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),Et(t),0===t.avail_out))return n.last_flush=-1,et}return e!==Q?et:n.wrap<=0?it:(2===n.wrap?(xt(n,255&t.adler),xt(n,t.adler>>8&255),xt(n,t.adler>>16&255),xt(n,t.adler>>24&255),xt(n,255&t.total_in),xt(n,t.total_in>>8&255),xt(n,t.total_in>>16&255),xt(n,t.total_in>>24&255)):(Ut(n,t.adler>>>16),Ut(n,65535&t.adler)),Et(t),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?et:it)},deflateEnd:t=>{if(!t||!t.state)return at;const e=t.state.status;return 42!==e&&69!==e&&73!==e&&91!==e&&e!==gt&&e!==bt&&e!==pt?mt(t,at):(t.state=null,e===bt?mt(t,nt):et)},deflateSetDictionary:(t,e)=>{let i=e.length;if(!t||!t.state)return at;const a=t.state,n=a.wrap;if(2===n||1===n&&42!==a.status||a.lookahead)return at;if(1===n&&(t.adler=M(t.adler,e,i,0)),a.wrap=0,i>=a.w_size){0===n&&(yt(a.head),a.strstart=0,a.block_start=0,a.insert=0);let t=new Uint8Array(a.w_size);t.set(e.subarray(i-a.w_size,i),0),e=t,i=a.w_size}const r=t.avail_in,s=t.next_in,o=t.input;for(t.avail_in=i,t.next_in=0,t.input=e,Ot(a);a.lookahead>=3;){let t=a.strstart,e=a.lookahead-2;do{a.ins_h=vt(a,a.ins_h,a.window[t+3-1]),a.prev[t&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=t,t++}while(--e);a.strstart=t,a.lookahead=2,Ot(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,t.next_in=s,t.input=o,t.avail_in=r,a.wrap=n,et},deflateInfo:"pako deflate (from Nodeca project)"};const Ft=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Mt=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(const e in i)Ft(i,e)&&(t[e]=i[e])}}return t},Ht=t=>{let e=0;for(let i=0,a=t.length;i<a;i++)e+=t[i].length;const i=new Uint8Array(e);for(let e=0,a=0,n=t.length;e<n;e++){let n=t[e];i.set(n,a),a+=n.length}return i};let Wt=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){Wt=!1}const Kt=new Uint8Array(256);for(let t=0;t<256;t++)Kt[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Kt[254]=Kt[254]=1;var Pt=t=>{let e,i,a,n,r,s=t.length,o=0;for(n=0;n<s;n++)i=t.charCodeAt(n),55296==(64512&i)&&n+1<s&&(a=t.charCodeAt(n+1),56320==(64512&a)&&(i=65536+(i-55296<<10)+(a-56320),n++)),o+=i<128?1:i<2048?2:i<65536?3:4;for(e=new Uint8Array(o),r=0,n=0;r<o;n++)i=t.charCodeAt(n),55296==(64512&i)&&n+1<s&&(a=t.charCodeAt(n+1),56320==(64512&a)&&(i=65536+(i-55296<<10)+(a-56320),n++)),i<128?e[r++]=i:i<2048?(e[r++]=192|i>>>6,e[r++]=128|63&i):i<65536?(e[r++]=224|i>>>12,e[r++]=128|i>>>6&63,e[r++]=128|63&i):(e[r++]=240|i>>>18,e[r++]=128|i>>>12&63,e[r++]=128|i>>>6&63,e[r++]=128|63&i);return e},jt=(t,e)=>{let i,a;const n=e||t.length,r=new Array(2*n);for(a=0,i=0;i<n;){let e=t[i++];if(e<128){r[a++]=e;continue}let s=Kt[e];if(s>4)r[a++]=65533,i+=s-1;else{for(e&=2===s?31:3===s?15:7;s>1&&i<n;)e=e<<6|63&t[i++],s--;s>1?r[a++]=65533:e<65536?r[a++]=e:(e-=65536,r[a++]=55296|e>>10&1023,r[a++]=56320|1023&e)}}return((t,e)=>{if(e<65534&&t.subarray&&Wt)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let i="";for(let a=0;a<e;a++)i+=String.fromCharCode(t[a]);return i})(r,a)},Yt=(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let i=e-1;for(;i>=0&&128==(192&t[i]);)i--;return i<0||0===i?e:i+Kt[t[i]]>e?i:e};var Gt=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const $t=Object.prototype.toString,{Z_NO_FLUSH:Vt,Z_SYNC_FLUSH:Xt,Z_FULL_FLUSH:qt,Z_FINISH:Jt,Z_OK:Qt,Z_STREAM_END:te,Z_DEFAULT_COMPRESSION:ee,Z_DEFAULT_STRATEGY:ie,Z_DEFLATED:ae}=P;function ne(t){this.options=Mt({level:ee,method:ae,chunkSize:16384,windowBits:15,memLevel:8,strategy:ie},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Gt,this.strm.avail_out=0;let i=Ct.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(i!==Qt)throw new Error(K[i]);if(e.header&&Ct.deflateSetHeader(this.strm,e.header),e.dictionary){let t;if(t="string"==typeof e.dictionary?Pt(e.dictionary):"[object ArrayBuffer]"===$t.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,i=Ct.deflateSetDictionary(this.strm,t),i!==Qt)throw new Error(K[i]);this._dict_set=!0}}function re(t,e){const i=new ne(e);if(i.push(t,!0),i.err)throw i.msg||K[i.err];return i.result}ne.prototype.push=function(t,e){const i=this.strm,a=this.options.chunkSize;let n,r;if(this.ended)return!1;for(r=e===~~e?e:!0===e?Jt:Vt,"string"==typeof t?i.input=Pt(t):"[object ArrayBuffer]"===$t.call(t)?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(a),i.next_out=0,i.avail_out=a),(r===Xt||r===qt)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(n=Ct.deflate(i,r),n===te)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),n=Ct.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Qt;if(0!==i.avail_out){if(r>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},ne.prototype.onData=function(t){this.chunks.push(t)},ne.prototype.onEnd=function(t){t===Qt&&(this.result=Ht(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var se={Deflate:ne,deflate:re,deflateRaw:function(t,e){return(e=e||{}).raw=!0,re(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,re(t,e)},constants:P};var oe=function(t,e){let i,a,n,r,s,o,h,l,d,_,f,c,u,w,g,b,p,m,k,y,v,E,A,x;const U=t.state;i=t.next_in,A=t.input,a=i+(t.avail_in-5),n=t.next_out,x=t.output,r=n-(e-t.avail_out),s=n+(t.avail_out-257),o=U.dmax,h=U.wsize,l=U.whave,d=U.wnext,_=U.window,f=U.hold,c=U.bits,u=U.lencode,w=U.distcode,g=(1<<U.lenbits)-1,b=(1<<U.distbits)-1;t:do{c<15&&(f+=A[i++]<<c,c+=8,f+=A[i++]<<c,c+=8),p=u[f&g];e:for(;;){if(m=p>>>24,f>>>=m,c-=m,m=p>>>16&255,0===m)x[n++]=65535&p;else{if(!(16&m)){if(0==(64&m)){p=u[(65535&p)+(f&(1<<m)-1)];continue e}if(32&m){U.mode=12;break t}t.msg="invalid literal/length code",U.mode=30;break t}k=65535&p,m&=15,m&&(c<m&&(f+=A[i++]<<c,c+=8),k+=f&(1<<m)-1,f>>>=m,c-=m),c<15&&(f+=A[i++]<<c,c+=8,f+=A[i++]<<c,c+=8),p=w[f&b];i:for(;;){if(m=p>>>24,f>>>=m,c-=m,m=p>>>16&255,!(16&m)){if(0==(64&m)){p=w[(65535&p)+(f&(1<<m)-1)];continue i}t.msg="invalid distance code",U.mode=30;break t}if(y=65535&p,m&=15,c<m&&(f+=A[i++]<<c,c+=8,c<m&&(f+=A[i++]<<c,c+=8)),y+=f&(1<<m)-1,y>o){t.msg="invalid distance too far back",U.mode=30;break t}if(f>>>=m,c-=m,m=n-r,y>m){if(m=y-m,m>l&&U.sane){t.msg="invalid distance too far back",U.mode=30;break t}if(v=0,E=_,0===d){if(v+=h-m,m<k){k-=m;do{x[n++]=_[v++]}while(--m);v=n-y,E=x}}else if(d<m){if(v+=h+d-m,m-=d,m<k){k-=m;do{x[n++]=_[v++]}while(--m);if(v=0,d<k){m=d,k-=m;do{x[n++]=_[v++]}while(--m);v=n-y,E=x}}}else if(v+=d-m,m<k){k-=m;do{x[n++]=_[v++]}while(--m);v=n-y,E=x}for(;k>2;)x[n++]=E[v++],x[n++]=E[v++],x[n++]=E[v++],k-=3;k&&(x[n++]=E[v++],k>1&&(x[n++]=E[v++]))}else{v=n-y;do{x[n++]=x[v++],x[n++]=x[v++],x[n++]=x[v++],k-=3}while(k>2);k&&(x[n++]=x[v++],k>1&&(x[n++]=x[v++]))}break}}break}}while(i<a&&n<s);k=c>>3,i-=k,c-=k<<3,f&=(1<<c)-1,t.next_in=i,t.next_out=n,t.avail_in=i<a?a-i+5:5-(i-a),t.avail_out=n<s?s-n+257:257-(n-s),U.hold=f,U.bits=c};const he=15,le=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),de=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),_e=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),fe=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ce=(t,e,i,a,n,r,s,o)=>{const h=o.bits;let l,d,_,f,c,u,w=0,g=0,b=0,p=0,m=0,k=0,y=0,v=0,E=0,A=0,x=null,U=0;const z=new Uint16Array(16),R=new Uint16Array(16);let O,N,B,L=null,T=0;for(w=0;w<=he;w++)z[w]=0;for(g=0;g<a;g++)z[e[i+g]]++;for(m=h,p=he;p>=1&&0===z[p];p--);if(m>p&&(m=p),0===p)return n[r++]=20971520,n[r++]=20971520,o.bits=1,0;for(b=1;b<p&&0===z[b];b++);for(m<b&&(m=b),v=1,w=1;w<=he;w++)if(v<<=1,v-=z[w],v<0)return-1;if(v>0&&(0===t||1!==p))return-1;for(R[1]=0,w=1;w<he;w++)R[w+1]=R[w]+z[w];for(g=0;g<a;g++)0!==e[i+g]&&(s[R[e[i+g]]++]=g);if(0===t?(x=L=s,u=19):1===t?(x=le,U-=257,L=de,T-=257,u=256):(x=_e,L=fe,u=-1),A=0,g=0,w=b,c=r,k=m,y=0,_=-1,E=1<<m,f=E-1,1===t&&E>852||2===t&&E>592)return 1;for(;;){O=w-y,s[g]<u?(N=0,B=s[g]):s[g]>u?(N=L[T+s[g]],B=x[U+s[g]]):(N=96,B=0),l=1<<w-y,d=1<<k,b=d;do{d-=l,n[c+(A>>y)+d]=O<<24|N<<16|B|0}while(0!==d);for(l=1<<w-1;A&l;)l>>=1;if(0!==l?(A&=l-1,A+=l):A=0,g++,0==--z[w]){if(w===p)break;w=e[i+s[g]]}if(w>m&&(A&f)!==_){for(0===y&&(y=m),c+=b,k=w-y,v=1<<k;k+y<p&&(v-=z[k+y],!(v<=0));)k++,v<<=1;if(E+=1<<k,1===t&&E>852||2===t&&E>592)return 1;_=A&f,n[_]=m<<24|k<<16|c-r|0}}return 0!==A&&(n[c+A]=w-y<<24|64<<16|0),o.bits=m,0};const{Z_FINISH:ue,Z_BLOCK:we,Z_TREES:ge,Z_OK:be,Z_STREAM_END:pe,Z_NEED_DICT:me,Z_STREAM_ERROR:ke,Z_DATA_ERROR:ye,Z_MEM_ERROR:ve,Z_BUF_ERROR:Ee,Z_DEFLATED:Ae}=P,xe=12,Ue=30,ze=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function Re(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Oe=t=>{if(!t||!t.state)return ke;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,be},Ne=t=>{if(!t||!t.state)return ke;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,Oe(t)},Be=(t,e)=>{let i;if(!t||!t.state)return ke;const a=t.state;return e<0?(i=0,e=-e):(i=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?ke:(null!==a.window&&a.wbits!==e&&(a.window=null),a.wrap=i,a.wbits=e,Ne(t))},Le=(t,e)=>{if(!t)return ke;const i=new Re;t.state=i,i.window=null;const a=Be(t,e);return a!==be&&(t.state=null),a};let Te,De,Ie=!0;const Ze=t=>{if(Ie){Te=new Int32Array(512),De=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(ce(1,t.lens,0,288,Te,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;ce(2,t.lens,0,32,De,0,t.work,{bits:5}),Ie=!1}t.lencode=Te,t.lenbits=9,t.distcode=De,t.distbits=5},Se=(t,e,i,a)=>{let n;const r=t.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),a>=r.wsize?(r.window.set(e.subarray(i-r.wsize,i),0),r.wnext=0,r.whave=r.wsize):(n=r.wsize-r.wnext,n>a&&(n=a),r.window.set(e.subarray(i-a,i-a+n),r.wnext),(a-=n)?(r.window.set(e.subarray(i-a,i),0),r.wnext=a,r.whave=r.wsize):(r.wnext+=n,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=n))),0};var Ce={inflateReset:Ne,inflateReset2:Be,inflateResetKeep:Oe,inflateInit:t=>Le(t,15),inflateInit2:Le,inflate:(t,e)=>{let i,a,n,r,s,o,h,l,d,_,f,c,u,w,g,b,p,m,k,y,v,E,A=0;const x=new Uint8Array(4);let U,z;const R=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return ke;i=t.state,i.mode===xe&&(i.mode=13),s=t.next_out,n=t.output,h=t.avail_out,r=t.next_in,a=t.input,o=t.avail_in,l=i.hold,d=i.bits,_=o,f=h,E=be;t:for(;;)switch(i.mode){case 1:if(0===i.wrap){i.mode=13;break}for(;d<16;){if(0===o)break t;o--,l+=a[r++]<<d,d+=8}if(2&i.wrap&&35615===l){i.check=0,x[0]=255&l,x[1]=l>>>8&255,i.check=W(i.check,x,2,0),l=0,d=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&l)<<8)+(l>>8))%31){t.msg="incorrect header check",i.mode=Ue;break}if((15&l)!==Ae){t.msg="unknown compression method",i.mode=Ue;break}if(l>>>=4,d-=4,v=8+(15&l),0===i.wbits)i.wbits=v;else if(v>i.wbits){t.msg="invalid window size",i.mode=Ue;break}i.dmax=1<<i.wbits,t.adler=i.check=1,i.mode=512&l?10:xe,l=0,d=0;break;case 2:for(;d<16;){if(0===o)break t;o--,l+=a[r++]<<d,d+=8}if(i.flags=l,(255&i.flags)!==Ae){t.msg="unknown compression method",i.mode=Ue;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=Ue;break}i.head&&(i.head.text=l>>8&1),512&i.flags&&(x[0]=255&l,x[1]=l>>>8&255,i.check=W(i.check,x,2,0)),l=0,d=0,i.mode=3;case 3:for(;d<32;){if(0===o)break t;o--,l+=a[r++]<<d,d+=8}i.head&&(i.head.time=l),512&i.flags&&(x[0]=255&l,x[1]=l>>>8&255,x[2]=l>>>16&255,x[3]=l>>>24&255,i.check=W(i.check,x,4,0)),l=0,d=0,i.mode=4;case 4:for(;d<16;){if(0===o)break t;o--,l+=a[r++]<<d,d+=8}i.head&&(i.head.xflags=255&l,i.head.os=l>>8),512&i.flags&&(x[0]=255&l,x[1]=l>>>8&255,i.check=W(i.check,x,2,0)),l=0,d=0,i.mode=5;case 5:if(1024&i.flags){for(;d<16;){if(0===o)break t;o--,l+=a[r++]<<d,d+=8}i.length=l,i.head&&(i.head.extra_len=l),512&i.flags&&(x[0]=255&l,x[1]=l>>>8&255,i.check=W(i.check,x,2,0)),l=0,d=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&(c=i.length,c>o&&(c=o),c&&(i.head&&(v=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(a.subarray(r,r+c),v)),512&i.flags&&(i.check=W(i.check,a,c,r)),o-=c,r+=c,i.length-=c),i.length))break t;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===o)break t;c=0;do{v=a[r+c++],i.head&&v&&i.length<65536&&(i.head.name+=String.fromCharCode(v))}while(v&&c<o);if(512&i.flags&&(i.check=W(i.check,a,c,r)),o-=c,r+=c,v)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===o)break t;c=0;do{v=a[r+c++],i.head&&v&&i.length<65536&&(i.head.comment+=String.fromCharCode(v))}while(v&&c<o);if(512&i.flags&&(i.check=W(i.check,a,c,r)),o-=c,r+=c,v)break t}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;d<16;){if(0===o)break t;o--,l+=a[r++]<<d,d+=8}if(l!==(65535&i.check)){t.msg="header crc mismatch",i.mode=Ue;break}l=0,d=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=xe;break;case 10:for(;d<32;){if(0===o)break t;o--,l+=a[r++]<<d,d+=8}t.adler=i.check=ze(l),l=0,d=0,i.mode=11;case 11:if(0===i.havedict)return t.next_out=s,t.avail_out=h,t.next_in=r,t.avail_in=o,i.hold=l,i.bits=d,me;t.adler=i.check=1,i.mode=xe;case xe:if(e===we||e===ge)break t;case 13:if(i.last){l>>>=7&d,d-=7&d,i.mode=27;break}for(;d<3;){if(0===o)break t;o--,l+=a[r++]<<d,d+=8}switch(i.last=1&l,l>>>=1,d-=1,3&l){case 0:i.mode=14;break;case 1:if(Ze(i),i.mode=20,e===ge){l>>>=2,d-=2;break t}break;case 2:i.mode=17;break;case 3:t.msg="invalid block type",i.mode=Ue}l>>>=2,d-=2;break;case 14:for(l>>>=7&d,d-=7&d;d<32;){if(0===o)break t;o--,l+=a[r++]<<d,d+=8}if((65535&l)!=(l>>>16^65535)){t.msg="invalid stored block lengths",i.mode=Ue;break}if(i.length=65535&l,l=0,d=0,i.mode=15,e===ge)break t;case 15:i.mode=16;case 16:if(c=i.length,c){if(c>o&&(c=o),c>h&&(c=h),0===c)break t;n.set(a.subarray(r,r+c),s),o-=c,r+=c,h-=c,s+=c,i.length-=c;break}i.mode=xe;break;case 17:for(;d<14;){if(0===o)break t;o--,l+=a[r++]<<d,d+=8}if(i.nlen=257+(31&l),l>>>=5,d-=5,i.ndist=1+(31&l),l>>>=5,d-=5,i.ncode=4+(15&l),l>>>=4,d-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=Ue;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;d<3;){if(0===o)break t;o--,l+=a[r++]<<d,d+=8}i.lens[R[i.have++]]=7&l,l>>>=3,d-=3}for(;i.have<19;)i.lens[R[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,U={bits:i.lenbits},E=ce(0,i.lens,0,19,i.lencode,0,i.work,U),i.lenbits=U.bits,E){t.msg="invalid code lengths set",i.mode=Ue;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;A=i.lencode[l&(1<<i.lenbits)-1],g=A>>>24,b=A>>>16&255,p=65535&A,!(g<=d);){if(0===o)break t;o--,l+=a[r++]<<d,d+=8}if(p<16)l>>>=g,d-=g,i.lens[i.have++]=p;else{if(16===p){for(z=g+2;d<z;){if(0===o)break t;o--,l+=a[r++]<<d,d+=8}if(l>>>=g,d-=g,0===i.have){t.msg="invalid bit length repeat",i.mode=Ue;break}v=i.lens[i.have-1],c=3+(3&l),l>>>=2,d-=2}else if(17===p){for(z=g+3;d<z;){if(0===o)break t;o--,l+=a[r++]<<d,d+=8}l>>>=g,d-=g,v=0,c=3+(7&l),l>>>=3,d-=3}else{for(z=g+7;d<z;){if(0===o)break t;o--,l+=a[r++]<<d,d+=8}l>>>=g,d-=g,v=0,c=11+(127&l),l>>>=7,d-=7}if(i.have+c>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=Ue;break}for(;c--;)i.lens[i.have++]=v}}if(i.mode===Ue)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=Ue;break}if(i.lenbits=9,U={bits:i.lenbits},E=ce(1,i.lens,0,i.nlen,i.lencode,0,i.work,U),i.lenbits=U.bits,E){t.msg="invalid literal/lengths set",i.mode=Ue;break}if(i.distbits=6,i.distcode=i.distdyn,U={bits:i.distbits},E=ce(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,U),i.distbits=U.bits,E){t.msg="invalid distances set",i.mode=Ue;break}if(i.mode=20,e===ge)break t;case 20:i.mode=21;case 21:if(o>=6&&h>=258){t.next_out=s,t.avail_out=h,t.next_in=r,t.avail_in=o,i.hold=l,i.bits=d,oe(t,f),s=t.next_out,n=t.output,h=t.avail_out,r=t.next_in,a=t.input,o=t.avail_in,l=i.hold,d=i.bits,i.mode===xe&&(i.back=-1);break}for(i.back=0;A=i.lencode[l&(1<<i.lenbits)-1],g=A>>>24,b=A>>>16&255,p=65535&A,!(g<=d);){if(0===o)break t;o--,l+=a[r++]<<d,d+=8}if(b&&0==(240&b)){for(m=g,k=b,y=p;A=i.lencode[y+((l&(1<<m+k)-1)>>m)],g=A>>>24,b=A>>>16&255,p=65535&A,!(m+g<=d);){if(0===o)break t;o--,l+=a[r++]<<d,d+=8}l>>>=m,d-=m,i.back+=m}if(l>>>=g,d-=g,i.back+=g,i.length=p,0===b){i.mode=26;break}if(32&b){i.back=-1,i.mode=xe;break}if(64&b){t.msg="invalid literal/length code",i.mode=Ue;break}i.extra=15&b,i.mode=22;case 22:if(i.extra){for(z=i.extra;d<z;){if(0===o)break t;o--,l+=a[r++]<<d,d+=8}i.length+=l&(1<<i.extra)-1,l>>>=i.extra,d-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;A=i.distcode[l&(1<<i.distbits)-1],g=A>>>24,b=A>>>16&255,p=65535&A,!(g<=d);){if(0===o)break t;o--,l+=a[r++]<<d,d+=8}if(0==(240&b)){for(m=g,k=b,y=p;A=i.distcode[y+((l&(1<<m+k)-1)>>m)],g=A>>>24,b=A>>>16&255,p=65535&A,!(m+g<=d);){if(0===o)break t;o--,l+=a[r++]<<d,d+=8}l>>>=m,d-=m,i.back+=m}if(l>>>=g,d-=g,i.back+=g,64&b){t.msg="invalid distance code",i.mode=Ue;break}i.offset=p,i.extra=15&b,i.mode=24;case 24:if(i.extra){for(z=i.extra;d<z;){if(0===o)break t;o--,l+=a[r++]<<d,d+=8}i.offset+=l&(1<<i.extra)-1,l>>>=i.extra,d-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=Ue;break}i.mode=25;case 25:if(0===h)break t;if(c=f-h,i.offset>c){if(c=i.offset-c,c>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=Ue;break}c>i.wnext?(c-=i.wnext,u=i.wsize-c):u=i.wnext-c,c>i.length&&(c=i.length),w=i.window}else w=n,u=s-i.offset,c=i.length;c>h&&(c=h),h-=c,i.length-=c;do{n[s++]=w[u++]}while(--c);0===i.length&&(i.mode=21);break;case 26:if(0===h)break t;n[s++]=i.length,h--,i.mode=21;break;case 27:if(i.wrap){for(;d<32;){if(0===o)break t;o--,l|=a[r++]<<d,d+=8}if(f-=h,t.total_out+=f,i.total+=f,f&&(t.adler=i.check=i.flags?W(i.check,n,f,s-f):M(i.check,n,f,s-f)),f=h,(i.flags?l:ze(l))!==i.check){t.msg="incorrect data check",i.mode=Ue;break}l=0,d=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;d<32;){if(0===o)break t;o--,l+=a[r++]<<d,d+=8}if(l!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=Ue;break}l=0,d=0}i.mode=29;case 29:E=pe;break t;case Ue:E=ye;break t;case 31:return ve;case 32:default:return ke}return t.next_out=s,t.avail_out=h,t.next_in=r,t.avail_in=o,i.hold=l,i.bits=d,(i.wsize||f!==t.avail_out&&i.mode<Ue&&(i.mode<27||e!==ue))&&Se(t,t.output,t.next_out,f-t.avail_out),_-=t.avail_in,f-=t.avail_out,t.total_in+=_,t.total_out+=f,i.total+=f,i.wrap&&f&&(t.adler=i.check=i.flags?W(i.check,n,f,t.next_out-f):M(i.check,n,f,t.next_out-f)),t.data_type=i.bits+(i.last?64:0)+(i.mode===xe?128:0)+(20===i.mode||15===i.mode?256:0),(0===_&&0===f||e===ue)&&E===be&&(E=Ee),E},inflateEnd:t=>{if(!t||!t.state)return ke;let e=t.state;return e.window&&(e.window=null),t.state=null,be},inflateGetHeader:(t,e)=>{if(!t||!t.state)return ke;const i=t.state;return 0==(2&i.wrap)?ke:(i.head=e,e.done=!1,be)},inflateSetDictionary:(t,e)=>{const i=e.length;let a,n,r;return t&&t.state?(a=t.state,0!==a.wrap&&11!==a.mode?ke:11===a.mode&&(n=1,n=M(n,e,i,0),n!==a.check)?ye:(r=Se(t,e,i,i),r?(a.mode=31,ve):(a.havedict=1,be))):ke},inflateInfo:"pako inflate (from Nodeca project)"};var Fe=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Me=Object.prototype.toString,{Z_NO_FLUSH:He,Z_FINISH:We,Z_OK:Ke,Z_STREAM_END:Pe,Z_NEED_DICT:je,Z_STREAM_ERROR:Ye,Z_DATA_ERROR:Ge,Z_MEM_ERROR:$e}=P;function Ve(t){this.options=Mt({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Gt,this.strm.avail_out=0;let i=Ce.inflateInit2(this.strm,e.windowBits);if(i!==Ke)throw new Error(K[i]);if(this.header=new Fe,Ce.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=Pt(e.dictionary):"[object ArrayBuffer]"===Me.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(i=Ce.inflateSetDictionary(this.strm,e.dictionary),i!==Ke)))throw new Error(K[i])}function Xe(t,e){const i=new Ve(e);if(i.push(t),i.err)throw i.msg||K[i.err];return i.result}Ve.prototype.push=function(t,e){const i=this.strm,a=this.options.chunkSize,n=this.options.dictionary;let r,s,o;if(this.ended)return!1;for(s=e===~~e?e:!0===e?We:He,"[object ArrayBuffer]"===Me.call(t)?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(a),i.next_out=0,i.avail_out=a),r=Ce.inflate(i,s),r===je&&n&&(r=Ce.inflateSetDictionary(i,n),r===Ke?r=Ce.inflate(i,s):r===Ge&&(r=je));i.avail_in>0&&r===Pe&&i.state.wrap>0&&0!==t[i.next_in];)Ce.inflateReset(i),r=Ce.inflate(i,s);switch(r){case Ye:case Ge:case je:case $e:return this.onEnd(r),this.ended=!0,!1}if(o=i.avail_out,i.next_out&&(0===i.avail_out||r===Pe))if("string"===this.options.to){let t=Yt(i.output,i.next_out),e=i.next_out-t,n=jt(i.output,t);i.next_out=e,i.avail_out=a-e,e&&i.output.set(i.output.subarray(t,t+e),0),this.onData(n)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(r!==Ke||0!==o){if(r===Pe)return r=Ce.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},Ve.prototype.onData=function(t){this.chunks.push(t)},Ve.prototype.onEnd=function(t){t===Ke&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Ht(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var qe={Inflate:Ve,inflate:Xe,inflateRaw:function(t,e){return(e=e||{}).raw=!0,Xe(t,e)},ungzip:Xe,constants:P};const{Deflate:Je,deflate:Qe,deflateRaw:ti,gzip:ei}=se,{Inflate:ii,inflate:ai,inflateRaw:ni,ungzip:ri}=qe;var si=Qe;const oi=[137,80,78,71,13,10,26,10],hi=[];for(let t=0;t<256;t++){let e=t;for(let t=0;t<8;t++)1&e?e=3988292384^e>>>1:e>>>=1;hi[t]=e}const li=4294967295;function di(t,e){return(function(t,e,i){let a=t;for(let t=0;t<i;t++)a=hi[255&(a^e[t])]^a>>>8;return a}(li,t,e)^li)>>>0}var _i,fi,ci,ui;!function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.GREYSCALE=0]="GREYSCALE",t[t.TRUECOLOUR=2]="TRUECOLOUR",t[t.INDEXED_COLOUR=3]="INDEXED_COLOUR",t[t.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",t[t.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"}(_i||(_i={})),function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.DEFLATE=0]="DEFLATE"}(fi||(fi={})),function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.ADAPTIVE=0]="ADAPTIVE"}(ci||(ci={})),function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.NO_INTERLACE=0]="NO_INTERLACE",t[t.ADAM7=1]="ADAM7"}(ui||(ui={}));new Uint8Array(0);const wi=new Uint16Array([255]);new Uint8Array(wi.buffer)[0];const gi={level:3};class PNGEncoder extends IOBuffer_IOBuffer{constructor(t,e={}){super(),this._colorType=_i.UNKNOWN,this._zlibOptions=Object.assign({},gi,e.zlib),this._png=this._checkData(t),this.setBigEndian()}encode(){return this.encodeSignature(),this.encodeIHDR(),this.encodeData(),this.encodeIEND(),this.toArray()}encodeSignature(){this.writeBytes(oi)}encodeIHDR(){this.writeUint32(13),this.writeChars("IHDR"),this.writeUint32(this._png.width),this.writeUint32(this._png.height),this.writeByte(this._png.depth),this.writeByte(this._colorType),this.writeByte(fi.DEFLATE),this.writeByte(ci.ADAPTIVE),this.writeByte(ui.NO_INTERLACE),this.writeCrc(17)}encodeIEND(){this.writeUint32(0),this.writeChars("IEND"),this.writeCrc(4)}encodeIDAT(t){this.writeUint32(t.length),this.writeChars("IDAT"),this.writeBytes(t),this.writeCrc(t.length+4)}encodeData(){const{width:t,height:e,channels:i,depth:a,data:n}=this._png,r=i*t,s=(new IOBuffer_IOBuffer).setBigEndian();let o=0;for(let t=0;t<e;t++)if(s.writeByte(0),8===a)o=pi(n,s,r,o);else{if(16!==a)throw new Error("unreachable");o=mi(n,s,r,o)}const h=s.toArray(),l=si(h,this._zlibOptions);this.encodeIDAT(l)}_checkData(t){const{colorType:e,channels:i,depth:a}=function(t){const{channels:e=4,depth:i=8}=t;if(4!==e&&3!==e&&2!==e&&1!==e)throw new RangeError(`unsupported number of channels: ${e}`);if(8!==i&&16!==i)throw new RangeError(`unsupported bit depth: ${i}`);const a={channels:e,depth:i,colorType:_i.UNKNOWN};switch(e){case 4:a.colorType=_i.TRUECOLOUR_ALPHA;break;case 3:a.colorType=_i.TRUECOLOUR;break;case 1:a.colorType=_i.GREYSCALE;break;case 2:a.colorType=_i.GREYSCALE_ALPHA;break;default:throw new Error("unsupported number of channels")}return a}(t),n={width:bi(t.width,"width"),height:bi(t.height,"height"),channels:i,data:t.data,depth:a,text:{}};this._colorType=e;const r=n.width*n.height*i;if(n.data.length!==r)throw new RangeError(`wrong data size. Found ${n.data.length}, expected ${r}`);return n}writeCrc(t){this.writeUint32(di(new Uint8Array(this.buffer,this.byteOffset+this.offset-t,t),t))}}function bi(t,e){if(Number.isInteger(t)&&t>0)return t;throw new TypeError(`${e} must be a positive integer`)}function pi(t,e,i,a){for(let n=0;n<i;n++)e.writeByte(t[a++]);return a}function mi(t,e,i,a){for(let n=0;n<i;n++)e.writeUint16(t[a++]);return a}var ki;!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.METRE=1]="METRE"}(ki||(ki={})),self.addEventListener("message",(t=>{const{data:e,width:i,height:a,options:n}=t.data,r=function(t,e){return new PNGEncoder(t,e).encode()}({data:new Uint8Array(e),width:i,height:a},n);postMessage({data:r,width:i,height:a},[r])}))})()})();',"Worker",void 0,void 0)}));const Cs=(0,Es.h)((function(){return As()('/*! For license information please see PNGDecoder.worker.worker.js.LICENSE.txt */\n(()=>{"use strict";var t={396:function(){!function(t){if(t.TextEncoder&&t.TextDecoder)return!1;function e(t="utf-8"){if("utf-8"!==t)throw new RangeError(`Failed to construct \'TextEncoder\': The encoding label provided (\'${t}\') is invalid.`)}function i(t="utf-8",e={fatal:!1}){if("utf-8"!==t)throw new RangeError(`Failed to construct \'TextDecoder\': The encoding label provided (\'${t}\') is invalid.`);if(e.fatal)throw new Error("Failed to construct \'TextDecoder\': the \'fatal\' option is unsupported.")}Object.defineProperty(e.prototype,"encoding",{value:"utf-8"}),e.prototype.encode=function(t,e={stream:!1}){if(e.stream)throw new Error("Failed to encode: the \'stream\' option is unsupported.");let i=0;const a=t.length;let n=0,s=Math.max(32,a+(a>>1)+7),r=new Uint8Array(s>>3<<3);for(;i<a;){let e=t.charCodeAt(i++);if(e>=55296&&e<=56319){if(i<a){const a=t.charCodeAt(i);56320==(64512&a)&&(++i,e=((1023&e)<<10)+(1023&a)+65536)}if(e>=55296&&e<=56319)continue}if(n+4>r.length){s+=8,s*=1+i/t.length*2,s=s>>3<<3;const e=new Uint8Array(s);e.set(r),r=e}if(0!=(4294967168&e)){if(0==(4294965248&e))r[n++]=e>>6&31|192;else if(0==(4294901760&e))r[n++]=e>>12&15|224,r[n++]=e>>6&63|128;else{if(0!=(4292870144&e))continue;r[n++]=e>>18&7|240,r[n++]=e>>12&63|128,r[n++]=e>>6&63|128}r[n++]=63&e|128}else r[n++]=e}return r.slice(0,n)},Object.defineProperty(i.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(i.prototype,"fatal",{value:!1}),Object.defineProperty(i.prototype,"ignoreBOM",{value:!1}),i.prototype.decode=function(t,e={stream:!1}){if(e.stream)throw new Error("Failed to decode: the \'stream\' option is unsupported.");const i=new Uint8Array(t);let a=0;const n=i.length,s=[];for(;a<n;){const t=i[a++];if(0===t)break;if(0==(128&t))s.push(t);else if(192==(224&t)){const e=63&i[a++];s.push((31&t)<<6|e)}else if(224==(240&t)){const e=63&i[a++],n=63&i[a++];s.push((31&t)<<12|e<<6|n)}else if(240==(248&t)){let e=(7&t)<<18|(63&i[a++])<<12|(63&i[a++])<<6|63&i[a++];e>65535&&(e-=65536,s.push(e>>>10&1023|55296),e=56320|1023&e),s.push(e)}}return String.fromCharCode.apply(null,s)},t.TextEncoder=e,t.TextDecoder=i}("undefined"!=typeof window?window:"undefined"!=typeof self?self:this)}},e={};function i(a){var n=e[a];if(void 0!==n)return n.exports;var s=e[a]={exports:{}};return t[a].call(s.exports,s,s.exports,i),s.exports}(()=>{i(396);const t=new TextDecoder("utf-8");const e=new TextEncoder;class IOBuffer_IOBuffer{constructor(t=8192,e={}){let i=!1;"number"==typeof t?t=new ArrayBuffer(t):(i=!0,this.lastWrittenByte=t.byteLength);const a=e.offset?e.offset>>>0:0,n=t.byteLength-a;let s=a;(ArrayBuffer.isView(t)||t instanceof IOBuffer_IOBuffer)&&(t.byteLength!==t.buffer.byteLength&&(s=t.byteOffset+a),t=t.buffer),this.lastWrittenByte=i?n:0,this.buffer=t,this.length=n,this.byteLength=n,this.byteOffset=s,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,s,n),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(void 0===t)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const e=2*(this.offset+t),i=new Uint8Array(e);i.set(new Uint8Array(this.buffer)),this.buffer=i.buffer,this.length=this.byteLength=e,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){const e=new Uint8Array(t);for(let i=0;i<t;i++)e[i]=this.readByte();return e}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let e="";for(let i=0;i<t;i++)e+=this.readChar();return e}readUtf8(e=1){return i=this.readBytes(e),t.decode(i);var i}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e));return this}writeUtf8(t){return this.writeBytes(function(t){return e.encode(t)}(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function a(t){let e=t.length;for(;--e>=0;)t[e]=0}const n=256,s=286,r=30,o=15,h=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),l=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),d=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),f=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),_=new Array(576);a(_);const c=new Array(60);a(c);const u=new Array(512);a(u);const w=new Array(256);a(w);const p=new Array(29);a(p);const g=new Array(r);function b(t,e,i,a,n){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=a,this.max_length=n,this.has_stree=t&&t.length}let m,k,y;function v(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}a(g);const E=t=>t<256?u[t]:u[256+(t>>>7)],A=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},x=(t,e,i)=>{t.bi_valid>16-i?(t.bi_buf|=e<<t.bi_valid&65535,A(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=i-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)},U=(t,e,i)=>{x(t,i[2*e],i[2*e+1])},z=(t,e)=>{let i=0;do{i|=1&t,t>>>=1,i<<=1}while(--e>0);return i>>>1},R=(t,e,i)=>{const a=new Array(16);let n,s,r=0;for(n=1;n<=o;n++)a[n]=r=r+i[n-1]<<1;for(s=0;s<=e;s++){let e=t[2*s+1];0!==e&&(t[2*s]=z(a[e]++,e))}},N=t=>{let e;for(e=0;e<s;e++)t.dyn_ltree[2*e]=0;for(e=0;e<r;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0},O=t=>{t.bi_valid>8?A(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},L=(t,e,i,a)=>{const n=2*e,s=2*i;return t[n]<t[s]||t[n]===t[s]&&a[e]<=a[i]},T=(t,e,i)=>{const a=t.heap[i];let n=i<<1;for(;n<=t.heap_len&&(n<t.heap_len&&L(e,t.heap[n+1],t.heap[n],t.depth)&&n++,!L(e,a,t.heap[n],t.depth));)t.heap[i]=t.heap[n],i=n,n<<=1;t.heap[i]=a},D=(t,e,i)=>{let a,s,r,o,d=0;if(0!==t.last_lit)do{a=t.pending_buf[t.d_buf+2*d]<<8|t.pending_buf[t.d_buf+2*d+1],s=t.pending_buf[t.l_buf+d],d++,0===a?U(t,s,e):(r=w[s],U(t,r+n+1,e),o=h[r],0!==o&&(s-=p[r],x(t,s,o)),a--,r=E(a),U(t,r,i),o=l[r],0!==o&&(a-=g[r],x(t,a,o)))}while(d<t.last_lit);U(t,256,e)},I=(t,e)=>{const i=e.dyn_tree,a=e.stat_desc.static_tree,n=e.stat_desc.has_stree,s=e.stat_desc.elems;let r,h,l,d=-1;for(t.heap_len=0,t.heap_max=573,r=0;r<s;r++)0!==i[2*r]?(t.heap[++t.heap_len]=d=r,t.depth[r]=0):i[2*r+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=d<2?++d:0,i[2*l]=1,t.depth[l]=0,t.opt_len--,n&&(t.static_len-=a[2*l+1]);for(e.max_code=d,r=t.heap_len>>1;r>=1;r--)T(t,i,r);l=s;do{r=t.heap[1],t.heap[1]=t.heap[t.heap_len--],T(t,i,1),h=t.heap[1],t.heap[--t.heap_max]=r,t.heap[--t.heap_max]=h,i[2*l]=i[2*r]+i[2*h],t.depth[l]=(t.depth[r]>=t.depth[h]?t.depth[r]:t.depth[h])+1,i[2*r+1]=i[2*h+1]=l,t.heap[1]=l++,T(t,i,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const i=e.dyn_tree,a=e.max_code,n=e.stat_desc.static_tree,s=e.stat_desc.has_stree,r=e.stat_desc.extra_bits,h=e.stat_desc.extra_base,l=e.stat_desc.max_length;let d,f,_,c,u,w,p=0;for(c=0;c<=o;c++)t.bl_count[c]=0;for(i[2*t.heap[t.heap_max]+1]=0,d=t.heap_max+1;d<573;d++)f=t.heap[d],c=i[2*i[2*f+1]+1]+1,c>l&&(c=l,p++),i[2*f+1]=c,f>a||(t.bl_count[c]++,u=0,f>=h&&(u=r[f-h]),w=i[2*f],t.opt_len+=w*(c+u),s&&(t.static_len+=w*(n[2*f+1]+u)));if(0!==p){do{for(c=l-1;0===t.bl_count[c];)c--;t.bl_count[c]--,t.bl_count[c+1]+=2,t.bl_count[l]--,p-=2}while(p>0);for(c=l;0!==c;c--)for(f=t.bl_count[c];0!==f;)_=t.heap[--d],_>a||(i[2*_+1]!==c&&(t.opt_len+=(c-i[2*_+1])*i[2*_],i[2*_+1]=c),f--)}})(t,e),R(i,d,t.bl_count)},S=(t,e,i)=>{let a,n,s=-1,r=e[1],o=0,h=7,l=4;for(0===r&&(h=138,l=3),e[2*(i+1)+1]=65535,a=0;a<=i;a++)n=r,r=e[2*(a+1)+1],++o<h&&n===r||(o<l?t.bl_tree[2*n]+=o:0!==n?(n!==s&&t.bl_tree[2*n]++,t.bl_tree[32]++):o<=10?t.bl_tree[34]++:t.bl_tree[36]++,o=0,s=n,0===r?(h=138,l=3):n===r?(h=6,l=3):(h=7,l=4))},B=(t,e,i)=>{let a,n,s=-1,r=e[1],o=0,h=7,l=4;for(0===r&&(h=138,l=3),a=0;a<=i;a++)if(n=r,r=e[2*(a+1)+1],!(++o<h&&n===r)){if(o<l)do{U(t,n,t.bl_tree)}while(0!=--o);else 0!==n?(n!==s&&(U(t,n,t.bl_tree),o--),U(t,16,t.bl_tree),x(t,o-3,2)):o<=10?(U(t,17,t.bl_tree),x(t,o-3,3)):(U(t,18,t.bl_tree),x(t,o-11,7));o=0,s=n,0===r?(h=138,l=3):n===r?(h=6,l=3):(h=7,l=4)}};let Z=!1;const C=(t,e,i,a)=>{x(t,0+(a?1:0),3),((t,e,i,a)=>{O(t),a&&(A(t,i),A(t,~i)),t.pending_buf.set(t.window.subarray(e,e+i),t.pending),t.pending+=i})(t,e,i,!0)};var F={_tr_init:t=>{Z||((()=>{let t,e,i,a,n;const f=new Array(16);for(i=0,a=0;a<28;a++)for(p[a]=i,t=0;t<1<<h[a];t++)w[i++]=a;for(w[i-1]=a,n=0,a=0;a<16;a++)for(g[a]=n,t=0;t<1<<l[a];t++)u[n++]=a;for(n>>=7;a<r;a++)for(g[a]=n<<7,t=0;t<1<<l[a]-7;t++)u[256+n++]=a;for(e=0;e<=o;e++)f[e]=0;for(t=0;t<=143;)_[2*t+1]=8,t++,f[8]++;for(;t<=255;)_[2*t+1]=9,t++,f[9]++;for(;t<=279;)_[2*t+1]=7,t++,f[7]++;for(;t<=287;)_[2*t+1]=8,t++,f[8]++;for(R(_,287,f),t=0;t<r;t++)c[2*t+1]=5,c[2*t]=z(t,5);m=new b(_,h,257,s,o),k=new b(c,l,0,r,o),y=new b(new Array(0),d,0,19,7)})(),Z=!0),t.l_desc=new v(t.dyn_ltree,m),t.d_desc=new v(t.dyn_dtree,k),t.bl_desc=new v(t.bl_tree,y),t.bi_buf=0,t.bi_valid=0,N(t)},_tr_stored_block:C,_tr_flush_block:(t,e,i,a)=>{let s,r,o=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<n;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0})(t)),I(t,t.l_desc),I(t,t.d_desc),o=(t=>{let e;for(S(t,t.dyn_ltree,t.l_desc.max_code),S(t,t.dyn_dtree,t.d_desc.max_code),I(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*f[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),s=t.opt_len+3+7>>>3,r=t.static_len+3+7>>>3,r<=s&&(s=r)):s=r=i+5,i+4<=s&&-1!==e?C(t,e,i,a):4===t.strategy||r===s?(x(t,2+(a?1:0),3),D(t,_,c)):(x(t,4+(a?1:0),3),((t,e,i,a)=>{let n;for(x(t,e-257,5),x(t,i-1,5),x(t,a-4,4),n=0;n<a;n++)x(t,t.bl_tree[2*f[n]+1],3);B(t,t.dyn_ltree,e-1),B(t,t.dyn_dtree,i-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),D(t,t.dyn_ltree,t.dyn_dtree)),N(t),a&&O(t)},_tr_tally:(t,e,i)=>(t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(w[i]+n+1)]++,t.dyn_dtree[2*E(e)]++),t.last_lit===t.lit_bufsize-1),_tr_align:t=>{x(t,2,3),U(t,256,_),(t=>{16===t.bi_valid?(A(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}};var M=(t,e,i,a)=>{let n=65535&t|0,s=t>>>16&65535|0,r=0;for(;0!==i;){r=i>2e3?2e3:i,i-=r;do{n=n+e[a++]|0,s=s+n|0}while(--r);n%=65521,s%=65521}return n|s<<16|0};const H=new Uint32Array((()=>{let t,e=[];for(var i=0;i<256;i++){t=i;for(var a=0;a<8;a++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e})());var P=(t,e,i,a)=>{const n=H,s=a+i;t^=-1;for(let i=a;i<s;i++)t=t>>>8^n[255&(t^e[i])];return-1^t},W={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},K={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:$,_tr_stored_block:Y,_tr_flush_block:j,_tr_tally:G,_tr_align:X}=F,{Z_NO_FLUSH:V,Z_PARTIAL_FLUSH:q,Z_FULL_FLUSH:J,Z_FINISH:Q,Z_BLOCK:tt,Z_OK:et,Z_STREAM_END:it,Z_STREAM_ERROR:at,Z_DATA_ERROR:nt,Z_BUF_ERROR:st,Z_DEFAULT_COMPRESSION:rt,Z_FILTERED:ot,Z_HUFFMAN_ONLY:ht,Z_RLE:lt,Z_FIXED:dt,Z_DEFAULT_STRATEGY:ft,Z_UNKNOWN:_t,Z_DEFLATED:ct}=K,ut=258,wt=262,pt=103,gt=113,bt=666,mt=(t,e)=>(t.msg=W[e],e),kt=t=>(t<<1)-(t>4?9:0),yt=t=>{let e=t.length;for(;--e>=0;)t[e]=0};let vt=(t,e,i)=>(e<<t.hash_shift^i)&t.hash_mask;const Et=t=>{const e=t.state;let i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+i),t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))},At=(t,e)=>{j(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Et(t.strm)},xt=(t,e)=>{t.pending_buf[t.pending++]=e},Ut=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},zt=(t,e,i,a)=>{let n=t.avail_in;return n>a&&(n=a),0===n?0:(t.avail_in-=n,e.set(t.input.subarray(t.next_in,t.next_in+n),i),1===t.state.wrap?t.adler=M(t.adler,e,n,i):2===t.state.wrap&&(t.adler=P(t.adler,e,n,i)),t.next_in+=n,t.total_in+=n,n)},Rt=(t,e)=>{let i,a,n=t.max_chain_length,s=t.strstart,r=t.prev_length,o=t.nice_match;const h=t.strstart>t.w_size-wt?t.strstart-(t.w_size-wt):0,l=t.window,d=t.w_mask,f=t.prev,_=t.strstart+ut;let c=l[s+r-1],u=l[s+r];t.prev_length>=t.good_match&&(n>>=2),o>t.lookahead&&(o=t.lookahead);do{if(i=e,l[i+r]===u&&l[i+r-1]===c&&l[i]===l[s]&&l[++i]===l[s+1]){s+=2,i++;do{}while(l[++s]===l[++i]&&l[++s]===l[++i]&&l[++s]===l[++i]&&l[++s]===l[++i]&&l[++s]===l[++i]&&l[++s]===l[++i]&&l[++s]===l[++i]&&l[++s]===l[++i]&&s<_);if(a=ut-(_-s),s=_-ut,a>r){if(t.match_start=e,r=a,a>=o)break;c=l[s+r-1],u=l[s+r]}}}while((e=f[e&d])>h&&0!=--n);return r<=t.lookahead?r:t.lookahead},Nt=t=>{const e=t.w_size;let i,a,n,s,r;do{if(s=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-wt)){t.window.set(t.window.subarray(e,e+e),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,a=t.hash_size,i=a;do{n=t.head[--i],t.head[i]=n>=e?n-e:0}while(--a);a=e,i=a;do{n=t.prev[--i],t.prev[i]=n>=e?n-e:0}while(--a);s+=e}if(0===t.strm.avail_in)break;if(a=zt(t.strm,t.window,t.strstart+t.lookahead,s),t.lookahead+=a,t.lookahead+t.insert>=3)for(r=t.strstart-t.insert,t.ins_h=t.window[r],t.ins_h=vt(t,t.ins_h,t.window[r+1]);t.insert&&(t.ins_h=vt(t,t.ins_h,t.window[r+3-1]),t.prev[r&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=r,r++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<wt&&0!==t.strm.avail_in)},Ot=(t,e)=>{let i,a;for(;;){if(t.lookahead<wt){if(Nt(t),t.lookahead<wt&&e===V)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=3&&(t.ins_h=vt(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-wt&&(t.match_length=Rt(t,i)),t.match_length>=3)if(a=G(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=vt(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=vt(t,t.ins_h,t.window[t.strstart+1]);else a=G(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(a&&(At(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===Q?(At(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(At(t,!1),0===t.strm.avail_out)?1:2},Lt=(t,e)=>{let i,a,n;for(;;){if(t.lookahead<wt){if(Nt(t),t.lookahead<wt&&e===V)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=3&&(t.ins_h=vt(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-wt&&(t.match_length=Rt(t,i),t.match_length<=5&&(t.strategy===ot||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){n=t.strstart+t.lookahead-3,a=G(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=n&&(t.ins_h=vt(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,a&&(At(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(a=G(t,0,t.window[t.strstart-1]),a&&At(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(a=G(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===Q?(At(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(At(t,!1),0===t.strm.avail_out)?1:2};function Tt(t,e,i,a,n){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=a,this.func=n}const Dt=[new Tt(0,0,0,0,((t,e)=>{let i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(Nt(t),0===t.lookahead&&e===V)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;const a=t.block_start+i;if((0===t.strstart||t.strstart>=a)&&(t.lookahead=t.strstart-a,t.strstart=a,At(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-wt&&(At(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===Q?(At(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(At(t,!1),t.strm.avail_out),1)})),new Tt(4,4,8,4,Ot),new Tt(4,5,16,8,Ot),new Tt(4,6,32,32,Ot),new Tt(4,4,16,16,Lt),new Tt(8,16,32,32,Lt),new Tt(8,16,128,128,Lt),new Tt(8,32,128,256,Lt),new Tt(32,128,258,1024,Lt),new Tt(32,258,258,4096,Lt)];function It(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ct,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),yt(this.dyn_ltree),yt(this.dyn_dtree),yt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),yt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),yt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const St=t=>{if(!t||!t.state)return mt(t,at);t.total_in=t.total_out=0,t.data_type=_t;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:gt,t.adler=2===e.wrap?0:1,e.last_flush=V,$(e),et},Bt=t=>{const e=St(t);var i;return e===et&&((i=t.state).window_size=2*i.w_size,yt(i.head),i.max_lazy_match=Dt[i.level].max_lazy,i.good_match=Dt[i.level].good_length,i.nice_match=Dt[i.level].nice_length,i.max_chain_length=Dt[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0),e},Zt=(t,e,i,a,n,s)=>{if(!t)return at;let r=1;if(e===rt&&(e=6),a<0?(r=0,a=-a):a>15&&(r=2,a-=16),n<1||n>9||i!==ct||a<8||a>15||e<0||e>9||s<0||s>dt)return mt(t,at);8===a&&(a=9);const o=new It;return t.state=o,o.strm=t,o.wrap=r,o.gzhead=null,o.w_bits=a,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=n+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<n+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=e,o.strategy=s,o.method=i,Bt(t)};var Ct={deflateInit:(t,e)=>Zt(t,e,ct,15,8,ft),deflateInit2:Zt,deflateReset:Bt,deflateResetKeep:St,deflateSetHeader:(t,e)=>t&&t.state?2!==t.state.wrap?at:(t.state.gzhead=e,et):at,deflate:(t,e)=>{let i,a;if(!t||!t.state||e>tt||e<0)return t?mt(t,at):at;const n=t.state;if(!t.output||!t.input&&0!==t.avail_in||n.status===bt&&e!==Q)return mt(t,0===t.avail_out?st:at);n.strm=t;const s=n.last_flush;if(n.last_flush=e,42===n.status)if(2===n.wrap)t.adler=0,xt(n,31),xt(n,139),xt(n,8),n.gzhead?(xt(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),xt(n,255&n.gzhead.time),xt(n,n.gzhead.time>>8&255),xt(n,n.gzhead.time>>16&255),xt(n,n.gzhead.time>>24&255),xt(n,9===n.level?2:n.strategy>=ht||n.level<2?4:0),xt(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(xt(n,255&n.gzhead.extra.length),xt(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=P(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(xt(n,0),xt(n,0),xt(n,0),xt(n,0),xt(n,0),xt(n,9===n.level?2:n.strategy>=ht||n.level<2?4:0),xt(n,3),n.status=gt);else{let e=ct+(n.w_bits-8<<4)<<8,i=-1;i=n.strategy>=ht||n.level<2?0:n.level<6?1:6===n.level?2:3,e|=i<<6,0!==n.strstart&&(e|=32),e+=31-e%31,n.status=gt,Ut(n,e),0!==n.strstart&&(Ut(n,t.adler>>>16),Ut(n,65535&t.adler)),t.adler=1}if(69===n.status)if(n.gzhead.extra){for(i=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>i&&(t.adler=P(t.adler,n.pending_buf,n.pending-i,i)),Et(t),i=n.pending,n.pending!==n.pending_buf_size));)xt(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>i&&(t.adler=P(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(t.adler=P(t.adler,n.pending_buf,n.pending-i,i)),Et(t),i=n.pending,n.pending===n.pending_buf_size)){a=1;break}a=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,xt(n,a)}while(0!==a);n.gzhead.hcrc&&n.pending>i&&(t.adler=P(t.adler,n.pending_buf,n.pending-i,i)),0===a&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(t.adler=P(t.adler,n.pending_buf,n.pending-i,i)),Et(t),i=n.pending,n.pending===n.pending_buf_size)){a=1;break}a=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,xt(n,a)}while(0!==a);n.gzhead.hcrc&&n.pending>i&&(t.adler=P(t.adler,n.pending_buf,n.pending-i,i)),0===a&&(n.status=pt)}else n.status=pt;if(n.status===pt&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&Et(t),n.pending+2<=n.pending_buf_size&&(xt(n,255&t.adler),xt(n,t.adler>>8&255),t.adler=0,n.status=gt)):n.status=gt),0!==n.pending){if(Et(t),0===t.avail_out)return n.last_flush=-1,et}else if(0===t.avail_in&&kt(e)<=kt(s)&&e!==Q)return mt(t,st);if(n.status===bt&&0!==t.avail_in)return mt(t,st);if(0!==t.avail_in||0!==n.lookahead||e!==V&&n.status!==bt){let i=n.strategy===ht?((t,e)=>{let i;for(;;){if(0===t.lookahead&&(Nt(t),0===t.lookahead)){if(e===V)return 1;break}if(t.match_length=0,i=G(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(At(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===Q?(At(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(At(t,!1),0===t.strm.avail_out)?1:2})(n,e):n.strategy===lt?((t,e)=>{let i,a,n,s;const r=t.window;for(;;){if(t.lookahead<=ut){if(Nt(t),t.lookahead<=ut&&e===V)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(n=t.strstart-1,a=r[n],a===r[++n]&&a===r[++n]&&a===r[++n])){s=t.strstart+ut;do{}while(a===r[++n]&&a===r[++n]&&a===r[++n]&&a===r[++n]&&a===r[++n]&&a===r[++n]&&a===r[++n]&&a===r[++n]&&n<s);t.match_length=ut-(s-n),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(i=G(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=G(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(At(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===Q?(At(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(At(t,!1),0===t.strm.avail_out)?1:2})(n,e):Dt[n.level].func(n,e);if(3!==i&&4!==i||(n.status=bt),1===i||3===i)return 0===t.avail_out&&(n.last_flush=-1),et;if(2===i&&(e===q?X(n):e!==tt&&(Y(n,0,0,!1),e===J&&(yt(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),Et(t),0===t.avail_out))return n.last_flush=-1,et}return e!==Q?et:n.wrap<=0?it:(2===n.wrap?(xt(n,255&t.adler),xt(n,t.adler>>8&255),xt(n,t.adler>>16&255),xt(n,t.adler>>24&255),xt(n,255&t.total_in),xt(n,t.total_in>>8&255),xt(n,t.total_in>>16&255),xt(n,t.total_in>>24&255)):(Ut(n,t.adler>>>16),Ut(n,65535&t.adler)),Et(t),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?et:it)},deflateEnd:t=>{if(!t||!t.state)return at;const e=t.state.status;return 42!==e&&69!==e&&73!==e&&91!==e&&e!==pt&&e!==gt&&e!==bt?mt(t,at):(t.state=null,e===gt?mt(t,nt):et)},deflateSetDictionary:(t,e)=>{let i=e.length;if(!t||!t.state)return at;const a=t.state,n=a.wrap;if(2===n||1===n&&42!==a.status||a.lookahead)return at;if(1===n&&(t.adler=M(t.adler,e,i,0)),a.wrap=0,i>=a.w_size){0===n&&(yt(a.head),a.strstart=0,a.block_start=0,a.insert=0);let t=new Uint8Array(a.w_size);t.set(e.subarray(i-a.w_size,i),0),e=t,i=a.w_size}const s=t.avail_in,r=t.next_in,o=t.input;for(t.avail_in=i,t.next_in=0,t.input=e,Nt(a);a.lookahead>=3;){let t=a.strstart,e=a.lookahead-2;do{a.ins_h=vt(a,a.ins_h,a.window[t+3-1]),a.prev[t&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=t,t++}while(--e);a.strstart=t,a.lookahead=2,Nt(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,t.next_in=r,t.input=o,t.avail_in=s,a.wrap=n,et},deflateInfo:"pako deflate (from Nodeca project)"};const Ft=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Mt=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(const e in i)Ft(i,e)&&(t[e]=i[e])}}return t},Ht=t=>{let e=0;for(let i=0,a=t.length;i<a;i++)e+=t[i].length;const i=new Uint8Array(e);for(let e=0,a=0,n=t.length;e<n;e++){let n=t[e];i.set(n,a),a+=n.length}return i};let Pt=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){Pt=!1}const Wt=new Uint8Array(256);for(let t=0;t<256;t++)Wt[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Wt[254]=Wt[254]=1;var Kt=t=>{let e,i,a,n,s,r=t.length,o=0;for(n=0;n<r;n++)i=t.charCodeAt(n),55296==(64512&i)&&n+1<r&&(a=t.charCodeAt(n+1),56320==(64512&a)&&(i=65536+(i-55296<<10)+(a-56320),n++)),o+=i<128?1:i<2048?2:i<65536?3:4;for(e=new Uint8Array(o),s=0,n=0;s<o;n++)i=t.charCodeAt(n),55296==(64512&i)&&n+1<r&&(a=t.charCodeAt(n+1),56320==(64512&a)&&(i=65536+(i-55296<<10)+(a-56320),n++)),i<128?e[s++]=i:i<2048?(e[s++]=192|i>>>6,e[s++]=128|63&i):i<65536?(e[s++]=224|i>>>12,e[s++]=128|i>>>6&63,e[s++]=128|63&i):(e[s++]=240|i>>>18,e[s++]=128|i>>>12&63,e[s++]=128|i>>>6&63,e[s++]=128|63&i);return e},$t=(t,e)=>{let i,a;const n=e||t.length,s=new Array(2*n);for(a=0,i=0;i<n;){let e=t[i++];if(e<128){s[a++]=e;continue}let r=Wt[e];if(r>4)s[a++]=65533,i+=r-1;else{for(e&=2===r?31:3===r?15:7;r>1&&i<n;)e=e<<6|63&t[i++],r--;r>1?s[a++]=65533:e<65536?s[a++]=e:(e-=65536,s[a++]=55296|e>>10&1023,s[a++]=56320|1023&e)}}return((t,e)=>{if(e<65534&&t.subarray&&Pt)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let i="";for(let a=0;a<e;a++)i+=String.fromCharCode(t[a]);return i})(s,a)},Yt=(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let i=e-1;for(;i>=0&&128==(192&t[i]);)i--;return i<0||0===i?e:i+Wt[t[i]]>e?i:e};var jt=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Gt=Object.prototype.toString,{Z_NO_FLUSH:Xt,Z_SYNC_FLUSH:Vt,Z_FULL_FLUSH:qt,Z_FINISH:Jt,Z_OK:Qt,Z_STREAM_END:te,Z_DEFAULT_COMPRESSION:ee,Z_DEFAULT_STRATEGY:ie,Z_DEFLATED:ae}=K;function ne(t){this.options=Mt({level:ee,method:ae,chunkSize:16384,windowBits:15,memLevel:8,strategy:ie},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new jt,this.strm.avail_out=0;let i=Ct.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(i!==Qt)throw new Error(W[i]);if(e.header&&Ct.deflateSetHeader(this.strm,e.header),e.dictionary){let t;if(t="string"==typeof e.dictionary?Kt(e.dictionary):"[object ArrayBuffer]"===Gt.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,i=Ct.deflateSetDictionary(this.strm,t),i!==Qt)throw new Error(W[i]);this._dict_set=!0}}function se(t,e){const i=new ne(e);if(i.push(t,!0),i.err)throw i.msg||W[i.err];return i.result}ne.prototype.push=function(t,e){const i=this.strm,a=this.options.chunkSize;let n,s;if(this.ended)return!1;for(s=e===~~e?e:!0===e?Jt:Xt,"string"==typeof t?i.input=Kt(t):"[object ArrayBuffer]"===Gt.call(t)?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(a),i.next_out=0,i.avail_out=a),(s===Vt||s===qt)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(n=Ct.deflate(i,s),n===te)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),n=Ct.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Qt;if(0!==i.avail_out){if(s>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},ne.prototype.onData=function(t){this.chunks.push(t)},ne.prototype.onEnd=function(t){t===Qt&&(this.result=Ht(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var re={Deflate:ne,deflate:se,deflateRaw:function(t,e){return(e=e||{}).raw=!0,se(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,se(t,e)},constants:K};var oe=function(t,e){let i,a,n,s,r,o,h,l,d,f,_,c,u,w,p,g,b,m,k,y,v,E,A,x;const U=t.state;i=t.next_in,A=t.input,a=i+(t.avail_in-5),n=t.next_out,x=t.output,s=n-(e-t.avail_out),r=n+(t.avail_out-257),o=U.dmax,h=U.wsize,l=U.whave,d=U.wnext,f=U.window,_=U.hold,c=U.bits,u=U.lencode,w=U.distcode,p=(1<<U.lenbits)-1,g=(1<<U.distbits)-1;t:do{c<15&&(_+=A[i++]<<c,c+=8,_+=A[i++]<<c,c+=8),b=u[_&p];e:for(;;){if(m=b>>>24,_>>>=m,c-=m,m=b>>>16&255,0===m)x[n++]=65535&b;else{if(!(16&m)){if(0==(64&m)){b=u[(65535&b)+(_&(1<<m)-1)];continue e}if(32&m){U.mode=12;break t}t.msg="invalid literal/length code",U.mode=30;break t}k=65535&b,m&=15,m&&(c<m&&(_+=A[i++]<<c,c+=8),k+=_&(1<<m)-1,_>>>=m,c-=m),c<15&&(_+=A[i++]<<c,c+=8,_+=A[i++]<<c,c+=8),b=w[_&g];i:for(;;){if(m=b>>>24,_>>>=m,c-=m,m=b>>>16&255,!(16&m)){if(0==(64&m)){b=w[(65535&b)+(_&(1<<m)-1)];continue i}t.msg="invalid distance code",U.mode=30;break t}if(y=65535&b,m&=15,c<m&&(_+=A[i++]<<c,c+=8,c<m&&(_+=A[i++]<<c,c+=8)),y+=_&(1<<m)-1,y>o){t.msg="invalid distance too far back",U.mode=30;break t}if(_>>>=m,c-=m,m=n-s,y>m){if(m=y-m,m>l&&U.sane){t.msg="invalid distance too far back",U.mode=30;break t}if(v=0,E=f,0===d){if(v+=h-m,m<k){k-=m;do{x[n++]=f[v++]}while(--m);v=n-y,E=x}}else if(d<m){if(v+=h+d-m,m-=d,m<k){k-=m;do{x[n++]=f[v++]}while(--m);if(v=0,d<k){m=d,k-=m;do{x[n++]=f[v++]}while(--m);v=n-y,E=x}}}else if(v+=d-m,m<k){k-=m;do{x[n++]=f[v++]}while(--m);v=n-y,E=x}for(;k>2;)x[n++]=E[v++],x[n++]=E[v++],x[n++]=E[v++],k-=3;k&&(x[n++]=E[v++],k>1&&(x[n++]=E[v++]))}else{v=n-y;do{x[n++]=x[v++],x[n++]=x[v++],x[n++]=x[v++],k-=3}while(k>2);k&&(x[n++]=x[v++],k>1&&(x[n++]=x[v++]))}break}}break}}while(i<a&&n<r);k=c>>3,i-=k,c-=k<<3,_&=(1<<c)-1,t.next_in=i,t.next_out=n,t.avail_in=i<a?a-i+5:5-(i-a),t.avail_out=n<r?r-n+257:257-(n-r),U.hold=_,U.bits=c};const he=15,le=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),de=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),fe=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),_e=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ce=(t,e,i,a,n,s,r,o)=>{const h=o.bits;let l,d,f,_,c,u,w=0,p=0,g=0,b=0,m=0,k=0,y=0,v=0,E=0,A=0,x=null,U=0;const z=new Uint16Array(16),R=new Uint16Array(16);let N,O,L,T=null,D=0;for(w=0;w<=he;w++)z[w]=0;for(p=0;p<a;p++)z[e[i+p]]++;for(m=h,b=he;b>=1&&0===z[b];b--);if(m>b&&(m=b),0===b)return n[s++]=20971520,n[s++]=20971520,o.bits=1,0;for(g=1;g<b&&0===z[g];g++);for(m<g&&(m=g),v=1,w=1;w<=he;w++)if(v<<=1,v-=z[w],v<0)return-1;if(v>0&&(0===t||1!==b))return-1;for(R[1]=0,w=1;w<he;w++)R[w+1]=R[w]+z[w];for(p=0;p<a;p++)0!==e[i+p]&&(r[R[e[i+p]]++]=p);if(0===t?(x=T=r,u=19):1===t?(x=le,U-=257,T=de,D-=257,u=256):(x=fe,T=_e,u=-1),A=0,p=0,w=g,c=s,k=m,y=0,f=-1,E=1<<m,_=E-1,1===t&&E>852||2===t&&E>592)return 1;for(;;){N=w-y,r[p]<u?(O=0,L=r[p]):r[p]>u?(O=T[D+r[p]],L=x[U+r[p]]):(O=96,L=0),l=1<<w-y,d=1<<k,g=d;do{d-=l,n[c+(A>>y)+d]=N<<24|O<<16|L|0}while(0!==d);for(l=1<<w-1;A&l;)l>>=1;if(0!==l?(A&=l-1,A+=l):A=0,p++,0==--z[w]){if(w===b)break;w=e[i+r[p]]}if(w>m&&(A&_)!==f){for(0===y&&(y=m),c+=g,k=w-y,v=1<<k;k+y<b&&(v-=z[k+y],!(v<=0));)k++,v<<=1;if(E+=1<<k,1===t&&E>852||2===t&&E>592)return 1;f=A&_,n[f]=m<<24|k<<16|c-s|0}}return 0!==A&&(n[c+A]=w-y<<24|64<<16|0),o.bits=m,0};const{Z_FINISH:ue,Z_BLOCK:we,Z_TREES:pe,Z_OK:ge,Z_STREAM_END:be,Z_NEED_DICT:me,Z_STREAM_ERROR:ke,Z_DATA_ERROR:ye,Z_MEM_ERROR:ve,Z_BUF_ERROR:Ee,Z_DEFLATED:Ae}=K,xe=12,Ue=30,ze=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function Re(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ne=t=>{if(!t||!t.state)return ke;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,ge},Oe=t=>{if(!t||!t.state)return ke;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,Ne(t)},Le=(t,e)=>{let i;if(!t||!t.state)return ke;const a=t.state;return e<0?(i=0,e=-e):(i=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?ke:(null!==a.window&&a.wbits!==e&&(a.window=null),a.wrap=i,a.wbits=e,Oe(t))},Te=(t,e)=>{if(!t)return ke;const i=new Re;t.state=i,i.window=null;const a=Le(t,e);return a!==ge&&(t.state=null),a};let De,Ie,Se=!0;const Be=t=>{if(Se){De=new Int32Array(512),Ie=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(ce(1,t.lens,0,288,De,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;ce(2,t.lens,0,32,Ie,0,t.work,{bits:5}),Se=!1}t.lencode=De,t.lenbits=9,t.distcode=Ie,t.distbits=5},Ze=(t,e,i,a)=>{let n;const s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),a>=s.wsize?(s.window.set(e.subarray(i-s.wsize,i),0),s.wnext=0,s.whave=s.wsize):(n=s.wsize-s.wnext,n>a&&(n=a),s.window.set(e.subarray(i-a,i-a+n),s.wnext),(a-=n)?(s.window.set(e.subarray(i-a,i),0),s.wnext=a,s.whave=s.wsize):(s.wnext+=n,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=n))),0};var Ce={inflateReset:Oe,inflateReset2:Le,inflateResetKeep:Ne,inflateInit:t=>Te(t,15),inflateInit2:Te,inflate:(t,e)=>{let i,a,n,s,r,o,h,l,d,f,_,c,u,w,p,g,b,m,k,y,v,E,A=0;const x=new Uint8Array(4);let U,z;const R=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return ke;i=t.state,i.mode===xe&&(i.mode=13),r=t.next_out,n=t.output,h=t.avail_out,s=t.next_in,a=t.input,o=t.avail_in,l=i.hold,d=i.bits,f=o,_=h,E=ge;t:for(;;)switch(i.mode){case 1:if(0===i.wrap){i.mode=13;break}for(;d<16;){if(0===o)break t;o--,l+=a[s++]<<d,d+=8}if(2&i.wrap&&35615===l){i.check=0,x[0]=255&l,x[1]=l>>>8&255,i.check=P(i.check,x,2,0),l=0,d=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&l)<<8)+(l>>8))%31){t.msg="incorrect header check",i.mode=Ue;break}if((15&l)!==Ae){t.msg="unknown compression method",i.mode=Ue;break}if(l>>>=4,d-=4,v=8+(15&l),0===i.wbits)i.wbits=v;else if(v>i.wbits){t.msg="invalid window size",i.mode=Ue;break}i.dmax=1<<i.wbits,t.adler=i.check=1,i.mode=512&l?10:xe,l=0,d=0;break;case 2:for(;d<16;){if(0===o)break t;o--,l+=a[s++]<<d,d+=8}if(i.flags=l,(255&i.flags)!==Ae){t.msg="unknown compression method",i.mode=Ue;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=Ue;break}i.head&&(i.head.text=l>>8&1),512&i.flags&&(x[0]=255&l,x[1]=l>>>8&255,i.check=P(i.check,x,2,0)),l=0,d=0,i.mode=3;case 3:for(;d<32;){if(0===o)break t;o--,l+=a[s++]<<d,d+=8}i.head&&(i.head.time=l),512&i.flags&&(x[0]=255&l,x[1]=l>>>8&255,x[2]=l>>>16&255,x[3]=l>>>24&255,i.check=P(i.check,x,4,0)),l=0,d=0,i.mode=4;case 4:for(;d<16;){if(0===o)break t;o--,l+=a[s++]<<d,d+=8}i.head&&(i.head.xflags=255&l,i.head.os=l>>8),512&i.flags&&(x[0]=255&l,x[1]=l>>>8&255,i.check=P(i.check,x,2,0)),l=0,d=0,i.mode=5;case 5:if(1024&i.flags){for(;d<16;){if(0===o)break t;o--,l+=a[s++]<<d,d+=8}i.length=l,i.head&&(i.head.extra_len=l),512&i.flags&&(x[0]=255&l,x[1]=l>>>8&255,i.check=P(i.check,x,2,0)),l=0,d=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&(c=i.length,c>o&&(c=o),c&&(i.head&&(v=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(a.subarray(s,s+c),v)),512&i.flags&&(i.check=P(i.check,a,c,s)),o-=c,s+=c,i.length-=c),i.length))break t;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===o)break t;c=0;do{v=a[s+c++],i.head&&v&&i.length<65536&&(i.head.name+=String.fromCharCode(v))}while(v&&c<o);if(512&i.flags&&(i.check=P(i.check,a,c,s)),o-=c,s+=c,v)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===o)break t;c=0;do{v=a[s+c++],i.head&&v&&i.length<65536&&(i.head.comment+=String.fromCharCode(v))}while(v&&c<o);if(512&i.flags&&(i.check=P(i.check,a,c,s)),o-=c,s+=c,v)break t}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;d<16;){if(0===o)break t;o--,l+=a[s++]<<d,d+=8}if(l!==(65535&i.check)){t.msg="header crc mismatch",i.mode=Ue;break}l=0,d=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=xe;break;case 10:for(;d<32;){if(0===o)break t;o--,l+=a[s++]<<d,d+=8}t.adler=i.check=ze(l),l=0,d=0,i.mode=11;case 11:if(0===i.havedict)return t.next_out=r,t.avail_out=h,t.next_in=s,t.avail_in=o,i.hold=l,i.bits=d,me;t.adler=i.check=1,i.mode=xe;case xe:if(e===we||e===pe)break t;case 13:if(i.last){l>>>=7&d,d-=7&d,i.mode=27;break}for(;d<3;){if(0===o)break t;o--,l+=a[s++]<<d,d+=8}switch(i.last=1&l,l>>>=1,d-=1,3&l){case 0:i.mode=14;break;case 1:if(Be(i),i.mode=20,e===pe){l>>>=2,d-=2;break t}break;case 2:i.mode=17;break;case 3:t.msg="invalid block type",i.mode=Ue}l>>>=2,d-=2;break;case 14:for(l>>>=7&d,d-=7&d;d<32;){if(0===o)break t;o--,l+=a[s++]<<d,d+=8}if((65535&l)!=(l>>>16^65535)){t.msg="invalid stored block lengths",i.mode=Ue;break}if(i.length=65535&l,l=0,d=0,i.mode=15,e===pe)break t;case 15:i.mode=16;case 16:if(c=i.length,c){if(c>o&&(c=o),c>h&&(c=h),0===c)break t;n.set(a.subarray(s,s+c),r),o-=c,s+=c,h-=c,r+=c,i.length-=c;break}i.mode=xe;break;case 17:for(;d<14;){if(0===o)break t;o--,l+=a[s++]<<d,d+=8}if(i.nlen=257+(31&l),l>>>=5,d-=5,i.ndist=1+(31&l),l>>>=5,d-=5,i.ncode=4+(15&l),l>>>=4,d-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=Ue;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;d<3;){if(0===o)break t;o--,l+=a[s++]<<d,d+=8}i.lens[R[i.have++]]=7&l,l>>>=3,d-=3}for(;i.have<19;)i.lens[R[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,U={bits:i.lenbits},E=ce(0,i.lens,0,19,i.lencode,0,i.work,U),i.lenbits=U.bits,E){t.msg="invalid code lengths set",i.mode=Ue;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;A=i.lencode[l&(1<<i.lenbits)-1],p=A>>>24,g=A>>>16&255,b=65535&A,!(p<=d);){if(0===o)break t;o--,l+=a[s++]<<d,d+=8}if(b<16)l>>>=p,d-=p,i.lens[i.have++]=b;else{if(16===b){for(z=p+2;d<z;){if(0===o)break t;o--,l+=a[s++]<<d,d+=8}if(l>>>=p,d-=p,0===i.have){t.msg="invalid bit length repeat",i.mode=Ue;break}v=i.lens[i.have-1],c=3+(3&l),l>>>=2,d-=2}else if(17===b){for(z=p+3;d<z;){if(0===o)break t;o--,l+=a[s++]<<d,d+=8}l>>>=p,d-=p,v=0,c=3+(7&l),l>>>=3,d-=3}else{for(z=p+7;d<z;){if(0===o)break t;o--,l+=a[s++]<<d,d+=8}l>>>=p,d-=p,v=0,c=11+(127&l),l>>>=7,d-=7}if(i.have+c>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=Ue;break}for(;c--;)i.lens[i.have++]=v}}if(i.mode===Ue)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=Ue;break}if(i.lenbits=9,U={bits:i.lenbits},E=ce(1,i.lens,0,i.nlen,i.lencode,0,i.work,U),i.lenbits=U.bits,E){t.msg="invalid literal/lengths set",i.mode=Ue;break}if(i.distbits=6,i.distcode=i.distdyn,U={bits:i.distbits},E=ce(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,U),i.distbits=U.bits,E){t.msg="invalid distances set",i.mode=Ue;break}if(i.mode=20,e===pe)break t;case 20:i.mode=21;case 21:if(o>=6&&h>=258){t.next_out=r,t.avail_out=h,t.next_in=s,t.avail_in=o,i.hold=l,i.bits=d,oe(t,_),r=t.next_out,n=t.output,h=t.avail_out,s=t.next_in,a=t.input,o=t.avail_in,l=i.hold,d=i.bits,i.mode===xe&&(i.back=-1);break}for(i.back=0;A=i.lencode[l&(1<<i.lenbits)-1],p=A>>>24,g=A>>>16&255,b=65535&A,!(p<=d);){if(0===o)break t;o--,l+=a[s++]<<d,d+=8}if(g&&0==(240&g)){for(m=p,k=g,y=b;A=i.lencode[y+((l&(1<<m+k)-1)>>m)],p=A>>>24,g=A>>>16&255,b=65535&A,!(m+p<=d);){if(0===o)break t;o--,l+=a[s++]<<d,d+=8}l>>>=m,d-=m,i.back+=m}if(l>>>=p,d-=p,i.back+=p,i.length=b,0===g){i.mode=26;break}if(32&g){i.back=-1,i.mode=xe;break}if(64&g){t.msg="invalid literal/length code",i.mode=Ue;break}i.extra=15&g,i.mode=22;case 22:if(i.extra){for(z=i.extra;d<z;){if(0===o)break t;o--,l+=a[s++]<<d,d+=8}i.length+=l&(1<<i.extra)-1,l>>>=i.extra,d-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;A=i.distcode[l&(1<<i.distbits)-1],p=A>>>24,g=A>>>16&255,b=65535&A,!(p<=d);){if(0===o)break t;o--,l+=a[s++]<<d,d+=8}if(0==(240&g)){for(m=p,k=g,y=b;A=i.distcode[y+((l&(1<<m+k)-1)>>m)],p=A>>>24,g=A>>>16&255,b=65535&A,!(m+p<=d);){if(0===o)break t;o--,l+=a[s++]<<d,d+=8}l>>>=m,d-=m,i.back+=m}if(l>>>=p,d-=p,i.back+=p,64&g){t.msg="invalid distance code",i.mode=Ue;break}i.offset=b,i.extra=15&g,i.mode=24;case 24:if(i.extra){for(z=i.extra;d<z;){if(0===o)break t;o--,l+=a[s++]<<d,d+=8}i.offset+=l&(1<<i.extra)-1,l>>>=i.extra,d-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=Ue;break}i.mode=25;case 25:if(0===h)break t;if(c=_-h,i.offset>c){if(c=i.offset-c,c>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=Ue;break}c>i.wnext?(c-=i.wnext,u=i.wsize-c):u=i.wnext-c,c>i.length&&(c=i.length),w=i.window}else w=n,u=r-i.offset,c=i.length;c>h&&(c=h),h-=c,i.length-=c;do{n[r++]=w[u++]}while(--c);0===i.length&&(i.mode=21);break;case 26:if(0===h)break t;n[r++]=i.length,h--,i.mode=21;break;case 27:if(i.wrap){for(;d<32;){if(0===o)break t;o--,l|=a[s++]<<d,d+=8}if(_-=h,t.total_out+=_,i.total+=_,_&&(t.adler=i.check=i.flags?P(i.check,n,_,r-_):M(i.check,n,_,r-_)),_=h,(i.flags?l:ze(l))!==i.check){t.msg="incorrect data check",i.mode=Ue;break}l=0,d=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;d<32;){if(0===o)break t;o--,l+=a[s++]<<d,d+=8}if(l!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=Ue;break}l=0,d=0}i.mode=29;case 29:E=be;break t;case Ue:E=ye;break t;case 31:return ve;case 32:default:return ke}return t.next_out=r,t.avail_out=h,t.next_in=s,t.avail_in=o,i.hold=l,i.bits=d,(i.wsize||_!==t.avail_out&&i.mode<Ue&&(i.mode<27||e!==ue))&&Ze(t,t.output,t.next_out,_-t.avail_out),f-=t.avail_in,_-=t.avail_out,t.total_in+=f,t.total_out+=_,i.total+=_,i.wrap&&_&&(t.adler=i.check=i.flags?P(i.check,n,_,t.next_out-_):M(i.check,n,_,t.next_out-_)),t.data_type=i.bits+(i.last?64:0)+(i.mode===xe?128:0)+(20===i.mode||15===i.mode?256:0),(0===f&&0===_||e===ue)&&E===ge&&(E=Ee),E},inflateEnd:t=>{if(!t||!t.state)return ke;let e=t.state;return e.window&&(e.window=null),t.state=null,ge},inflateGetHeader:(t,e)=>{if(!t||!t.state)return ke;const i=t.state;return 0==(2&i.wrap)?ke:(i.head=e,e.done=!1,ge)},inflateSetDictionary:(t,e)=>{const i=e.length;let a,n,s;return t&&t.state?(a=t.state,0!==a.wrap&&11!==a.mode?ke:11===a.mode&&(n=1,n=M(n,e,i,0),n!==a.check)?ye:(s=Ze(t,e,i,i),s?(a.mode=31,ve):(a.havedict=1,ge))):ke},inflateInfo:"pako inflate (from Nodeca project)"};var Fe=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Me=Object.prototype.toString,{Z_NO_FLUSH:He,Z_FINISH:Pe,Z_OK:We,Z_STREAM_END:Ke,Z_NEED_DICT:$e,Z_STREAM_ERROR:Ye,Z_DATA_ERROR:je,Z_MEM_ERROR:Ge}=K;function Xe(t){this.options=Mt({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new jt,this.strm.avail_out=0;let i=Ce.inflateInit2(this.strm,e.windowBits);if(i!==We)throw new Error(W[i]);if(this.header=new Fe,Ce.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=Kt(e.dictionary):"[object ArrayBuffer]"===Me.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(i=Ce.inflateSetDictionary(this.strm,e.dictionary),i!==We)))throw new Error(W[i])}function Ve(t,e){const i=new Xe(e);if(i.push(t),i.err)throw i.msg||W[i.err];return i.result}Xe.prototype.push=function(t,e){const i=this.strm,a=this.options.chunkSize,n=this.options.dictionary;let s,r,o;if(this.ended)return!1;for(r=e===~~e?e:!0===e?Pe:He,"[object ArrayBuffer]"===Me.call(t)?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(a),i.next_out=0,i.avail_out=a),s=Ce.inflate(i,r),s===$e&&n&&(s=Ce.inflateSetDictionary(i,n),s===We?s=Ce.inflate(i,r):s===je&&(s=$e));i.avail_in>0&&s===Ke&&i.state.wrap>0&&0!==t[i.next_in];)Ce.inflateReset(i),s=Ce.inflate(i,r);switch(s){case Ye:case je:case $e:case Ge:return this.onEnd(s),this.ended=!0,!1}if(o=i.avail_out,i.next_out&&(0===i.avail_out||s===Ke))if("string"===this.options.to){let t=Yt(i.output,i.next_out),e=i.next_out-t,n=$t(i.output,t);i.next_out=e,i.avail_out=a-e,e&&i.output.set(i.output.subarray(t,t+e),0),this.onData(n)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(s!==We||0!==o){if(s===Ke)return s=Ce.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},Xe.prototype.onData=function(t){this.chunks.push(t)},Xe.prototype.onEnd=function(t){t===We&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Ht(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var qe={Inflate:Xe,inflate:Ve,inflateRaw:function(t,e){return(e=e||{}).raw=!0,Ve(t,e)},ungzip:Ve,constants:K};const{Deflate:Je,deflate:Qe,deflateRaw:ti,gzip:ei}=re,{Inflate:ii,inflate:ai,inflateRaw:ni,ungzip:si}=qe;var ri=ii;const oi=[137,80,78,71,13,10,26,10],hi=[];for(let t=0;t<256;t++){let e=t;for(let t=0;t<8;t++)1&e?e=3988292384^e>>>1:e>>>=1;hi[t]=e}const li=4294967295;function di(t,e){return(function(t,e,i){let a=t;for(let t=0;t<i;t++)a=hi[255&(a^e[t])]^a>>>8;return a}(li,t,e)^li)>>>0}var fi,_i,ci,ui;!function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.GREYSCALE=0]="GREYSCALE",t[t.TRUECOLOUR=2]="TRUECOLOUR",t[t.INDEXED_COLOUR=3]="INDEXED_COLOUR",t[t.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",t[t.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"}(fi||(fi={})),function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.DEFLATE=0]="DEFLATE"}(_i||(_i={})),function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.ADAPTIVE=0]="ADAPTIVE"}(ci||(ci={})),function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.NO_INTERLACE=0]="NO_INTERLACE",t[t.ADAM7=1]="ADAM7"}(ui||(ui={}));const wi=new Uint8Array(0),pi=new Uint16Array([255]),gi=255===new Uint8Array(pi.buffer)[0];class PNGDecoder extends IOBuffer_IOBuffer{constructor(t,e={}){super(t);const{checkCrc:i=!1}=e;this._checkCrc=i,this._inflator=new ri,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._compressionMethod=_i.UNKNOWN,this._filterMethod=ci.UNKNOWN,this._interlaceMethod=ui.UNKNOWN,this._colorType=-1,this.setBigEndian()}decode(){for(this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(let t=0;t<oi.length;t++)if(this.readUint8()!==oi[t])throw new Error(`wrong PNG signature. Byte at ${t} should be ${oi[t]}.`)}decodeChunk(){const t=this.readUint32(),e=this.readChars(4),i=this.offset;switch(e){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(t);break;case"IDAT":this.decodeIDAT(t);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(t);break;case"tEXt":this.decodetEXt(t);break;case"pHYs":this.decodepHYs();break;default:this.skip(t)}if(this.offset-i!==t)throw new Error(`Length mismatch while decoding chunk ${e}`);if(this._checkCrc){const i=this.readUint32(),a=t+4,n=di(new Uint8Array(this.buffer,this.byteOffset+this.offset-a-4,a),a);if(n!==i)throw new Error(`CRC mismatch for chunk ${e}. Expected ${i}, found ${n}`)}else this.skip(4)}decodeIHDR(){const t=this._png;t.width=this.readUint32(),t.height=this.readUint32(),t.depth=function(t){if(1!==t&&2!==t&&4!==t&&8!==t&&16!==t)throw new Error(`invalid bit depth: ${t}`);return t}(this.readUint8());const e=this.readUint8();let i;switch(this._colorType=e,e){case fi.GREYSCALE:i=1;break;case fi.TRUECOLOUR:i=3;break;case fi.INDEXED_COLOUR:i=1;break;case fi.GREYSCALE_ALPHA:i=2;break;case fi.TRUECOLOUR_ALPHA:i=4;break;default:throw new Error(`Unknown color type: ${e}`)}if(this._png.channels=i,this._compressionMethod=this.readUint8(),this._compressionMethod!==_i.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(t){if(t%3!=0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${t}`);const e=t/3;this._hasPalette=!0;const i=[];this._palette=i;for(let t=0;t<e;t++)i.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(t){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,t)),this.skip(t)}decodetRNS(t){if(3===this._colorType){if(t>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${t} vs ${this._palette.length})`);let e=0;for(;e<t;e++){const t=this.readByte();this._palette[e].push(t)}for(;e<this._palette.length;e++)this._palette[e].push(255)}}decodetEXt(t){let e,i="";for(;"\\0"!==(e=this.readChar());)i+=e;this._png.text[i]=this.readChars(t-i.length-1)}decodepHYs(){const t=this.readUint32(),e=this.readUint32(),i=this.readByte();this._png.resolution={x:t,y:e,unit:i}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const t=this._inflator.result;if(this._filterMethod!==ci.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod!==ui.NO_INTERLACE)throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this.decodeInterlaceNull(t)}decodeInterlaceNull(t){const e=this._png.height,i=this._png.channels*this._png.depth/8,a=this._png.width*i,n=new Uint8Array(this._png.height*a);let s,r,o=wi,h=0;for(let l=0;l<e;l++){switch(s=t.subarray(h+1,h+1+a),r=n.subarray(l*a,(l+1)*a),t[h]){case 0:bi(s,r,a);break;case 1:mi(s,r,a,i);break;case 2:ki(s,r,o,a);break;case 3:yi(s,r,o,a,i);break;case 4:vi(s,r,o,a,i);break;default:throw new Error(`Unsupported filter: ${t[h]}`)}o=r,h+=a+1}if(this._hasPalette&&(this._png.palette=this._palette),16===this._png.depth){const t=new Uint16Array(n.buffer);if(gi)for(let e=0;e<t.length;e++)t[e]=(255&(l=t[e]))<<8|l>>8&255;this._png.data=t}else this._png.data=n;var l}}function bi(t,e,i){for(let a=0;a<i;a++)e[a]=t[a]}function mi(t,e,i,a){let n=0;for(;n<a;n++)e[n]=t[n];for(;n<i;n++)e[n]=t[n]+e[n-a]&255}function ki(t,e,i,a){let n=0;if(0===i.length)for(;n<a;n++)e[n]=t[n];else for(;n<a;n++)e[n]=t[n]+i[n]&255}function yi(t,e,i,a,n){let s=0;if(0===i.length){for(;s<n;s++)e[s]=t[s];for(;s<a;s++)e[s]=t[s]+(e[s-n]>>1)&255}else{for(;s<n;s++)e[s]=t[s]+(i[s]>>1)&255;for(;s<a;s++)e[s]=t[s]+(e[s-n]+i[s]>>1)&255}}function vi(t,e,i,a,n){let s=0;if(0===i.length){for(;s<n;s++)e[s]=t[s];for(;s<a;s++)e[s]=t[s]+e[s-n]&255}else{for(;s<n;s++)e[s]=t[s]+i[s]&255;for(;s<a;s++)e[s]=t[s]+Ei(e[s-n],i[s],i[s-n])&255}}function Ei(t,e,i){const a=t+e-i,n=Math.abs(a-t),s=Math.abs(a-e),r=Math.abs(a-i);return n<=s&&n<=r?t:s<=r?e:i}var Ai;!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.METRE=1]="METRE"}(Ai||(Ai={})),self.addEventListener("message",(t=>{const e=t.data,i=new PNGDecoder(e,a).decode();var a;let n;if(3===i.channels&&8===i.depth){const t=i.data.buffer,e=new Uint8ClampedArray(i.height*i.width*4),a=2**i.depth-1;for(let n=0;n<i.height*i.width;n++)e[4*n]=t[3*n],e[4*n+1]=t[3*n+1],e[4*n+2]=t[3*n+2],e[4*n+3]=a;n=e.buffer}else n=i.data.buffer;postMessage({data:n,width:i.width,height:i.height},[n])}))})()})();',"Worker",void 0,void 0)}));let Us=null;function Os(t){return function(){return function(t){return Us||(Us=new ImageLoader(t,Cs)),Us}(t)}}const Ts=new o.Z("LoaderComponent");var Is;!function(t){t.Idle="Idle",t.Loading="Loading",t.Loaded="Loaded",t.Error="Error"}(Is||(Is={}));const Rs=t=>new LoaderComponent(new t),Ns=(t,e)=>{if(t&&(e(t),t.children&&t.children.length>0))for(const i of t.children)Ns(i,e)},Ls=t=>{Ns(t,(t=>{if("Mesh"===t.type){const e=t;if(e.geometry&&e.geometry.dispose(),e.material)if(Array.isArray(e.material)){const t=e.material;for(const e of t)e.dispose()}else{e.material.dispose()}}}))};class LoaderComponent{constructor(t){this.assetLoader=t,this.visibleCache=!0,this.urlCache="",this.materialUrlCache="",this.pivot=null,this.inputs={url:"",materialUrl:"",visible:!0,onLoaded:t=>{},localScale:{x:1,y:1,z:1},localRotation:{x:0,y:0,z:0},localPosition:{x:0,y:0,z:0},colliderEnabled:!0},this.events={[n.CLICK]:!0,[n.HOVER]:!0,[n.DRAG]:!1},this.emits={[n.CLICK]:!0,[n.HOVER]:!0,[n.DRAG]:!1},this.outputs={loadingState:Is.Idle}}onInit(){this.checkForUpdates()}onInputsUpdated(){this.checkForUpdates()}onEvent(t,e){this.notify(t,e)}onDestroy(){this.pivot&&(Ls(this.pivot),this.outputs.objectRoot=null,this.pivot=null)}async checkForUpdates(){if(this.inputs.url!==this.urlCache||this.inputs.materialUrl!==this.materialUrlCache){if(this.urlCache=this.inputs.url,this.materialUrlCache=this.inputs.materialUrl,null===this.inputs.url)return void(this.outputs.loadingState=Is.Idle);const t=this.pivot;this.pivot=new u.Object3D,this.outputs.objectRoot=null,this.outputs.collider=null,t&&Ls(t),Ts.debug(`Loading ${this.inputs.url}`),this.outputs.loadingState=Is.Loading;const e=this.inputs.url;let i,n=!1;try{i=await this.assetLoader.load(this.inputs.url,this.inputs.materialUrl)}catch(t){n=!0}if(e!==this.inputs.url)return void Ts.debug(`Ignoring url ${e} since the input url changed during loading.`);if(n||!i)return void(this.outputs.loadingState=Is.Error);this.pivot.add(i.objectRoot),this.outputs.objectRoot=this.pivot}if(this.inputs.visible!==this.visibleCache&&this.outputs.objectRoot&&(this.visibleCache=this.inputs.visible,this.outputs.objectRoot.visible=this.visibleCache),this.outputs.objectRoot&&(this.outputs.collider=this.inputs.colliderEnabled?this.pivot:null),this.outputs.objectRoot&&this.pivot){const t=this.pivot.children[0],e=new u.Euler(this.inputs.localRotation.x*Math.PI/180,this.inputs.localRotation.y*Math.PI/180,this.inputs.localRotation.z*Math.PI/180,"YXZ");this.pivot.quaternion.setFromEuler(e),t.scale.set(this.inputs.localScale.x,this.inputs.localScale.y,this.inputs.localScale.z),t.position.set(this.inputs.localPosition.x,this.inputs.localPosition.y,this.inputs.localPosition.z)}this.outputs.loadingState=Is.Loaded,this.inputs.onLoaded(this.outputs.objectRoot||null)}}var Ss;!function(t){t.ONACCESSGRANTED="ONACCESSGRANTED",t.ONACCESSREVOKED="ONACCESSREVOKED"}(Ss||(Ss={}));const zs=t=>{class CameraComponent{constructor(){this.sub=null,this.controller=null,this.tmpPosition=new u.Vector3,this.tmpQuaternion=new u.Quaternion,this.inputs={enabled:!1,camera:null},this.emits={[Ss.ONACCESSGRANTED]:!0,[Ss.ONACCESSREVOKED]:!0}}onInit(){this.inputs.enabled&&this.requestControl()}onInputsUpdated(t){t.enabled&&this.release(),this.inputs.enabled&&this.requestControl()}onTick(){const t=this.inputs.camera;t&&this.controller&&(t.getWorldPosition(this.tmpPosition),t.getWorldQuaternion(this.tmpQuaternion),this.controller.updateCameraPosition(this.tmpPosition),this.controller.updateCameraRotation(this.tmpQuaternion))}onDestroy(){this.release()}release(){this.sub&&(this.sub.cancel(),this.sub=null)}requestControl(){this.sub=t.newSession(new class Requester{constructor(t){this.component=t}onAccessGranted(t){this.component.controller=t,this.notify(t,Ss.ONACCESSGRANTED)}onAccessRevoked(t){this.component.controller=null,this.notify(t,Ss.ONACCESSREVOKED)}notify(e,i){const n=this.component,s={pose:t.pose};n.notify(i,s)}}(this))}}return()=>new CameraComponent};var Ds=i(67678),Ps=i(12250),Bs=i(89553),Fs=i(62017),Ms=i(80160),js=i(11442),Zs=i(10082);const Hs=(t,e)=>{class InputComponent{constructor(){this.subs=[],this.inputs={eventsEnabled:!0,userNavigationEnabled:!0,unfiltered:!0},this.emits={[n.CLICK]:!0,[n.HOVER]:!0,[n.DRAG]:!0,[n.DRAG_BEGIN]:!0,[n.DRAG_END]:!0,[n.POINTER_MOVE]:!0,[n.POINTER_BUTTON]:!0,[n.SCROLL]:!0,[n.KEY]:!0,[n.LONG_PRESS_START]:!0,[n.LONG_PRESS_END]:!0,[n.MULTI_SWIPE]:!0,[n.MULTI_SWIPE_END]:!0,[n.PINCH]:!0,[n.PINCH_END]:!0,[n.ROTATE]:!0,[n.ROTATE_END]:!0},this.isUserNavigationEnabled=this.isUserNavigationEnabled.bind(this)}subHandler(e,i){this.inputs.unfiltered?this.subs.push(t.registerUnfilteredHandler(e,(t=>this.notify(i,t)))):this.subs.push(t.registerHandler(e,(t=>this.notify(i,t))))}isUserNavigationEnabled(){return this.inputs.userNavigationEnabled}onInit(){e.addNavigationRule(this.isUserNavigationEnabled),this.inputs.eventsEnabled&&this.subscribeAll()}onInputsUpdated(t){t.eventsEnabled!==this.inputs.eventsEnabled?this.inputs.eventsEnabled?this.subscribeAll():this.cancelAll():t.unfiltered!==this.inputs.unfiltered&&this.inputs.eventsEnabled&&(this.cancelAll(),this.subscribeAll())}onDestroy(){e.removeNavigationRule(this.isUserNavigationEnabled),this.cancelAll()}subscribeAll(){this.subs.length>0?this.subs.forEach((t=>t.renew())):(this.subHandler(Ds.mE,n.POINTER_MOVE),this.subHandler(g.E0,n.DRAG_BEGIN),this.subHandler(g._t,n.DRAG),this.subHandler(g._R,n.DRAG_END),this.subHandler(Ps.a,n.SCROLL),this.subHandler(Ds.er,n.POINTER_BUTTON),this.subHandler(Bs.e,n.KEY),this.subHandler(p.R,n.CLICK),this.subHandler(Fs.Vh,n.LONG_PRESS_START),this.subHandler(Fs.pt,n.LONG_PRESS_END),this.subHandler(Ms.d,n.MULTI_SWIPE),this.subHandler(Ms.h,n.MULTI_SWIPE_END),this.subHandler(js.G,n.PINCH),this.subHandler(js.i,n.PINCH_END),this.subHandler(Zs.D,n.ROTATE),this.subHandler(Zs.u,n.ROTATE_END))}cancelAll(){this.subs.forEach((t=>t.cancel()))}}return()=>new InputComponent},Ws=t=>{class XrComponent{constructor(){this.outputs={session:null}}onTick(){this.outputs.session=t.xr.getSession()}}return()=>new XrComponent};var Gs=i(37519);const Ks=new o.Z("ScenePath");function $s(t,e,i,n){return`${t?`${t.id}/`:""}${e.id}/${i}/${n}`}function Vs(t,e,i){switch(i.node=e,i.component=null,i.type=null,i.property=null,t.length){case 3:i.property=t[2],i.component=e.findComponentById(t[0]),i.type=t[1];break;case 2:i.property=t[1],i.component=e.findComponentById(t[0]),i.type=i.component?Qs(i.property,i.component):null}}function Ys(t,e){const i=t.split("/"),n={node:null,component:null,type:null,property:null};return Vs.length>0&&Vs(i,e,n),n}function Xs(t,e){const i=t.split("/"),n={node:null,component:null,type:null,property:null};if(i.length>0){const t=e.findNodeById(i[0]);t&&(i.splice(0,1),Vs(i,t,n))}return n}function Qs(t,e){return t in e.outputs?qs.OUTPUT:e.inputs&&t in e.inputs?qs.INPUT:t in e.events?qs.EVENT:e.emits&&t in e.emits?qs.EMIT:null}var qs;function Js(t,e){return new class{get id(){return e.id}get type(){return qs.OUTPUT}get property(){return e.property}get(){const t=e.component.outputs;if(t&&e.property in t)return t[e.property];Ks.warn(`'get' called on path that does not exist "${e.property}"`)}bind(e){return t.bindPath(e,this)}}}function tr(t){return t.type===qs.OUTPUT}function er(t){return t.type===qs.INPUT}function ir(t){return t.type===qs.EVENT}function nr(t){return t.type===qs.EMIT}!function(t){t.OUTPUT="output",t.INPUT="input",t.EVENT="event",t.EMIT="emit"}(qs||(qs={}));class PropertyBinder{constructor(){this.target=null,this.targetProp=null,this.src=null,this.srcProp=null}bind(t,e,i,n){this.target=t,this.targetProp=e,this.src=i,this.srcProp=n,this.initialTargetValue=this.target[this.targetProp],this.target[this.targetProp]=this.src[this.srcProp],this.subscription=this.src.onPropertyChanged(this.srcProp,(t=>{this.target&&this.targetProp&&(this.target[this.targetProp]=t)}))}unbind(){this.target&&this.targetProp&&(this.target[this.targetProp]=this.initialTargetValue,this.target=null,this.targetProp=null),this.src&&this.srcProp&&(this.subscription&&this.subscription.cancel(),this.src=null,this.srcProp=null)}}class DictionaryBinder{constructor(t){this.target=t,this.bindings={}}bind(t,e,i){if(this.bindings[t])throw Error(`Property ${t} already bound.`);const n=new PropertyBinder;n.bind(this.target,t,e,i),this.bindings[t]=n}unbind(t){const e=this.bindings[t];e&&(e.unbind(),delete this.bindings[t])}}const sr=new o.Z("SceneObject");var rr;!function(t){t[t.Idle=0]="Idle",t[t.Operating=1]="Operating",t[t.Stopped=2]="Stopped"}(rr||(rr={}));class SceneObject{constructor(t,e,i){this.nodeFactory=t,this.eventBus=e,this.scope=i,this.state=rr.Idle,this.nodes=[],this.nodeLookup=new Map,this.componentNodeMap=new Map,this.paths=new Set,this.pathLookup=new Map,this.pathDescLookup=new Map,this.bindingMap=new Map,this.dictionaryBinders=new Map,this.idTracker=new IdTracker,this.pathIdTracker=new IdTracker;const n=this;this.facade=new class ObjectFacade{get state(){return n.state}nodeIterator(){return n.nodeIterator()}bindings(){return n.bindings()}pathIterator(){return n.pathIterator()}findNodeById(t){return n.findNodeById(t)}addNode(t){const e=n.addNode(t);return(null==e?void 0:e.publicFacade())||null}addNodes(t){return n.addNodes(t).map((t=>t.publicFacade()))}addPath(t){return n.addPath(t)}addOutputPath(t,e,i){return n.addOutputPath(t,e,i)}addInputPath(t,e,i){return n.addInputPath(t,e,i)}addEmitPath(t,e,i){return n.addEmitPath(t,e,i)}addEventPath(t,e,i){return n.addEventPath(t,e,i)}bind(t,e,i,s){return n.bind(t,e,i,s)}bindPath(t,e){return n.bindPath(t,e)}setValueAtPath(t,e){return n.setValueAtPath(t,e)}getValueAtPath(t){return n.getValueAtPath(t)}spyOnEvent(t){return n.spyOnEvent(t)}start(){return n.start()}stop(){return n.stop()}}}publicFacade(){return this.facade}addNodes(t=1){if(this.state!==rr.Idle)return sr.warn("Cannot add nodes after the scene object has started"),[];if(t<=0)return sr.warn("Cannot add zero or fewer nodes"),[];const e=[];for(let i=0;i<t;i++){const t=this.addNode();t&&e.push(t)}return e}pushNode(t){if(this.state!==rr.Idle)return void sr.warn("Cannot add node after the scene object has started");const e=t.publicFacade();this.nodes.push(e),this.nodeLookup.set(t.id,t)}addNode(t){if(this.state!==rr.Idle)return sr.warn("Cannot add node after the scene object has started"),null;const e=this.nodeFactory.createNode(this.scope,this);if(t){if(!this.idTracker.isAvailable(t))throw Error("Component with duplicate id detected.");if(-1!==t.indexOf("/"))throw Error('Node ids cannot have "/" character.');this.idTracker.reserve(t)}const i=t||this.idTracker.nextId();Object.defineProperty(e,"id",{value:i,writable:!1,enumerable:!0});const n=e.publicFacade();return this.nodes.push(n),this.nodeLookup.set(e.id,e),e}onComponentAdded(t,e){this.componentNodeMap.set(e,t)}*nodeIterator(){for(const t of this.nodes)yield t}*bindings(){for(const t of this.bindingMap)yield t}*pathIterator(){for(const[,t]of this.pathDescLookup){const e=this.pathLookup.get(t.id);void 0!==e&&(yield{desc:t,path:e})}}start(){if(this.state===rr.Idle){for(const t of this.nodes)t.start();this.state=rr.Operating}else sr.warn("A scene object cannot be restarted.")}stop(){if(this.state===rr.Operating){for(const t of this.nodes)t.stop();this.state=rr.Stopped}}bindPath(t,e){if(this.state!==rr.Idle)throw Error("bind cannot be called after starting the scene node.");if(!this.paths.has(t)||!this.paths.has(e))throw Error("cannot bind paths across multiple objects");const i=this.pathDescLookup.get(t.id),n=this.pathDescLookup.get(e.id),s=i&&this.nodeLookup.get(i.node.id),r=n&&this.nodeLookup.get(n.node.id);if(!s)throw Error("`inputPath/eventPath` references a node that does not exist in this Object");if(!r)throw Error("`outputPath/emitPath` references a node that does not exist in this Object");const a=i.component,o=n.component,h=s.getComponentByInstance(a),l=r.getComponentByInstance(o);if(!h)throw Error("`inputPath/eventPath` references a component that does not exist under this Object");if(!l)throw Error("`outputPath/emitPath` references a component that does not exist under this Object");if(er(i)&&tr(n))this.bindInput(i,n);else{if(!ir(i)||!nr(n))throw Error('Couldn\'t bind. Only an "output" can be bound to an "input", or an "emit" to an "event"');this.bindEvent(i,n,h)}}bind(t,e,i,n){if(this.state!==rr.Idle)throw Error("bind cannot be called after starting the scene node.");if(!t||!i)throw Error("Some bind parameters were undefined.");const s=this.addInputPath(t,e,"input-"+this.pathIdTracker.nextId()),r=this.addOutputPath(i,n,"output-"+this.pathIdTracker.nextId());this.bindPath(s,r)}findNodeById(t){return this.nodes.find((e=>e.id===t))||null}addPath(t){if(!this.pathIdTracker.isAvailable(t.id))throw Error("Duplicate id detected.");if(-1!==t.id.indexOf("/"))throw Error('Path ids cannot have "/" character.');let e;if(tr(t)){if(!(t.property in t.component.outputs))throw Error(t.property+' is not an "output" of the component');Js(this,t),e=Js(this,t)}else if(er(t)){if(!t.component.inputs||!(t.property in t.component.inputs))throw Error(t.property+' is not an "input" of the component');e=function(t,e){return new class{get id(){return e.id}get type(){return e.type}get property(){return e.property}get(){const t=e.component.inputs;if(t&&e.property in t)return t[e.property];Ks.warn(`'get' called on component without input "${e.property}`)}set(t){const i=e.component.inputs;i&&e.property in i?i[e.property]=t:Ks.warn(`'set' called on component without input "${e.property}"`)}bind(e){return t.bindPath(this,e)}}}(this,t)}else if(ir(t)){if(!(t.property in t.component.events))throw Error(t.property+' is not an "event" of the component');e=function(t,e){return new class{get id(){return e.id}get type(){return e.type}get eventName(){return e.property}bind(e){return t.bindPath(this,e)}}}(this,t)}else{if(!nr(t))throw Error("Couldn't determine path type");if(!t.component.emits||!(t.property in t.component.emits))throw Error(t.property+' is not an "emit" of the component');e=function(t,e){return new class{get id(){return e.id}get type(){return e.type}get emitName(){return e.property}bind(e){return t.bindPath(e,this)}}}(this,t)}return this.pathIdTracker.reserve(t.id),this.pathDescLookup.set(t.id,Object.assign({},t)),this.paths.add(e),this.pathLookup.set(e.id,e),e}addInputPath(t,e,i){const n=this.componentNodeMap.get(t);if(!n)throw Error(`Couldn't find a path to ${e}`);const s=void 0!==i?i:this.pathIdTracker.peekId();return this.addPath({id:s,type:qs.INPUT,node:n,component:t,property:e})}addOutputPath(t,e,i){const n=this.componentNodeMap.get(t);if(!n)throw Error(`Couldn't find a path to ${e}`);const s=void 0!==i?i:this.pathIdTracker.peekId();return this.addPath({id:s,type:qs.OUTPUT,node:n,component:t,property:e})}addEmitPath(t,e,i){const n=this.componentNodeMap.get(t);if(!n)throw Error(`Couldn't find a path to ${e}`);const s=void 0!==i?i:this.pathIdTracker.peekId();return this.addPath({id:s,type:qs.EMIT,node:n,component:t,property:e})}addEventPath(t,e,i){const n=this.componentNodeMap.get(t);if(!n)throw Error(`Couldn't find a path to ${e}`);const s=void 0!==i?i:this.pathIdTracker.peekId();return this.addPath({id:s,type:qs.EVENT,node:n,component:t,property:e})}spyOnEvent(t){var e;const{path:i}=t,n=this.pathDescLookup.get(i.id);if(!n)throw Error("'spy.path' is not a valid path to spy on");const{node:s,component:r,type:a,property:o}=n,h=null===(e=this.nodeLookup.get(s.id))||void 0===e?void 0:e.getComponentByInstance(r);if(!h)throw Error(`spy.path: ${$s(s,r,a,o)}, is not a valid path to spy on`);if(er(n))return r.inputs.onPropertyChanged(o,(e=>t.onEvent(e)));if(tr(n))return r.outputs.onPropertyChanged(o,(e=>t.onEvent(e)));if(ir(n))return h.spyOnEvent(this.createSceneObjectEventSpy(t));if(nr(n))return this.eventBus.observe(this.createSceneObjectEventSpy(t));throw Error(`spy.path: ${$s(s,r,a,o)}, is not a valid path to spy on`)}setValueAtPath(t,e){sr.warn("`SceneObject.setValueAtPath` has been deprecated. Use `InputPath.set() instead.");const i=t.component.inputs;i&&t.property&&t.property in i?i[t.property]=e:sr.warn(`setValueAtPath called on component without input "${t.property}"`)}getValueAtPath(t){sr.warn("`SceneObject.setValueAtPath` has been deprecated. Use `OutputPath.get() instead.");const e=t.component.outputs;if(e&&t.property&&e[t.property])return e[t.property];sr.warn(`getValueAtPath called on path that does not exist "${t.property}"`)}bindInput(t,e){const i=this.dictionaryBinders.get(t.component)||new DictionaryBinder(t.component.inputs||{});this.dictionaryBinders.set(t.component,i),i.bind(t.property,e.component.outputs,e.property),this.bindingMap.set(t,e)}bindEvent(t,e,i){const n=t.component,s=t.property,r=e.component,a=e.property;this.bindingMap.set(t,e),this.eventBus.observe({src:r,srcEventType:a,targetEventType:s,onEvent(t,e){n.events[t]&&n.onEvent&&i.onEvent({type:t,data:e})}})}createSceneObjectEventSpy(t){const e=this.pathDescLookup.get(t.path.id);if(!e)throw Error();return new class{constructor(t){this.src=t.component,this.srcEventType=t.property,this.targetEventType=t.property}onEvent(e,i){t.onEvent(i)}}(e)}}var ar,or=i(40731);function hr(t,e,i){const{position:n,rotation:s,scale:r}=e,a=t.createNode(i).publicFacade();if(a.name=e.name||"Unnamed Node",n){if(!(0,or.u)(n))throw Error(`Invalid position ${JSON.stringify(n)}`);a.position.set(n.x,n.y,n.z)}if(s){if(!(0,or.u)(s))throw Error(`Invalid rotation ${JSON.stringify(s)}`);a.quaternion.setFromEuler(new u.Euler(s.x*Math.PI/180,s.y*Math.PI/180,s.z*Math.PI/180,"YXZ"))}if(r){if(!(0,or.u)(r))throw Error(`Invalid scale ${JSON.stringify(r)}`);a.scale.set(r.x,r.y,r.z)}for(const t of e.components)lr(a,t);return a}function lr(t,e,i){const n=t.addComponent(e.type,e.inputs,e.id);if(n){for(const t in e.events)n.events[t]=e.events[t];if(n.emits)for(const t in e.emits)n.emits[t]=e.emits[t]}return n}class SerializationError extends Error{constructor(t){super(t)}}function dr(t){const e={objects:[],bindings:[],paths:[]};for(const i of t.nodeIterator()){const t=cr(i);e.objects.push(t)}for(const[i,n]of t.bindings()){const t=[i.id,n.id];e.bindings.push(t)}for(const i of t.pathIterator()){const t=$s(i.desc.node,i.desc.component,i.desc.type,i.desc.property);e.paths.push([i.desc.id,t])}return e}function cr(t){const e=new u.Euler;e.setFromQuaternion(t.quaternion,"YXZ");const i=180/Math.PI;return{id:t.id,name:t.name,position:{x:t.position.x,y:t.position.y,z:t.position.z},rotation:{x:e.x*i,y:e.y*i,z:e.z*i},scale:{x:t.scale.x,y:t.scale.y,z:t.scale.z},components:ur(t)}}function ur(t){const e=[];for(const i of t.componentIterator()){const t={id:i.id,type:i.componentType,inputs:Object.assign({},i.inputs),emits:{},events:{}};for(const e in i.emits)t.emits[e]=!!i.emits[e];for(const e in i.events)t.events[e]=!!i.events[e];e.push(t)}return e}!function(t){t.V_1_0="1.0",t.V_2_0="2.0",t.V_2_1="2.1"}(ar||(ar={}));const fr=(t,e,i,n)=>{const s=new SceneObject(t,e,n),r=s.publicFacade(),a=[];for(const t of i.objects){const e=pr({createNode:function(){return s.addNode(t.id)||{}}},t,n);a.push(e)}if(i.bindings&&function(t,e,i){for(const i of e)if(2===i.length){const[e,n]=i,s=Xs(e,t),r=Xs(n,t);if(null===s.component||null===s.property)throw Error(`Could not resolve target for path '${e}'`);if(null===r.component||null===r.property)throw Error(`Could not resolve source for path '${n}'`);s.component.bind(s.property,r.component,r.property)}}(r,i.bindings),i.events&&function(t,e,i){for(const i of e)if(2===i.length){const[e,n]=i,s=Xs(e,t),r=Xs(n,t);if(null===s.component||null===s.property)throw Error(`Could not resolve target for path '${e}'`);if(null===r.component||null===r.property)throw Error(`Could not resolve source for path '${n}'`);s.component.bindEvent(s.property,r.component,r.property)}}(r,i.events),i.paths)for(const t of i.paths){const e=Xs(t[1],r);if(!(e.node&&e.component&&e.property&&Qs(e.property,e.component)))throw Error(`Unable to parse path "${t[1]}"`);{const i=Qs(e.property,e.component);if(i){({[qs.INPUT]:(t,e,i)=>r.addInputPath(t,e,i),[qs.OUTPUT]:(t,e,i)=>r.addOutputPath(t,e,i),[qs.EVENT]:(t,e,i)=>r.addEventPath(t,e,i),[qs.EMIT]:(t,e,i)=>r.addEmitPath(t,e,i)})[i](e.component,e.property,t[0])}}}return s},pr=(t,e,i)=>{const n=e.position,s=e.scale,r=e.rotation,a=t.createNode(i),o=e.name||"Unnamed Node",h=a.publicFacade();if(h.name=o,n){if(!(0,Gs.hj)(n.x)||!(0,Gs.hj)(n.y)||!(0,Gs.hj)(n.z))throw new Error(`Invalid position ${JSON.stringify(n)}`);h.position.set(n.x,n.y,n.z)}else h.position.set(0,0,0);if(r){if(!(0,Gs.hj)(r.x)||!(0,Gs.hj)(r.y)||!(0,Gs.hj)(r.z))throw new Error(`Invalid rotation ${JSON.stringify(r)}`);h.quaternion.setFromEuler(new u.Euler(r.x*Math.PI/180,r.y*Math.PI/180,r.z*Math.PI/180,"YXZ"))}else h.quaternion.set(0,0,0,1);if(s){if(!(0,Gs.hj)(s.x)||!(0,Gs.hj)(s.y)||!(0,Gs.hj)(s.z))throw new Error(`Invalid scale ${JSON.stringify(s)}`);h.scale.set(s.x,s.y,s.z)}else h.scale.set(1,1,1);const l=[];if(e.components)for(const t of e.components){const e=_r(h,t,i);e&&l.push(e)}return e.bindings&&function(t,e,i){for(const n of e)if(4===n.length){const[t,e,s,r]=n,a=i[t],o=i[s];if(!a)throw Error("could not find target Component index="+t);if(!o)throw Error("could not find source Component index="+s);a.bind(e,o,r)}else if(2===n.length){const[e,i]=n,s=Ys(e,t),r=Ys(i,t);if(null===s.component||null===s.property)throw Error(`Could not resolve target for path '${e}'`);if(null===r.component||null===r.property)throw Error(`Could not resolve source for path '${i}'`);s.component.bind(s.property,r.component,r.property)}}(h,e.bindings,l),e.events&&function(t,e,i){for(const n of e)if(4===n.length){const[t,e,s,r]=n,a=i[t],o=i[s];if(!a)throw Error("could not find target Component index="+t);if(!o)throw Error("could not find source Component index="+s);if(!(e in a.events))throw Error("Component index="+t+' does not have "'+e+'" as a handled event');a.bindEvent(e,o,r)}else if(2===n.length){const[e,i]=n,s=Ys(e,t),r=Ys(i,t);if(null===s.component||null===s.property)throw Error(`Could not resolve target for event path '${e}'`);if(null===r.component||null===r.property)throw Error(`Could not resolve source for event path '${i}'`);s.component.bindEvent(s.property,r.component,r.property)}}(h,e.events,l),h},_r=function(t,e,i){const n=t.addComponent(e.type,e.inputs,e.id);if(n)for(const t in e.events)n.events[t]=e.events[t];return n};const gr=(t,e,i,n)=>{const s=JSON.parse(i),r=s.version;let a;switch(r){case ar.V_1_0:a=((t,e,i,n)=>{const s=new SceneObject(t,e,n),r=[];for(const t of i.objects){const e=pr({createNode:function(){return s.addNode(t.id)||{}}},t,n);r.push(e)}return s})(t,e,s.payload,n);break;case ar.V_2_0:a=fr(t,e,s.payload,n);break;case ar.V_2_1:a=function(t,e,i,n){const s=new SceneObject(t,e,n),r=s.publicFacade(),a=[];for(const t of i.objects){const e={createNode:()=>s.addNode(t.id)||{}};a.push(hr(e,t,n))}const o=new Map,h=new Map,l=new Map,d=new Map;for(const[t,e]of i.paths){const i=Xs(e,r),{node:n,component:a,type:c,property:u}=i;if(n&&a&&c&&u)switch(c){case qs.OUTPUT:o.set(t,s.addOutputPath(a,u,t));break;case qs.INPUT:h.set(t,s.addInputPath(a,u,t));break;case qs.EVENT:l.set(t,s.addEventPath(a,u,t));break;case qs.EMIT:d.set(t,s.addEmitPath(a,u,t));break;default:throw Error(`unable to parse path "${e}"`)}}for(const[t,e]of i.bindings){const i=h.get(t)||l.get(t);if(!i)throw Error(`"${t}" not found in input or event paths`);const n=o.get(e)||d.get(e);if(!n)throw Error(`"${t}" not found in output or emit paths`);s.bindPath(i,n)}return s}(t,e,s.payload,n);break;default:throw Error(`Unsupported scene version ${r}`)}return{version:r,scene:a}};function mr(t,e){const i=Array.isArray(t)?function(t,e){const i=new Set,n=new Set;for(const s of t){if(i.has(s.id))throw new SerializationError(`Node IDs must be unique; found two nodes with ID: ${s.id}`);i.add(s.id);const t=e.get(s);if(t)for(const{path:e}of t.pathIterator())if(n.has(e.id))throw new SerializationError(`Path IDs must be unique; found two paths with ID: ${e.id}`)}const s={objects:[],bindings:[],paths:[]};for(let i=0;i<t.length;++i){const n=e.get(t[i]);if(!n)throw new SerializationError(`Unable to serialize node at index: ${i}`);const r=dr(n.publicFacade());s.objects.push(...r.objects),s.bindings.push(...r.bindings),s.paths.push(...r.paths)}return s}(t,e):dr(t);return JSON.stringify({version:ar.V_2_1,payload:i})}var br=i(92324);class ComponentLoader{constructor(t,e){this.engine=t,this.sceneModule=e,this.queuedComponents=new Set,this.started=!1}start(){this.started=!0,this.addQueuedComponents()}addComponent(t){this.started?this.addToEngine(t):this.queuedComponents.add(t)}removeComponent(t){this.engine.removeComponent(this.sceneModule,t),this.queuedComponents.delete(t)}addQueuedComponents(){for(const t of this.queuedComponents)this.addToEngine(t)}addToEngine(t){this.engine.addComponent(this.sceneModule,t)}}class SceneModule extends s.Y{constructor(){super(...arguments),this.name="scene",this.componentFactory=new ComponentBuilder,this.eventBus=new ComponentEventBus,this.nodeObjectMap=new Map}async init(t,e){let i,n,s,a;this.componentLoader=new ComponentLoader(e,this),[i,s,this.renderer,this.raycasterModule,this.inputIni,n,a]=await Promise.all([e.getModuleBySymbol(r.y.ANALYTICS),e.getModuleBySymbol(r.y.CANVAS),e.getModuleBySymbol(r.y.WEBGL_RENDERER),e.getModuleBySymbol(r.y.RAYCASTER),e.getModuleBySymbol(r.y.INPUT),e.market.waitForData(bs.I),e.getModuleBySymbol(r.y.NAVIGATION),e.getModuleBySymbol(r.y.MODEL_MESH)]),this.analytics=new SceneAnalytics(i,n),this.tags=new Tags,function(t,e){for(const t of ps){const e=Object.keys(t);for(const i of e){const e=t[i],n=u;if(i in n)if("object"==typeof e)for(const t in e)t in n[i]||(n[i][t]=e[t]);else"function"==typeof e&&(!(i in n)||_s.includes(i)?n[i]=e:gs.debug(`"${i}" exists in THREE object but has not been listed as overrideable, skipping...`));else n[i]=e}}u.DefaultLoadingManager.addHandler(/\.tga$/i,new Oe.TGALoader),u.DefaultLoadingManager.addHandler(/\.jpe?g$/i,t()),u.DefaultLoadingManager.addHandler(/\.png$/i,e()),u.Cache.enabled=!0}(ks(this.renderer.cwfRenderer.renderer),Os(this.renderer.cwfRenderer.renderer)),this.registerFactory({name:OBJLoader2Component.factoryName,scope:h},(()=>Rs(OBJLoader2Component))),this.registerFactory({name:FBXLoaderComponent.factoryName,scope:h},(()=>Rs(FBXLoaderComponent))),this.registerFactory({name:ColladaLoaderComponent.factoryName,scope:h},(()=>Rs(ColladaLoaderComponent))),this.registerFactory({name:GLTFLoaderComponent.factoryName,scope:h},(()=>Rs(GLTFLoaderComponent))),this.registerFactory({name:ScrollingTube.factoryName,scope:h},ScrollingTube.factory),this.registerFactory({name:T,scope:h},I(s.element)),this.registerFactory({name:LightsComponents.factoryName,scope:h},LightsComponents.factory),this.registerFactory({name:PointLightComponent.factoryName,scope:h},PointLightComponent.factory),this.registerFactory({name:DirectionalLightComponent.factoryName,scope:h},DirectionalLightComponent.factory),this.registerFactory({name:AmbientLightComponent.factoryName,scope:h},AmbientLightComponent.factory),this.registerFactory({name:"mp.camera",scope:h},zs(t.cameraPoseProxy)),this.registerFactory({name:"mp.input",scope:h},Hs(this.inputIni,a)),this.registerFactory({name:"mp.xr",scope:h},Ws(this.renderer.cwfRenderer.renderer));const o=t=>{this.tags.clearAllTags(),this.tags.tagObject(t.root,[ms.Model]);for(const e of t.floors){this.tags.tagObject(e,[ms.Floor]);for(const e of t.rooms)this.tags.tagObject(e,[ms.Room])}this.tags.tagObject(this.renderer.getScene().scene,[ms.Scene])};e.market.waitForData(br.s).then((t=>{o(t),t.onChanged(o)})),this.contextPropertyAccessor=new TrackFirstPropertyAnalyticsWrapper(this.analytics),this.componentStartAnalytics=new TrackFirstKeyAnalytics(this.analytics)}registerFactory(t,e){return this.componentFactory.registerFactory(t,e)}unregisterFactory(t,e){this.componentFactory.unregisterFactory(t,e)}createNode(t,e){const i=e||new SceneObject(this,this.eventBus,t),n=new SceneNode(this.componentLoader,this.renderer,this.raycasterModule.targets,this.componentStartAnalytics,this.componentFactory,i,this.eventBus,this.inputIni,this.contextPropertyAccessor,this);e||i.pushNode(n);const s=n.publicFacade();return this.nodeObjectMap.set(s,i),n}createObject(t){return new SceneObject(this,this.eventBus,t)}startLoading(){this.componentLoader.start()}sceneTags(){return this.tags}serialize(t){return mr(t,this.nodeObjectMap)}serializeNodeList(t){return mr(t,this.nodeObjectMap)}deserialize(t,e){const{version:i,scene:n}=gr(this,this.eventBus,e,t);return{version:i,object:n.publicFacade()}}get supportedSerializerVersions(){return ar}componentMap(){return{FBX_LOADER:FBXLoaderComponent.factoryName,DAE_LOADER:ColladaLoaderComponent.factoryName,OBJ_LOADER:OBJLoader2Component.factoryName,GLTF_LOADER:GLTFLoaderComponent.factoryName,SCROLLING_TUBE:ScrollingTube.factoryName,TRANSFORM_CONTROLS:T,SIMPLE_LIGHTS:LightsComponents.factoryName}}}}}]);