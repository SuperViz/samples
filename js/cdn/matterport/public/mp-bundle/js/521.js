/*! For license information please see 521.js.LICENSE.txt */
(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[521],{1158:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u});var i=n(53613),a=n(57956),r=n(53203),l=n(14564),s=n(64210),o=n(26544);const u=async function(e){const t=await e.getModuleBySymbol(a.y.SETTINGS),n=t.addPanel(i.s.TITLE,i.s.HOTKEYS,{width:350});await t.loadPromise.then((()=>{const i="meshtextures";[{panel:n,header:i,setting:"disableTextureStreamBelowLod",initialValue:()=>-1,onChange:e=>{e>-1&&(0,o.qT)().limitStreamingBelow(e)},urlParam:!0,rangePrecision:0,range:[-1,7]},{panel:n,header:i,setting:"textureStreamPause",initialValue:()=>r.ZP.debugPauseTexStream,onChange:e=>{r.ZP.debugPauseTexStream=e},urlParam:!0},{panel:n,header:i,setting:"textureStreamRaycastHits",initialValue:()=>r.ZP.debugLOD,onChange:e=>{r.ZP.debugLOD=e,e||(0,s.d)()},urlParam:!0},{panel:n,header:i,setting:"debugRTTQuality",initialValue:()=>r.ZP.debugRttQuality,onChange:t=>{r.ZP.debugRttQuality=t,t||e.commandBinder.issueCommand(new l.u({color:null},{style:l.u.selectBy.all}))},urlParam:!0},{panel:n,header:i,setting:"debugRTTScores",initialValue:()=>r.ZP.debugRttScores,onChange:t=>{r.ZP.debugRttScores=t,t||e.commandBinder.issueCommand(new l.u({color:null},{style:l.u.selectBy.all}))},urlParam:!0}].forEach((e=>t.registerMenuEntry(e)))}))}},50447:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>P,tiledMeshDebugMenu:()=>b});var i=n(97998),a=n(57956),r=n(39880),l=n(92558),s=n(69984),o=n(53613),u=n(51524),d=n(53203),c=n(947),g=n(84428),h=n(26544),m=n(35895);function y(e,t=16){let n;const i=(0,m.k1)((()=>n=window.setInterval((()=>e()),t)),(()=>{n&&clearInterval(n)}));return i.cancel(),i}var p=n(59279);const x=new i.Z("tiled-mesh"),T={hideMenu:"1"!==(0,p.eY)("dmenu","0"),debug:"1"===(0,p.eY)("debugTiles","0"),statsTiles:!1,statsTileset:!0,statsTextures:!1,statsTextureStream:!1};let v=null;function M(e,t,n){v||(v=document.createElement("div"),v.style.color="#FFFFFF",v.style.fontFamily="Roboto",v.style.fontWeight="300",v.style.fontSize="12px",v.style.position="absolute",v.style.top="50px",v.style.width="500px",v.style.pointerEvents="none",v.style.whiteSpace="pre",v.style.zIndex="99999",v.style.textShadow="0 0 1px black, 0 0 1px black, 0 0 1px black, 0 0 1px black",document.body.appendChild(v));let i=T.statsTileset?function(e){var t,n,i;const a=e.tilesRenderer,r=Object.values(null!==(t=a.tileSets)&&void 0!==t?t:[])[0];return`\ntileset: version: ${null==r?void 0:r.asset.tilesetVersion}, depth: ${null===(n=null==r?void 0:r.asset.extras)||void 0===n?void 0:n.depth}, preset: ${null===(i=null==r?void 0:r.asset.extras)||void 0===i?void 0:i.preset}\n`}(e):"";i+=T.statsTiles?function(e,t){const n=e.tilesRenderer,i=n.visibleTiles,a={};i.forEach((e=>{var t;const n=`lod${null===(t=e.extras)||void 0===t?void 0:t.level}`,i=a[n]||0;a[n]=i+1}));const r=t.threeRenderer.info,{stats:l,downloadQueue:s,parseQueue:o,lruCache:u}=n,{active:d,downloading:c,inFrustum:g,parsing:h,used:m,visible:y}=l;return`\nthree:\n    drawCalls: ${r.render.calls}\n    geometries: ${r.memory.geometries}\n    textures: ${r.memory.textures}\n    triangles: ${r.render.triangles}\n    memory allocated (megs): ${Math.floor(t.estimatedGPUMemoryAllocated()/2**20)}\ntiles:\n    tiles in frustum: ${g}\n    visible: ${y}`+Object.keys(a).sort().map((e=>`\n     ${e} tiles: ${a[e]||0}`)).join()+`\n    downloading gltf: ${c}\n    parsing gltf: ${h}\n    active: ${d}\n    used: ${m}\n    queues:\n      download: ${s.currJobs} running, ${s.items.length} waiting\n      parse: ${o.currJobs} running, ${o.items.length} waiting\n    lruCache: ${u.itemSet.size}\n`}(e,n):"",i+=T.statsTextureStream?function(e){const t="downloaded:\n"+Object.keys(e.totalTextures).map((t=>`    ${t}: ${e.totalTextures[t]} `)).join("\n")+"\n";return`textureStreaming:\n    downloadingTiles: ${e.downloadingTiles} / ${e.totalTiles}\n    downloadingTextures: ${e.loadingTextures}\n`+t}(t):"",v.textContent=i}let S=null;async function b(e){if(!T.debug)return;const t=await e.getModuleBySymbol(a.y.SETTINGS),n=await e.getModuleBySymbol(a.y.INPUT),i=await e.getModuleBySymbol(a.y.WEBGL_RENDERER),c=i.getScene(),g=await e.getModuleBySymbol(a.y.MODEL_MESH),m=g.modelTextureLoader,p=g.modelMesh.tileLoader,v=t.tryGetProperty(d.iT,!1);function b(){S||(S=setInterval((()=>M(p,m,i)),150))}const w=t.addPanel(o.s.TITLE,o.s.HOTKEYS,{width:350}),P={viz:"visualize",stats:"stats",tile:"tileset",log:"log"},O=function(e,t,n,i,a){const r=f(n,a,((e,t)=>e.setWireframe(t))),o=function(e,t){const n={scale:1},i=(t,i)=>{if(!t)return;const a=e.container.tilesByChunkId.get(t.id),r=(null==a?void 0:a.__error)||1e-4,l=t.lod!==u.t.maxLOD&&r>u.t.errorTarget?1:.5,s=Math.max(0,Math.min(1,1-n.scale/r)),o=i?C(t.lod,s,l):null;t.setColorOverlay(o)},a=f(e,t,i),r=y((()=>a.colorize(e.container.chunks)));return{toggle:e=>{e?r.renew():r.cancel(),a.toggle(e)},colorize:a.colorize,subscription:r,config:n}}(n,a),d=f(n,a,((e,t)=>{e.setColorOverlay(t?C(e.lod,1,.5):null)})),c=f(n,a,((e,t)=>{e.setColorOverlay(t?(0,s.G1)(.5,e.id||0):null)})),g=f(n,a,((e,t)=>{var i;const a=n.container.tilesByChunkId.get(e.id);e.setColorOverlay(t?(0,s.G1)(.5,(0,l.un)((null===(i=null==a?void 0:a.content)||void 0===i?void 0:i.uri)||"missing")||0):null)})),m=f(n,a,((e,t)=>{e.setColorOverlay(t?(0,s.G1)(.5,(e.meshGroup<<16)+e.meshSubgroup||0):null)})),p=f(n,a,((e,t)=>{e.setColorOverlay(t?(0,s.G1)(.5,e.meshSubgroup||0):null)})),T=f(n,a,((e,t)=>{e.setColorOverlay(t?(0,s.G1)(.5,e.meshGroup||0):null)})),v=f(n,a,((e,t)=>{e.setColorOverlay(t?(0,s.G1)(.5,(0,l.un)(e.textureName)||0):null)})),M=f(n,a,((e,t)=>{const i=n.container.tilesByChunkId.get(e.id);e.setColorOverlay(t?(0,s.G1)(.5,(null==i?void 0:i.geometricError)||0):null)})),S=i.slots,b=(0,h.qT)(),w=f(n,a,((e,t)=>{const n=S.find((t=>t.textureName===e.textureName));if(n){const i=n.loading?1:n.quality>b.min(e.lod)?.7:.3,a=b.maxTexelSize/b.get(n.quality).texelSize;e.setColorOverlay(t?C(e.lod,a,i):null)}})),P=y((()=>w.colorize(n.container.chunks)));let O="none";const V={none:void 0,byError:o,byGeometricError:M,byTile:g,bySubgroup:p,byMeshgroup:T,bySubAndMeshgroup:m,byTexture:v,byStreamedTextures:{subscription:P,toggle:e=>{e?P.renew():P.cancel(),e&&x.info("colorize=byStreamedTextures solid color: loading, dark color: streamed, light color: basis"),w.toggle(e)}},byChunk:c,byLod:d};return[{panel:e,header:t.viz,setting:"disableTileUpdates",initialValue:()=>u.t.disableTileUpdates,onChange:e=>{u.t.disableTileUpdates=e},urlParam:!0},{panel:e,header:t.viz,setting:"wireframe",initialValue:()=>!1,onChange:r.toggle,urlParam:!0},{panel:e,header:t.viz,setting:"colorize",initialValue:()=>"none",onChange:e=>{var t,n;null===(t=V[O])||void 0===t||t.toggle(!1),null===(n=V[e])||void 0===n||n.toggle(!0),O=e},options:Object.keys(V),urlParam:!0},{panel:e,header:t.viz,setting:"colorizeByErrorScale",initialValue:()=>1,onChange:e=>{o.config.scale=e},range:[0,6],rangePrecision:3,urlParam:!0}]}(w,P,p,m,e),V=[{panel:w,header:P.stats,setting:"tilesetStatsOverlay",initialValue:()=>T.statsTileset,onChange:e=>{T.statsTileset=e,e&&b()},urlParam:!0},{panel:w,header:P.stats,setting:"tileStatsOverlay",initialValue:()=>T.statsTiles,onChange:e=>{T.statsTiles=e,e&&b()},urlParam:!0},{panel:w,header:P.stats,setting:"textureStatsOverlay",initialValue:()=>T.statsTextures,onChange:e=>{T.statsTextures=e,e&&b()},urlParam:!0},{panel:w,header:P.stats,setting:"textureStreamingOverlay",initialValue:()=>T.statsTextureStream,onChange:e=>{T.statsTextureStream=e,e&&b()},urlParam:!0}],E=[{panel:w,header:P.log,buttonName:"Log: App State",callback:()=>{x.warn(g),x.warn(n),x.warn(c),x.warn(t)}}];v&&(T.hideMenu||await(0,r.gw)(1e3).then((()=>{t.getSettingsGui().loadGuiPackage().then((()=>{t.getSettingsGui().toggle(t.getMainPanelId()),t.getSettingsGui().toggle(t.getMainPanelId())}))})),await(0,r.gw)(16),O.forEach((e=>t.registerMenuEntry(e))),await(0,r.gw)(16),function(e,t){return[{panel:e,header:t.tile,setting:"maxLOD",initialValue:()=>u.t.maxLOD,onChange:e=>{u.t.maxLOD=e},range:[0,3],rangePrecision:0,urlParam:!0},{panel:e,header:t.tile,setting:"errorTarget",initialValue:()=>u.t.errorTarget,onChange:e=>{u.t.errorTarget=e},range:[0,20],rangePrecision:1,urlParam:!0},{panel:e,header:t.tile,setting:"displayActiveTiles",initialValue:()=>u.t.displayActiveTiles,onChange:e=>{u.t.displayActiveTiles=e},urlParam:!0},{panel:e,header:t.tile,setting:"loadSiblings",initialValue:()=>u.t.loadSiblings,onChange:e=>{u.t.loadSiblings=e},urlParam:!0},{panel:e,header:t.tile,setting:"autoDisableRendererCulling",initialValue:()=>u.t.autoDisableRendererCulling,onChange:e=>{u.t.autoDisableRendererCulling=e},urlParam:!0},{panel:e,header:t.tile,setting:"stopAtEmptyTiles",initialValue:()=>u.t.stopAtEmptyTiles,onChange:e=>{u.t.stopAtEmptyTiles=e},urlParam:!0},{panel:e,header:t.tile,setting:"disableTileUpdates",initialValue:()=>u.t.disableTileUpdates,onChange:e=>{u.t.disableTileUpdates=e},urlParam:!0},{panel:e,header:t.tile,setting:"disposeModel",initialValue:()=>u.t.disposeModel,onChange:e=>{u.t.disposeModel=e},urlParam:!0},{panel:e,header:t.tile,setting:"limitMemoryUsage",initialValue:()=>u.t.limitMemoryUsage,onChange:e=>{u.t.limitMemoryUsage=e},urlParam:!0},{panel:e,header:t.tile,setting:"allocatedMegsBeforeLimitingLod",initialValue:()=>u.t.allocatedMegsBeforeLimitingLod,onChange:e=>{u.t.allocatedMegsBeforeLimitingLod=e},urlParam:!0,range:[100,1e3]},{panel:e,header:t.tile,setting:"lruMinExtraTiles",initialValue:()=>u.t.lruMinExtraTiles,onChange:e=>{u.t.lruMinExtraTiles=e},urlParam:!0,range:[0,2e3]},{panel:e,header:t.tile,setting:"lruMaxTiles",initialValue:()=>u.t.lruMaxTiles,onChange:e=>{u.t.lruMaxTiles=e},urlParam:!0,range:[0,2e3]},{panel:e,header:t.tile,setting:"lruUnloadPercent",initialValue:()=>u.t.lruUnloadPercent,onChange:e=>{u.t.lruUnloadPercent=e},urlParam:!0,range:[0,1]},{panel:e,header:"Priority",setting:"errorMultiplierRaycastOcclusion",initialValue:()=>u.t.errorMultiplierRaycastOcclusion,onChange:e=>{u.t.errorMultiplierRaycastOcclusion=e},urlParam:!0,range:[.001,1],rangePrecision:2},{panel:e,header:"Priority",setting:"errorMultiplierHiddenFloors",initialValue:()=>u.t.errorMultiplierHiddenFloors,onChange:e=>{u.t.errorMultiplierHiddenFloors=e},urlParam:!0,range:[.001,1],rangePrecision:2}]}(w,P).forEach((e=>t.registerMenuEntry(e))),V.forEach((e=>t.registerMenuEntry(e))),E.forEach((e=>t.registerMenuButton(e))))}function f(e,t,n){let i=!1;const a=e=>{t.after(c.A.End).then((()=>{e.forEach((e=>{e&&n(e,i)}))}))},r=e.notifyOnChunksLoaded(a);r.cancel();return{toggle:t=>{t?r.renew():r.cancel(),t!==i&&(i=t,a([...e.container.chunks]))},colorize:a,subscription:r}}const w={0:new g.Vector4(1,0,0,1),1:new g.Vector4(0,1,0,1),2:new g.Vector4(0,0,1,1),3:new g.Vector4(1,1,1,1),4:new g.Vector4(1,0,1,1),5:new g.Vector4(0,1,1,1),6:new g.Vector4(1,1,0,1),7:new g.Vector4(0,0,0,1)};function C(e,t,n){var i,a;const r=null!==(a=null===(i=w[e])||void 0===i?void 0:i.clone())&&void 0!==a?a:new g.Vector4;return r.multiplyScalar(t),r.setW(n),r}const P=b},53613:(e,t,n)=>{"use strict";n.d(t,{s:()=>i});const i={TITLE:"streamed-mesh (T)",HOTKEYS:[n(70459).R.T]}},14564:(e,t,n)=>{"use strict";n.d(t,{u:()=>SetMeshOverlayCommand});var i,a,r=n(19663);!function(e){e.all="all",e.byMeshGroup="byMeshGroup",e.byMeshSubGroup="byMeshSubGroup"}(i||(i={})),function(e){e.explicit="explicit",e.random="random"}(a||(a={}));class SetMeshOverlayCommand extends r.m{constructor(e,t){super(),this.id="SET_MESH_OVERLAY_COLOR",this.payload={selectBy:(null==t?void 0:t.style)||i.all,colorStyle:(null==e?void 0:e.style)||a.explicit,color:(null==e?void 0:e.color)||null,alpha:(null==e?void 0:e.alpha)||.5,index:null==t?void 0:t.index}}}SetMeshOverlayCommand.selectBy=i,SetMeshOverlayCommand.colorBy=a,SetMeshOverlayCommand.COLOR_DIM={x:0,y:0,z:0,w:.3}},21270:(e,t,n)=>{"use strict";var i;n.d(t,{V:()=>i}),function(e){e[e.Min=0]="Min",e[e.Standard=1]="Standard",e[e.High=2]="High",e[e.Detail=3]="Detail"}(i||(i={}))},51524:(e,t,n)=>{"use strict";n.d(t,{t:()=>s});var i=n(59279),a=n(53261),r=n(31362),l=n(21270);const s={urlTemplateToken:"<file>",initialMaxLOD:l.V.Min,nonMeshMaxLOD:l.V.Standard,maxLOD:l.V.High,loadSiblings:!0,displayActiveTiles:!1,autoDisableRendererCulling:!0,optimizeRaycast:!1,stopAtEmptyTiles:!1,errorTarget:Number((0,i.eY)("errorTarget",(0,r.tq)()?6:4)),disableTileUpdates:!1,errorMultiplierRaycastOcclusion:.1,errorMultiplierHiddenFloors:.01,disposeModel:!1,limitMemoryUsage:(0,r.tq)(),allocatedMegsBeforeLimitingLod:350,lruMinExtraTiles:(0,r.tq)()?0:100,lruMaxTiles:800,lruUnloadPercent:.05,tileAssetRequestPriority:a.ru.MEDIUM,downloadQueueConcurrency:8,parseQueueConcurrency:10,snappingMaxLOD:l.V.Standard}},26544:(e,t,n)=>{"use strict";n.d(t,{O7:()=>m,qT:()=>g});var i=n(69984),a=n(84428),r=n(21270),l=n(99935),s=n(2569),o=n(53203);class TextureQualityMap{constructor(){this._configs={},this._orders={},this._maxLod=-1/0,this._maxTs=1/0,this._streamAbove=0,this.resetOnNextRegisterOnce=!1,this.dynamic=!1}static encodeKey(e,t){return e-t}get maxLod(){return this._maxLod}get maxTexelSize(){return this._maxTs}limitStreamingBelow(e){this._streamAbove=e}order(e,t=!1){return t&&!this._orders[e]&&(this._orders[e]=[]),this._orders[e]}reset(){this._configs={},this._orders={},this.dynamic=!1,this._maxTs=1/0,this._maxLod=-1/0}get isDynamic(){return this.dynamic}valid(e){return e in this._configs}get(e){if(!this.valid(e))throw new Error("invalid quality level "+e);return this._configs[e]}max(e){return e<this._streamAbove?this.min(e):this.order(e)[this.order(e).length-1]}min(e){return this.order(e)[0]}fromPixelSize(e,t){const n=this.order(e),i=this.min(e);let a=this.max(e);for(let e=n.length-1;e>=0;e--)t>this.get(n[e]).texelSize&&n.indexOf(a)>n.indexOf(i)&&(a=n[e]);return a}moreDetailed(e,t){let n=this.min(e);const i=this.max(e),a=this.order(e),r=a.indexOf(t);return r+1===a.length?i:(-1!==r&&(n=Math.min(i,a[r+1%a.length])),n)}lessDetailed(e,t){const n=this.order(e),i=n.indexOf(t);let a=t;return-1!==i&&(a=n[Math.max(0,i-1)]),a}minSize(){return Object.values(this._configs).sort(u)[0]}maxSize(){const e=Object.values(this._configs).sort(u);return e[e.length-1]}nearestQuality(e,t){const n=this.order(e),i=this.max(e),a=(0,s.et)(t,1,4,0,n.length-1);return Math.min(i,n[Math.round(a)])}registerQualities(e,t,n,i,a="max"){this.dynamic=!0,this.resetOnNextRegisterOnce&&(this.reset(),this.resetOnNextRegisterOnce=!1);const r=this._configs,l=this.order(e,!0),s=t*i;for(let i=t,u=n;i>=s;i*=.5,u*=2){const n=TextureQualityMap.encodeKey(e,u),s=r[n];(!s||s&&s.assetSize<t)&&(this._maxTs=Math.min(this._maxTs,u),this._maxLod=Math.max(this._maxLod,e),r[n]={key:n,lod:e,texelSize:u,textureSize:i,assetSize:t,assetType:a,tileSize:Math.min(i,o.ZP.textureTileSize)}),-1===l.indexOf(n)&&l.push(n)}l.sort(((e,t)=>r[t].texelSize-r[e].texelSize))}}function u(e,t){return e.textureSize>t.textureSize?1:-1}const d=new TextureQualityMap;var c;(c=d).reset(),c.registerQualities(r.V.Standard,512,.048,.5,"low"),c.registerQualities(r.V.Standard,2048,.012,.5,"high"),c.dynamic=!1,c.resetOnNextRegisterOnce=!0;const g=()=>d;const h={[l.S.LOW]:new a.Vector4(1,0,0,.5),[l.S.MEDIUM]:new a.Vector4(1,1,0,.5),[l.S.HIGH]:new a.Vector4(0,1,0,.5),[l.S.ULTRA]:new a.Vector4(0,1,1,.5)};function m(e){return e in h?h[e]:(0,i.G1)(.5,e)}},64210:(e,t,n)=>{"use strict";n.d(t,{e:()=>o,d:()=>u});var i=n(84428);const a=n(53203).ZP.sightingMaxAge,r=new i.Color;let l,s=-1;const o=(e,t)=>{l||(l=new i.InstancedMesh(new i.SphereBufferGeometry(.005,8,4),new i.MeshBasicMaterial,a),d(l));const n=new i.Matrix4;return({point:i,distance:o})=>{n.makeScale(o,o,o).setPosition(i),l.setMatrixAt(++s%a,n),l.instanceMatrix.needsUpdate=!0;for(let t=a;t--;)l.setColorAt((s-t+a)%a,r.set(e).multiplyScalar(1-t/a));l.instanceColor&&(l.instanceColor.needsUpdate=!0),l.parent||t.scene.add(l)}},u=()=>{var e;l&&(null===(e=l.parent)||void 0===e||e.remove(l),d(l))};function d(e){const t=(new i.Matrix4).makeScale(0,0,0);for(let n=0;n<a;n++)e.setMatrixAt(n,t)}},69984:(e,t,n)=>{"use strict";n.d(t,{G1:()=>s,rn:()=>o,D5:()=>u,Ex:()=>d});var i=n(84428),a=n(39880);const r=()=>Math.random(),l={},s=(e,t=r())=>(l[t]||(l[t]=new i.Vector4(r(),r(),r(),e)),l[t]),o=()=>new i.Color(r(),r(),r()),u=e=>"object"==typeof e&&"r"in e&&"g"in e&&"b"in e;function d(e){return`#${(0,a.Q_)(255*e.r,2,"0",16)}${(0,a.Q_)(255*e.g,2,"0",16)}${(0,a.Q_)(255*e.b,2,"0",16)}`}}}]);