/*! For license information please see 924.js.LICENSE.txt */
(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[924],{74924:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ZoomControls});var o=i(97542),a=i(57956),s=i(12250),n=i(11442),r=i(89553),h=i(70459),l=i(45325),d=i(25985),m=i(18596),c=i(23254),u=i(53954),g=i(49827),p=i(69505),w=i(31546);const y=.1,b=.7,z=2,D=3,B=1.1;var T=i(33585),S=i(61948),v=i(76609);class ZoomControls extends o.Y{constructor(){super(...arguments),this.name="zoom-controls",this.uhQuality={},this.config={enabled:!0,tiles:!0}}async init(e,t){if(this.config.enabled=!!e.enabled,this.config.tiles=!!e.tiles,this.config.tiles)try{this.sweepTilingModule=await t.getModuleBySymbol(a.y.SWEEP_PANO)}catch(e){this.log.debug(`Tiling not enabled for zoom controls - ${e}`)}this.config.enabled&&await this.registerControls(t),this.engine=t,this.cameraModule=await t.getModuleBySymbol(a.y.CAMERA),this.cameraData=await t.market.waitForData(d.M),this.viewmodeData=await t.market.waitForData(c.O),this.sweepData=await t.market.waitForData(u.Z),this.bindings.push(t.commandBinder.addBinding(T.bj,(async e=>this.zoomBy(e.step))),t.commandBinder.addBinding(T.KB,(async e=>this.zoomBy(-e.step))),t.commandBinder.addBinding(T.ob,(async()=>this.zoomTo(1))),t.commandBinder.addBinding(T.ts,(async e=>this.zoomTo(e.value))),t.commandBinder.addBinding(T._N,this.getMaxZoomAvailable.bind(this)))}async registerControls(e){e.getModuleBySymbol(a.y.INPUT).then((e=>{this.bindings.push(e.registerHandler(s.a,(e=>this.zoomByInput(this.scrollToZoomDelta(e))))),this.bindings.push(e.registerHandler(n.G,(e=>this.zoomByInput(this.pinchToZoomDelta(e))))),this.bindings.push(e.registerHandler(r.e,(e=>this.keyHandler(e))))}))}zoomTo(e){const t=this.cameraData.zoom();if(!this.validateViewmode())return t;const i=this.sweepData.currentSweepObject;if(this.config.tiles&&i&&this.checkTilingZoomLevels(e,i),(e=(0,g.uZ)(e,b,D))!==t){const t=(0,p.ZY)(this.cameraData.baseFovY/e),i=m.oR.near,o=m.oR.far;this.cameraModule.updateCameraProjection((new w.M).makePerspectiveFov(t,this.cameraData.aspect(),i,o))}return this.engine.broadcast(new S.Z(e)),e}checkTilingZoomLevels(e,t){e>=B&&this.zoomedSweep!==t?(this.zoomedSweep=t,this.sweepTilingModule.enableZooming(!0,t).then((e=>{e?this.uhQuality[t.id]=!0:(this.uhQuality[t.id]=!1,this.zoomedSweep=void 0)}))):e<B&&this.zoomedSweep&&this.zoomedSweep===t&&(this.sweepTilingModule.enableZooming(!1,this.zoomedSweep),this.zoomedSweep=void 0)}getMaxZoom(e){return this.uhQuality[null!=e?e:"none"]?D:z}zoomBy(e){const t=this.cameraData.zoom();return this.validateViewmode()?this.zoomTo(t+e):t}validateViewmode(){return this.viewmodeData.isInside()&&this.cameraData.canTransition()}scrollToZoomDelta(e){return-Math.sign(e.delta.y)*y}pinchToZoomDelta(e){return e.pinchDelta*(z-b)}zoomByInput(e){const t=this.cameraData.zoom();if(!this.validateViewmode())return t;const i=this.sweepData.currentSweep,o=(0,g.uZ)(t+e,b,this.getMaxZoom(i));return this.zoomTo(o)}keyHandler(e){if(e.state===l.M.DOWN)switch(e.key){case h.R.PLUSEQUALS:this.zoomByInput(y);break;case h.R.DASHUNDERSCORE:this.zoomByInput(-y);break;case h.R.OPENBRACKET:this.zoomTo(1)}}async getMaxZoomAvailable(){if(!this.sweepData.currentSweepObject)return z;const e=this.sweepData.currentSweepObject;return await this.sweepTilingModule.availableResolution(e,v.SL.ULTRAHIGH)>=v.SL.ULTRAHIGH?D:z}}}}]);