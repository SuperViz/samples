/*! For license information please see 670.js.LICENSE.txt */
(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[670],{10338:(e,t,r)=>{"use strict";r.r(t),r.d(t,{DRACOLoader:()=>DRACOLoader});var o=r(84428);const s=new WeakMap;class DRACOLoader extends o.Loader{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,s){const i=new o.FileLoader(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,(e=>{const r={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,r).then(t).catch(s)}),r,s)}decodeDracoFile(e,t,r,o){const s={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:o||this.defaultAttributeTypes,useUniqueIDs:!!r};this.decodeGeometry(e,s).then(t)}decodeGeometry(e,t){for(const e in t.attributeTypes){const r=t.attributeTypes[e];void 0!==r.BYTES_PER_ELEMENT&&(t.attributeTypes[e]=r.name)}const r=JSON.stringify(t);if(s.has(e)){const t=s.get(e);if(t.key===r)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let o;const i=this.workerNextTaskID++,a=e.byteLength,n=this._getWorker(i,a).then((r=>(o=r,new Promise(((r,s)=>{o._callbacks[i]={resolve:r,reject:s},o.postMessage({type:"decode",id:i,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return n.catch((()=>!0)).then((()=>{o&&i&&this._releaseTask(o,i)})),s.set(e,{key:r,promise:n}),n}_createGeometry(e){const t=new o.BufferGeometry;e.index&&t.setIndex(new o.BufferAttribute(e.index.array,1));for(let r=0;r<e.attributes.length;r++){const s=e.attributes[r],i=s.name,a=s.array,n=s.itemSize;t.setAttribute(i,new o.BufferAttribute(a,n))}return t}_loadLibrary(e,t){const r=new o.FileLoader(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),r.setWithCredentials(this.withCredentials),new Promise(((t,o)=>{r.load(e,t,void 0,o)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{const r=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const o=i.toString(),s=["/* draco decoder */",r,"","/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([s]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const r=t.data;switch(r.type){case"decode":e._callbacks[r.id].resolve(r);break;case"error":e._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));const r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=t,r._taskLoad+=t,r}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function i(){let e,t;function r(e,t,r,o,s,i){const a=i.num_components(),n=r.num_points()*a,d=n*s.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,s),h=e._malloc(d);t.GetAttributeDataArrayForAllPoints(r,i,c,d,h);const l=new s(e.HEAPF32.buffer,h,n).slice();return e._free(h),{name:o,array:l,itemSize:a}}onmessage=function(o){const s=o.data;switch(s.type){case"init":e=s.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":const o=s.buffer,i=s.taskConfig;t.then((e=>{const t=e.draco,a=new t.Decoder,n=new t.DecoderBuffer;n.Init(new Int8Array(o),o.byteLength);try{const e=function(e,t,o,s){const i=s.attributeIDs,a=s.attributeTypes;let n,d;const c=t.GetEncodedGeometryType(o);if(c===e.TRIANGULAR_MESH)n=new e.Mesh,d=t.DecodeBufferToMesh(o,n);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");n=new e.PointCloud,d=t.DecodeBufferToPointCloud(o,n)}if(!d.ok()||0===n.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+d.error_msg());const h={index:null,attributes:[]};for(const o in i){const d=self[a[o]];let c,l;if(s.useUniqueIDs)l=i[o],c=t.GetAttributeByUniqueId(n,l);else{if(l=t.GetAttributeId(n,e[i[o]]),-1===l)continue;c=t.GetAttribute(n,l)}h.attributes.push(r(e,t,n,o,d,c))}c===e.TRIANGULAR_MESH&&(h.index=function(e,t,r){const o=3*r.num_faces(),s=4*o,i=e._malloc(s);t.GetTrianglesUInt32Array(r,s,i);const a=new Uint32Array(e.HEAPF32.buffer,i,o).slice();return e._free(i),{array:a,itemSize:1}}(e,t,n));return e.destroy(n),h}(t,a,n,i),o=e.attributes.map((e=>e.array.buffer));e.index&&o.push(e.index.array.buffer),self.postMessage({type:"decode",id:s.id,geometry:e},o)}catch(e){console.error(e),self.postMessage({type:"error",id:s.id,error:e.message})}finally{t.destroy(n),t.destroy(a)}}))}}}},69138:(e,t,r)=>{"use strict";r.r(t),r.d(t,{KTX2Loader:()=>KTX2Loader});var o=r(84428),s=r(60064);const i=new WeakMap;let a=0;class KTX2Loader extends o.Loader{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new s.WorkerPool,this.workerSourceURL="",this.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const e=new o.FileLoader(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),r=new o.FileLoader(this.manager);r.setPath(this.transcoderPath),r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials);const s=r.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,s]).then((([e,t])=>{const r=KTX2Loader.BasisWorker.toString(),o=["/* constants */","let _EngineFormat = "+JSON.stringify(KTX2Loader.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(KTX2Loader.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(KTX2Loader.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([o])),this.transcoderBinary=t,this.workerPool.setWorkerCreator((()=>{const e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e}))})),a>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),a++}return this.transcoderPending}load(e,t,r,s){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const a=new o.FileLoader(this.manager);a.setResponseType("arraybuffer"),a.setWithCredentials(this.withCredentials);const n=new o.CompressedTexture;return a.load(e,(e=>{if(i.has(e)){return i.get(e).promise.then(t).catch(s)}this._createTexture([e]).then((function(e){n.copy(e),n.needsUpdate=!0,t&&t(n)})).catch(s)}),r,s),n}_createTextureFrom(e){const{mipmaps:t,width:r,height:s,format:i,type:a,error:n,dfdTransferFn:d,dfdFlags:c}=e;if("error"===a)return Promise.reject(n);const h=new o.CompressedTexture(t,r,s,i,o.UnsignedByteType);return h.minFilter=1===t.length?o.LinearFilter:o.LinearMipmapLinearFilter,h.magFilter=o.LinearFilter,h.generateMipmaps=!1,h.needsUpdate=!0,h.encoding=2===d?o.sRGBEncoding:o.LinearEncoding,h.premultiplyAlpha=!!(1&c),h}_createTexture(e,t={}){const r=t,o=this.init().then((()=>this.workerPool.postMessage({type:"transcode",buffers:e,taskConfig:r},e))).then((e=>this._createTextureFrom(e.data)));return i.set(e[0],{promise:o}),o}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),a--,this}}KTX2Loader.BasisFormat={ETC1S:0,UASTC_4x4:1},KTX2Loader.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},KTX2Loader.EngineFormat={RGBAFormat:o.RGBAFormat,RGBA_ASTC_4x4_Format:o.RGBA_ASTC_4x4_Format,RGBA_BPTC_Format:o.RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:o.RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:o.RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:o.RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:o.RGB_ETC1_Format,RGB_ETC2_Format:o.RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:o.RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format:o.RGB_S3TC_DXT1_Format},KTX2Loader.BasisWorker=function(){let e,t,r;const o=_EngineFormat,s=_TranscoderFormat,i=_BasisFormat;self.addEventListener("message",(function(a){const h=a.data;switch(h.type){case"init":e=h.config,l=h.transcoderBinary,t=new Promise((e=>{r={wasmBinary:l,onRuntimeInitialized:e},BASIS(r)})).then((()=>{r.initializeBasis(),void 0===r.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")}));break;case"transcode":t.then((()=>{try{const{width:t,height:a,hasAlpha:l,mipmaps:u,format:_,dfdTransferFn:T,dfdFlags:f}=function(t){const a=new r.KTX2File(new Uint8Array(t));function h(){a.close(),a.delete()}if(!a.isValid())throw h(),new Error("THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file");const l=a.isUASTC()?i.UASTC_4x4:i.ETC1S,u=a.getWidth(),_=a.getHeight(),T=a.getLevels(),f=a.getHasAlpha(),p=a.getDFDTransferFunc(),m=a.getDFDFlags(),{transcoderFormat:g,engineFormat:w}=function(t,r,a,h){let l,u;const _=t===i.ETC1S?n:d;for(let o=0;o<_.length;o++){const s=_[o];if(e[s.if]&&(s.basisFormat.includes(t)&&!(h&&s.transcoderFormat.length<2)&&(!s.needsPowerOfTwo||c(r)&&c(a))))return l=s.transcoderFormat[h?1:0],u=s.engineFormat[h?1:0],{transcoderFormat:l,engineFormat:u}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),l=s.RGBA32,u=o.RGBAFormat,{transcoderFormat:l,engineFormat:u}}(l,u,_,f);if(!u||!_||!T)throw h(),new Error("THREE.KTX2Loader:\tInvalid texture");if(!a.startTranscoding())throw h(),new Error("THREE.KTX2Loader: .startTranscoding failed");const C=[];for(let e=0;e<T;e++){const t=a.getImageLevelInfo(e,0,0),r=t.origWidth,o=t.origHeight,s=new Uint8Array(a.getImageTranscodedSizeInBytes(e,0,0,g));if(!a.transcodeImage(s,e,0,0,g,0,-1,-1))throw h(),new Error("THREE.KTX2Loader: .transcodeImage failed.");C.push({data:s,width:r,height:o})}return h(),{width:u,height:_,hasAlpha:f,mipmaps:C,format:w,dfdTransferFn:p,dfdFlags:m}}(h.buffers[0]),p=[];for(let e=0;e<u.length;++e)p.push(u[e].data.buffer);self.postMessage({type:"transcode",id:h.id,width:t,height:a,hasAlpha:l,mipmaps:u,format:_,dfdTransferFn:T,dfdFlags:f},p)}catch(e){console.error(e),self.postMessage({type:"error",id:h.id,error:e.message})}}))}var l}));const a=[{if:"astcSupported",basisFormat:[i.UASTC_4x4],transcoderFormat:[s.ASTC_4x4,s.ASTC_4x4],engineFormat:[o.RGBA_ASTC_4x4_Format,o.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[s.BC7_M5,s.BC7_M5],engineFormat:[o.RGBA_BPTC_Format,o.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[s.BC1,s.BC3],engineFormat:[o.RGB_S3TC_DXT1_Format,o.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[s.ETC1,s.ETC2],engineFormat:[o.RGB_ETC2_Format,o.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[s.ETC1],engineFormat:[o.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[s.PVRTC1_4_RGB,s.PVRTC1_4_RGBA],engineFormat:[o.RGB_PVRTC_4BPPV1_Format,o.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],n=a.sort((function(e,t){return e.priorityETC1S-t.priorityETC1S})),d=a.sort((function(e,t){return e.priorityUASTC-t.priorityUASTC}));function c(e){return e<=2||0==(e&e-1)&&0!==e}}},60064:(e,t,r)=>{"use strict";r.r(t),r.d(t,{WorkerPool:()=>WorkerPool});class WorkerPool{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const r=this.workersResolve[e];if(r&&r(t),this.queue.length){const{resolve:t,msg:r,transfer:o}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(r,o)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise((r=>{const o=this._getIdleWorker();-1!==o?(this._initWorker(o),this.workerStatus|=1<<o,this.workersResolve[o]=r,this.workers[o].postMessage(e,t)):this.queue.push({resolve:r,msg:e,transfer:t})}))}dispose(){this.workers.forEach((e=>e.terminate())),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}}}]);